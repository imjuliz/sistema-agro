generator client {
  provider = "prisma-client-js"
  output   = "../prisma/generated"
}

datasource db {
  provider = "postgresql"
}

model Perfil {
  id        Int        @id @default(autoincrement())
  funcao    TipoPerfil
  descricao String
  usuarios  Usuario[]

  @@map("perfil")
}

model Unidade {
  id                      Int                @id @default(autoincrement())
  matrizId                Int?               @map("matriz_id")
  gerenteId               Int?               @map("gerente_id")
  nome                    String             @db.VarChar(100)
  endereco                String
  cnpj                    String             @db.VarChar(20)
  cidade                  String?            @db.VarChar(100)
  estado                  String?            @db.VarChar(100)
  cep                     String?            @db.VarChar(20)
  focoProdutivo           String?            @db.VarChar(50)
  imagemUrl               String?            @map("imagem_url") @db.VarChar(1000)
  areaTotal               Decimal?           @map("area_total") @db.Decimal(12, 3)
  areaProdutiva           Decimal?           @map("area_produtiva") @db.Decimal(12, 3)
  latitude                Float?
  longitude               Float?
  descricaoCurta          String?            @map("descricao_curta")
  tipo                    TipoUnidade
  horarioAbertura         DateTime?          @map("horario_abertura") @db.Time(0)
  horarioFechamento       DateTime?          @map("horario_fechamento") @db.Time(0)
  telefone                String             @db.VarChar(20)
  email                   String?            @db.VarChar(255)
  status                  StatusUnidade      @default(ATIVA)
  criadoEm                DateTime           @default(now()) @map("criado_em")
  atualizadoEm            DateTime           @default(now()) @updatedAt @map("atualizado_em")
  animais                 Animal[]
  caixas                  Caixa[]
  contratosComoFornecedor Contrato[]         @relation("ContratoFornecedorInterno")
  contratosComoLoja       Contrato[]         @relation("ContratoUnidade")
  estoques                Estoque?
  destinoMovimento        EstoqueMovimento[] @relation("DestinoMovimento")
  origemMovimento         EstoqueMovimento[] @relation("OrigemMovimento")
  estoqueProdutos         EstoqueProduto[]   @relation("EstoqueProduto_fornecedorUnidade")
  financeiro              Financeiro[]
  lotes                   Lote[]
  pedidosComoDestino      Pedido[]           @relation("PedidoDestino")
  pedidosComoOrigem       Pedido[]           @relation("PedidoOrigem")
  plantio                 Plantio[]
  producaoDestino         Producao[]         @relation("ProducaoDestino")
  producaoOrigem          Producao[]
  produtoOrigem           Produto[]          @relation("ProdutoOrigem")
  produtoUnidade          Produto[]          @relation("ProdutoUnidade")
  gerente                 Usuario?           @relation("GerenteUnidade", fields: [gerenteId], references: [id])
  matriz                  Unidade?           @relation("UnidadeMatriz", fields: [matrizId], references: [id])
  filiais                 Unidade[]          @relation("UnidadeMatriz")
  usuarios                Usuario[]          @relation("UsuarioUnidade")
  vendas                  Venda[]
  categoria               Categoria[]
  dadosGerais             DadoGeralUnidade[]
  fornecedoresExternos   FornecedorExterno[]  @relation("FornecedorExterno")

  @@index([matrizId])
  @@index([gerenteId])
  @@index([tipo])
  @@index([status])
  @@index([cidade])
  @@index([estado])
  @@map("unidade")
}

model Usuario {
  id                        Int             @id @default(autoincrement())
  perfilId                  Int             @map("perfil_id")
  unidadeId                 Int?            @map("unidade_id")
  nome                      String          @db.VarChar(100)
  email                     String          @unique @db.VarChar(100)
  senha                     String          @db.VarChar(255)
  telefone                  String          @db.VarChar(20)
  ftPerfil                  String?         @map("ft_perfil") @db.VarChar(1000)
  status                    Boolean         @default(true)
  tokenVersion              Int             @default(0)
  failedAttempts            Int             @default(0)
  lockoutUntil              DateTime?
  criadoEm                  DateTime        @default(now()) @map("criado_em")
  atualizadoEm              DateTime        @default(now()) @updatedAt @map("atualizado_em")
  atvdAnimalia              AtvdAnimalia[]  @relation("UsuarioAtvdAnimalia")
  atvdLote                  AtvdLote[]
  atvdAgricola              AtvdAgricola[]  @relation("UsuarioAtvdPlantio")
  caixas                    Caixa[]
  financeiro                Financeiro[]
  lotes                     Lote[]
  pedidoCriador             Pedido[]        @relation("PedidoCriador")
  producao                  Producao[]
  produtos                  Produto[]       @relation("ProdutoCriador")
  resetSenhas               ResetSenha[]
  sessoes                   Sessao[]
  unidadesGerenciadas       Unidade[]       @relation("GerenteUnidade")
  perfil                    Perfil          @relation(fields: [perfilId], references: [id])
  unidade                   Unidade?        @relation("UsuarioUnidade", fields: [unidadeId], references: [id])
  vendas                    Venda[]
  producaoEtapasResponsavel ProducaoEtapa[] @relation("Usuario_ProducaoEtapa")

  @@index([unidadeId])
  @@index([perfilId])
  @@index([status])
  @@map("usuario")
}

model Sessao {
  id               String   @id @default(cuid())
  usuarioId        Int
  refreshTokenHash String   @unique @db.VarChar(128)
  userAgent        String?  @db.VarChar(512)
  ip               String?  @db.VarChar(45)
  createdAt        DateTime @default(now())
  expiresAt        DateTime
  revoked          Boolean  @default(false)
  replacedById     String?
  usuario          Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([refreshTokenHash])
  @@index([usuarioId])
  @@index([expiresAt])
  @@map("sessao")
}

model ResetSenha {
  id           Int      @id @default(autoincrement())
  usuarioId    Int      @map("usuario_id")
  codigoReset  String   @map("codigo_reset") @db.VarChar(6)
  codigoExpira DateTime @map("codigo_expira")
  usado        Boolean  @default(false)
  criadoEm     DateTime @default(now()) @map("criado_em")
  usuario      Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("reset_senhas")
}

model DadoGeralUnidade {
  id           Int      @id @default(autoincrement())
  unidadeId    Int      @map("unidade_id")
  dado         String   @db.VarChar(255)
  valor        String   @db.VarChar(1000)
  descricao    String?  @db.VarChar(2000)
  criadoEm     DateTime @default(now()) @map("criado_em")
  atualizadoEm DateTime @default(now()) @updatedAt @map("atualizado_em")
  unidade      Unidade  @relation(fields: [unidadeId], references: [id], onDelete: Cascade)

  @@index([unidadeId])
  @@map("dado_geral_unidade")
}

model Produto {
  id              Int               @id @default(autoincrement())
  unidadeId       Int               @map("unidade_id")
  origemUnidadeId Int?              @map("origem_unidade_id")
  // fornecedorId    Int?               @map("fornecedor_id")
  criadoPorId     Int?              @map("criado_por_id")
  loteId          Int?              @unique
  nome            String            @db.VarChar(150)
  sku             String            @unique @db.VarChar(50)
  categoria       String?           @db.VarChar(100)
  descricao       String?
  preco           Decimal           @db.Decimal(10, 2)
  dataFabricacao  DateTime          @map("data_fabricacao")
  dataValidade    DateTime          @map("data_validade")
  criadoEm        DateTime          @default(now()) @map("criado_em")
  atualizadoEm    DateTime?          @default(now()) @updatedAt @map("atualizado_em")
  unidadeMedida   UnidadesDeMedida? @map("unidade_medida")
  codigoBarras    String?           @map("codigo_barras")
  ncm             String?           @map("ncm")
  pesoUnidade     Decimal?          @map("peso_unidade") @db.Decimal(10, 3)
  tags            Json?             @map("tags")
  impostos        Json?             @map("impostos")
  isForSale       Boolean           @default(false)
  estoqueProdutos EstoqueProduto[]
  // itensVendas     ItemVenda[]
  pedidoItems     PedidoItem[]
  contratosItens   ContratoItens[]
  producao        Producao[]
  criadoPor       Usuario?          @relation("ProdutoCriador", fields: [criadoPorId], references: [id])
  // fornecedor      FornecedorExterno? @relation("FornecedorProdutosRecebidos", fields: [fornecedorId], references: [id])
  lote            Lote?             @relation(fields: [loteId], references: [id])
  origemUnidade   Unidade?          @relation("ProdutoOrigem", fields: [origemUnidadeId], references: [id])
  unidade         Unidade           @relation("ProdutoUnidade", fields: [unidadeId], references: [id])

  @@index([unidadeId])
  @@index([origemUnidadeId])
  // @@index([fornecedorId])
  @@index([loteId])
  @@index([categoria])
  @@index([codigoBarras])
  @@map("produto")
}

model Estoque {
  id                Int                @id @default(autoincrement())
  unidadeId         Int                @unique @map("unidade_id")
  descricao         String?
  qntdItens         Int                @default(0)
  criadoEm          DateTime           @default(now()) @map("criado_em")
  atualizadoEm      DateTime           @default(now()) @updatedAt @map("atualizado_em")
  unidade           Unidade            @relation(fields: [unidadeId], references: [id])
  estoqueMovimentos EstoqueMovimento[]
  estoqueProdutos   EstoqueProduto[]

  @@map("estoque")
}

model EstoqueProduto {
  id                  Int                @id @default(autoincrement())
  nome                String             @db.VarChar(255)
  sku                 String?            @db.VarChar(100)
  marca               String?            @db.VarChar(255)
  qntdAtual           Int                @default(0)
  qntdMin             Int                @default(0)
  estoqueId           Int
  produtoId           Int?
  producaoId          Int?
  loteId              Int?
  precoUnitario       Decimal?           @map("preco_unitario") @db.Decimal(12, 2)
  pesoUnidade         Decimal?           @db.Decimal(14, 3)
  validade            DateTime?
  unidadeBase         UnidadesDeMedida
  pedidoId            Int?
  pedidoItemId        Int?
  fornecedorUnidadeId Int?
  fornecedorExternoId Int?
  dataEntrada         DateTime?          @map("data_entrada")
  dataSaida           DateTime?          @map("data_saida")
  estoque             Estoque            @relation(fields: [estoqueId], references: [id])
  fornecedorExterno   FornecedorExterno? @relation("EstoqueProduto_fornecedorExterno", fields: [fornecedorExternoId], references: [id])
  fornecedorUnidade   Unidade?           @relation("EstoqueProduto_fornecedorUnidade", fields: [fornecedorUnidadeId], references: [id])
  lote                Lote?              @relation(fields: [loteId], references: [id])
  pedido              Pedido?            @relation(fields: [pedidoId], references: [id])
  pedidoItem          PedidoItem?        @relation(fields: [pedidoItemId], references: [id])
  producao            Producao?          @relation(fields: [producaoId], references: [id])
  produto             Produto?           @relation(fields: [produtoId], references: [id])
  itensVendas         ItemVenda[]

  @@unique([estoqueId, produtoId])
  @@index([produtoId])
  @@index([producaoId])
  @@map("estoque_produto")
}

model EstoqueMovimento {
  id               Int           @id @default(autoincrement())
  estoqueId        Int
  tipoMovimento    TipoMovimento
  quantidade       Int
  producaoId       Int?          @map("producao_id")
  pedidoId         Int?          @map("pedido_id")
  vendaId          Int?          @map("venda_id")
  origemUnidadeId  Int?          @map("origem_unidade_id")
  destinoUnidadeId Int?          @map("destino_unidade_id")
  data             DateTime      @default(now())
  destinoUnidade   Unidade?      @relation("DestinoMovimento", fields: [destinoUnidadeId], references: [id])
  estoque          Estoque       @relation(fields: [estoqueId], references: [id], onDelete: Cascade)
  origemUnidade    Unidade?      @relation("OrigemMovimento", fields: [origemUnidadeId], references: [id])
  pedido           Pedido?       @relation(fields: [pedidoId], references: [id])
  producao         Producao?     @relation(fields: [producaoId], references: [id])
  venda            Venda?        @relation(fields: [vendaId], references: [id])

  @@index([origemUnidadeId])
  @@index([destinoUnidadeId])
  @@index([data])
  @@index([estoqueId])
  @@index([producaoId])
  @@index([vendaId])
  @@index([pedidoId])
  @@map("estoque_movimentos")
}

model FornecedorExterno {
  id               Int              @id @default(autoincrement())
  unidadeId      Int?             @map("unidade_id")
  nomeEmpresa      String           @map("nome_empresa") @db.VarChar(200)
  descricaoEmpresa String           @map("descricao_empresa")
  cnpjCpf          String?          @unique @map("cnpj_cpf") @db.VarChar(20)
  email            String?          @db.VarChar(150)
  telefone         String           @db.VarChar(20)
  status           StatusFornecedor
  endereco         String?
  criadoEm         DateTime         @default(now()) @map("criado_em")
  atualizadoEm     DateTime         @default(now()) @updatedAt @map("atualizado_em")
  contratos        Contrato[]       @relation("ContratoFornecedorExterno")
  estoqueProdutos  EstoqueProduto[] @relation("EstoqueProduto_fornecedorExterno")
  pedidos          Pedido[]
  unidade          Unidade?         @relation("FornecedorExterno", fields: [unidadeId], references: [id])
  // produtosRecebidos Produto[]        @relation("FornecedorProdutosRecebidos")

  @@map("fornecedor_externo")
}

model Contrato {
  id                  Int                @id @default(autoincrement())
  unidadeId           Int                @map("unidade_id")
  fornecedorUnidadeId Int?               @map("fornecedor_unidade_id")
  fornecedorExternoId Int?               @map("fornecedor_externo_id")
  descricao          String?            @db.VarChar(500)
  dataInicio          DateTime           @map("data_inicio")
  dataFim             DateTime?          @map("data_fim")
  dataEnvio           DateTime?           @map("data_envio")
  status              StatusContrato
  frequenciaEntregas  FrequenciaEnum     @map("frequencia_entregas")
  diaPagamento        String             @map("dia_pagamento") @db.VarChar(100)
  formaPagamento      TipoPagamento      @map("forma_pagamento")
  valorTotal          Decimal?           @map("valor_total") @db.Decimal(12, 2)
  fornecedorExterno   FornecedorExterno? @relation("ContratoFornecedorExterno", fields: [fornecedorExternoId], references: [id], onDelete: Restrict)
  fornecedorInterno   Unidade?           @relation("ContratoFornecedorInterno", fields: [fornecedorUnidadeId], references: [id], onDelete: Restrict)
  unidade             Unidade            @relation("ContratoUnidade", fields: [unidadeId], references: [id])
  itens               ContratoItens[]    @relation("ContratoItens")
  lotes               Lote[]
  pedidos             Pedido[]

  @@index([status])
  @@index([dataInicio])
  @@index([dataFim])
  @@index([unidadeId])
  @@index([fornecedorUnidadeId])
  @@index([fornecedorExternoId])
  @@map("contrato")
}

model ContratoItens {
  id            Int               @id @default(autoincrement())
  contratoId    Int               @map("contrato_id")
  produtoId     Int               @map("produto_id")
  nome          String?           @db.VarChar(255)
  quantidade    Int
  unidadeMedida UnidadesDeMedida?

  contrato      Contrato          @relation("ContratoItens", fields: [contratoId], references: [id], onDelete: Cascade)
  produto       Produto           @relation(fields: [produtoId], references: [id])

  pedidoItems   PedidoItem[]

  @@index([contratoId])
  @@index([produtoId])

  @@unique([contratoId, produtoId]) // evita duplicar o mesmo produto no mesmo contrato

  @@map("contrato_itens")
}


model Pedido {
  id                        Int                @id @default(autoincrement())
  contratoId                Int?               @map("contrato_id")
  origemFornecedorExternoId Int?               @map("fornecedor_externo_id")
  origemUnidadeId           Int?               @map("origem_unidade_id")
  destinoUnidadeId          Int?               @map("destino_unidade_id")
  criadoPorId               Int?               @map("criado_por_id")
  dataPedido                DateTime           @default(now()) @map("data_pedido")
  dataEnvio                 DateTime?          @map("data_envio")
  dataRecebimento           DateTime?          @map("data_recebimento")
  status                    StatusPedido       @default(PENDENTE)
  valorTotal                Decimal?           @map("valor_total")
  documentoReferencia       String?            @map("documento_referencia")
  tipoTransporte            TipoTransporte?    @map("tipo_transporte")
  placaVeiculo              String?            @map("placa_veiculo")
  motorista                 String?            @map("motorista")
  observacoes               String?
  createdAt                 DateTime           @default(now())
  updatedAt                 DateTime           @updatedAt
  estoqueMovimentos         EstoqueMovimento[]
  estoqueProdutos           EstoqueProduto[]
  contrato                  Contrato?          @relation(fields: [contratoId], references: [id])
  criadoPor                 Usuario?           @relation("PedidoCriador", fields: [criadoPorId], references: [id])
  destinoUnidade            Unidade?           @relation("PedidoDestino", fields: [destinoUnidadeId], references: [id])
  fornecedorExterno         FornecedorExterno? @relation(fields: [origemFornecedorExternoId], references: [id])
  origemUnidade             Unidade?           @relation("PedidoOrigem", fields: [origemUnidadeId], references: [id])
  itens                     PedidoItem[]       @relation("PedidoItens")

  @@index([contratoId])
  @@index([origemFornecedorExternoId])
  @@index([origemUnidadeId])
  @@index([destinoUnidadeId])
  @@map("pedido")
}

model PedidoItem {
  id               Int              @id @default(autoincrement())
  pedidoId         Int              @map("pedido_id")
  fornecedorItemId Int?             @map("fornecedor_item_id")
  produtoId        Int?             @map("produto_id")
  insumoId         Int?             @map("insumo_id")
  loteId           Int?             @map("lote_id")
  quantidade       Decimal          @db.Decimal(14, 3)
  unidadeMedida    UnidadesDeMedida
  precoUnitario    Decimal?         @map("preco_unitario") @db.Decimal(12, 2)
  custoTotal       Decimal?         @map("custo_total") @db.Decimal(14, 2)
  observacoes      String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  estoqueProdutos  EstoqueProduto[]
  fornecedorItem   ContratoItens?   @relation(fields: [fornecedorItemId], references: [id])
  lote             Lote?            @relation(fields: [loteId], references: [id])
  pedido           Pedido           @relation("PedidoItens", fields: [pedidoId], references: [id], onDelete: Cascade)
  produto          Produto?         @relation(fields: [produtoId], references: [id])

  @@index([pedidoId])
  @@index([fornecedorItemId])
  @@index([produtoId])
  @@index([insumoId])
  @@index([loteId])
  @@map("pedido_item")
}

model Animal {
  id           Int            @id @default(autoincrement())
  especie       EspecieAnimal
  raca         String         @db.VarChar(100)
  sexo        SexoAnimal?
  sku          String         @unique @db.VarChar(50)
  dataNasc  DateTime?
  fornecedorId Int?
  peso        String?
  formaAquisicao TipoFormaAquisicao?
  // quantidade   Int
  // tipo         TipoAnimais
  custo        Decimal?
  unidadeId    Int
  loteId       Int?          @map("lote_id")
  lote         Lote?          @relation(fields: [loteId], references: [id])
  unidade      Unidade        @relation(fields: [unidadeId], references: [id])
  atvdAnimalia AtvdAnimalia[]
  producaos    Producao[]

  @@index([unidadeId])
  @@map("animal")
}

model Plantio {
  id                     Int        @id @default(autoincrement())
  categoria              String     @db.VarChar(100)
  areaHectares           Decimal    @map("area_hectares") @db.Decimal(10, 2)
  dataPlantio            DateTime?
  dataColheitaEstimativa DateTime?
  fornecedorId           Int?
  custo                  Decimal?   @db.Decimal(10, 2)
  unidadeId              Int
  loteId                 Int?       @map("lote_id")
  lote                   Lote?      @relation(fields: [loteId], references: [id])
  unidade                Unidade    @relation(fields: [unidadeId], references: [id])
  producaos              Producao[]

  @@index([unidadeId])
  @@index([categoria])
  @@map("plantio")
}

model AtvdAgricola {
  id            Int                @id @default(autoincrement())
  descricao     String
  tipo          TipoAtvd
  loteId        Int
  dataInicio    DateTime           @map("data_inicio")
  dataFim       DateTime?          @map("data_fim")
  responsavelId Int
  // status        StatusPlantacao
  status        StatusAtvd?
  lote          Lote               @relation(fields: [loteId], references: [id])
  responsavel   Usuario            @relation("UsuarioAtvdPlantio", fields: [responsavelId], references: [id])

  @@index([loteId])
  @@index([responsavelId])
  @@index([dataInicio])
  @@map("atvd_plantio")
}

model AtvdAnimalia {
  id            Int                @id @default(autoincrement())
  animalId      Int?                @map("animal_id")
  // insumoId      Int?               @map("insumo_id")
  descricao     String
  tipo          TipoAtividadeAnimalia?
  loteId        Int?               @map("lote_id")
  dataInicio    DateTime           @map("data_inicio")
  dataFim       DateTime?          @map("data_fim")
  responsavelId Int                @map("responsavel_id")
  status        StatusAtvd?
  animal        Animal?             @relation(fields: [animalId], references: [id])
  lote          Lote?              @relation(fields: [loteId], references: [id])
  responsavel   Usuario            @relation("UsuarioAtvdAnimalia", fields: [responsavelId], references: [id])

  @@index([loteId])
  @@index([animalId])
  // @@index([insumoId])
  @@index([responsavelId])
  @@index([dataInicio])
  @@map("atvd_animalia")
}

model Lote {
  id                     Int                   @id @default(autoincrement())
  unidadeId              Int                   @map("unidade_id")
  responsavelId          Int                   @map("responsavel_id")
  nome                   String                @db.VarChar(255)
  tipo                   TipoLote
  tipoProduto            TipoProduto?
  quantidade             Int?                  @map("quantidade")
  preco                  Decimal               @db.Decimal(10, 2)
  unidadeMedida          UnidadesDeMedida      @map("unidade_medida")
  observacoes            String?
  statusQualidade        StatusQualidade       @default(PROPRIO) @map("status_qualidade")
  bloqueadoParaVenda     Boolean               @default(false) @map("bloqueado_para_venda")
  status                 StatusLote?           @map("status_lote")
  dataCriacao           DateTime              @default(now()) @map("data_criacao")
  contratoId             Int?
  dataEnvioReferencia    DateTime?
  itensEsperados         Json?                 @map("itens_esperados")
  animals                Animal[]
  atvdAnimalia           AtvdAnimalia[]
  // atividadesLote         AtvdLote[]
  atvdAgricola           AtvdAgricola[]
  estoqueProdutos        EstoqueProduto[]
  contrato               Contrato?             @relation(fields: [contratoId], references: [id])
  responsavel            Usuario               @relation(fields: [responsavelId], references: [id])
  unidade                Unidade               @relation(fields: [unidadeId], references: [id])
  pedidoItems            PedidoItem[]
  plantios               Plantio[]
  producoes              Producao[]
  produto                Produto?
  rastreabilidadeDestino RastreabilidadeLote[] @relation("LoteDestino")
  rastreabilidadeOrigem  RastreabilidadeLote[] @relation("LoteOrigem")
  registrosSanitarios    RegistroSanitario[]

  @@index([unidadeId])
  @@index([responsavelId])
  @@index([statusQualidade])
  @@map("lote")
}

// rascunho/planejamento leve
model PlanoProducao {
  id           Int      @id @default(autoincrement())
  contratoId   Int?     @map("contrato_id")
  loteId       Int?     @map("lote_id")
  itemId       Int?     @map("item_id")
  usuarioId    Int?     @map("usuario_id")
  nome         String?  @db.VarChar(255)
  descricao    String?
  etapas       Json // array de objetos: { id, nome, descricao, duracaoDias, ordem, quantidadeEsperada, ... }
  status       String   @default("RASCUNHO") // RASCUNHO | CONFIRMADO
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@index([contratoId])
  @@index([itemId])
  @@map("plano_producao")
}

// etapas reais da produção
model ProducaoEtapa {
  id                 Int         @id @default(autoincrement())
  producaoId         Int         @map("producao_id")
  nome               String      @db.VarChar(255)
  descricao          String?
  ordem              Int
  duracaoDias        Int? // estimado
  dataPrevInicio     DateTime?   @map("data_prev_inicio")
  dataPrevFim        DateTime?   @map("data_prev_fim")
  dataRealInicio     DateTime?   @map("data_real_inicio")
  dataRealFim        DateTime?   @map("data_real_fim")
  quantidadeEsperada Decimal?    @map("quantidade_esperada") @db.Decimal(14, 3)
  quantidadeReal     Decimal?    @map("quantidade_real") @db.Decimal(14, 3)
  status             StatusEtapa @default(PLANEJADA)
  responsavelId      Int?        @map("responsavel_id")
  observacoes        String?
  custoMaoObra       Decimal?    @map("custo_mao_obra") @db.Decimal(14, 2)
  outrosCustos       Decimal?    @map("outros_custos") @db.Decimal(14, 2)
  custoTotal         Decimal?    @map("custo_total") @db.Decimal(14, 2)
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt

  // relações
  producao    Producao @relation("Producao_Etapas", fields: [producaoId], references: [id])
  responsavel Usuario? @relation("Usuario_ProducaoEtapa", fields: [responsavelId], references: [id])

  @@index([producaoId])
  @@map("producao_etapa")
}

model Producao {
  id                   Int              @id @default(autoincrement())
  loteId               Int              @map("lote_id")
  plantioId            Int?             @map("plantio_id")
  animalId             Int?             @map("animal_id")
  tipoProduto          String           @map("tipo_produto") @db.VarChar(255)
  produtoId            Int?             @map("produto_id")
  quantidadeBruta      Decimal          @map("quantidade_bruta") @db.Decimal(14, 3)
  quantidadeLiquida    Decimal?         @map("quantidade_liquida") @db.Decimal(14, 3)
  unidadeMedida        UnidadesDeMedida @map("unidade_medida")
  rendimentoPorHa      Decimal?         @map("rendimento_por_ha") @db.Decimal(12, 3)
  perdaPercent         Decimal?         @map("perda_percent") @db.Decimal(5, 3)
  custoMaoObra         Decimal?         @map("custo_mao_obra") @db.Decimal(14, 2)
  outrosCustos         Decimal?         @map("outros_custos") @db.Decimal(14, 2)
  custoTotal           Decimal?         @map("custo_total") @db.Decimal(14, 2)
  custoUnitario        Decimal?         @map("custo_unitario") @db.Decimal(14, 4)
  dataInicio           DateTime?        @map("data_inicio")
  dataFim              DateTime?        @map("data_fim")
  dataColheita         DateTime?        @map("data_colheita")
  dataRegistro         DateTime         @default(now()) @map("data_registro")
  status               StatusProducao   @default(PLANEJADA)
  metodo               MetodoProducao?  @map("metodo")
  responsavelId        Int?             @map("responsavel_id")
  certificadoSanitario String?          @map("certificado_sanitario") @db.VarChar(255)
  certificadoQualidade String?          @map("certificado_qualidade") @db.VarChar(255)
  destinoUnidadeId     Int?             @map("destino_unidade_id")
  destinoPedidoId      Int?             @map("destino_pedido_id")
  observacoes          String?
  documentoReferencia  String?          @map("documento_referencia") @db.VarChar(255)
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  unidadeId            Int?

  // relações
  estoqueMovimentos  EstoqueMovimento[]
  estoqueProdutos    EstoqueProduto[]
  animal             Animal?             @relation(fields: [animalId], references: [id])
  destinoUnidade     Unidade?            @relation("ProducaoDestino", fields: [destinoUnidadeId], references: [id])
  lote               Lote                @relation(fields: [loteId], references: [id])
  plantio            Plantio?            @relation(fields: [plantioId], references: [id])
  produto            Produto?            @relation(fields: [produtoId], references: [id])
  responsavel        Usuario?            @relation(fields: [responsavelId], references: [id])
  unidade            Unidade?            @relation(fields: [unidadeId], references: [id])
  registroSanitarios RegistroSanitario[]
  producaoEtapas     ProducaoEtapa[]     @relation("Producao_Etapas")

  @@index([loteId])
  @@index([plantioId])
  @@index([animalId])
  @@index([status])
  @@index([dataRegistro])
  @@map("producao")
}

model RegistroSanitario {
  id            Int                   @id @default(autoincrement())
  loteId        Int                   @map("lote_id")
  tipo          TipoRegistroSanitario
  producaoId    Int
  produto       String                @db.VarChar(255)
  dataAplicacao DateTime              @default(now()) @map("data_aplicacao")
  quantidade    Float?
  observacoes   String?
  lote          Lote                  @relation(fields: [loteId], references: [id])

  producao Producao @relation(fields: [producaoId], references: [id], onDelete: Cascade)

  @@index([loteId])
  @@index([producaoId])
  @@index([dataAplicacao])
  @@map("registros_sanitarios")
}

model AtvdLote {
  id            Int            @id @default(autoincrement())
  descricao     String
  tipo          AtividadesEnum
  loteId        Int
  data          DateTime
  responsavelId Int
  // lote          Lote           @relation(fields: [loteId], references: [id])
  responsavel   Usuario        @relation(fields: [responsavelId], references: [id])

  @@map("atvd_lote")
}

model RastreabilidadeLote {
  id            Int      @id @default(autoincrement())
  loteOrigemId  Int      @map("lote_origem_id")
  loteDestinoId Int      @map("lote_destino_id")
  descricao     String?  @db.VarChar(255)
  dataVinculo   DateTime @default(now()) @map("data_vinculo")
  loteDestino   Lote     @relation("LoteDestino", fields: [loteDestinoId], references: [id], onDelete: Cascade)
  loteOrigem    Lote     @relation("LoteOrigem", fields: [loteOrigemId], references: [id], onDelete: Cascade)

  @@map("rastreabilidade_lotes")
}

model Caixa {
  id           Int       @id @default(autoincrement())
  unidadeId    Int       @map("unidade_id")
  usuarioId    Int       @map("usuario_id")
  status       Boolean   @default(false)
  saldoInicial Decimal   @default(0) @map("saldo_inicial") @db.Decimal(12, 2)
  saldoFinal   Decimal?  @map("saldo_final") @db.Decimal(12, 2)
  abertoEm     DateTime  @map("aberto_em")
  fechadoEm    DateTime? @map("fechado_em")
  unidade      Unidade   @relation(fields: [unidadeId], references: [id])
  usuario      Usuario   @relation(fields: [usuarioId], references: [id])
  vendas       Venda[]

  @@index([unidadeId])
  @@index([usuarioId])
  @@index([abertoEm])
  @@index([status])
  @@map("caixa")
}

model Venda {
  id                Int                @id @default(autoincrement())
  nomeCliente       String?
  caixaId           Int                @map("caixa_id")
  usuarioId         Int                @map("usuario_id")
  unidadeId         Int                @map("unidade_id")
  total             Decimal            @db.Decimal(12, 2)
  pagamento         TipoPagamento
  status            StatusVenda
  criadoEm          DateTime           @default(now()) @map("criado_em")
  estoqueMovimentos EstoqueMovimento[]
  itens             ItemVenda[]
  caixa             Caixa              @relation(fields: [caixaId], references: [id])
  unidade           Unidade            @relation(fields: [unidadeId], references: [id])
  usuario           Usuario            @relation(fields: [usuarioId], references: [id])

  @@index([unidadeId])
  @@index([usuarioId])
  @@index([caixaId])
  @@index([criadoEm])
  @@map("venda")
}

model ItemVenda {
  id            Int            @id @default(autoincrement())
  vendaId       Int            @map("venda_id")
  produtoId     Int            @map("produto_id")
  quantidade    Int
  precoUnitario Decimal        @map("preco_unitario") @db.Decimal(12, 2)
  desconto      Decimal        @default(0) @db.Decimal(12, 2)
  subtotal      Decimal        @db.Decimal(12, 2)
  produto       EstoqueProduto @relation(fields: [produtoId], references: [id])
  venda         Venda          @relation(fields: [vendaId], references: [id], onDelete: Cascade)

  @@index([vendaId])
  @@index([produtoId])
  @@map("itens_vendas")
}

model Categoria {
  id            Int            @id @default(autoincrement())
  unidadeId     Int            @map("unidade_id")
  nome          String         @db.VarChar(255)
  tipo          TipoMovimento
  descricao     String?
  ativa         Boolean        @default(true)
  criadoEm      DateTime       @default(now()) @map("criado_em")
  atualizadoEm  DateTime       @default(now()) @updatedAt @map("atualizado_em")
  subcategorias Subcategoria[]
  financeiros   Financeiro[]
  unidade       Unidade        @relation(fields: [unidadeId], references: [id], onDelete: Cascade)

  @@unique([unidadeId, nome, tipo])
  @@index([unidadeId])
  @@index([tipo])
  @@index([ativa])
  @@map("categoria")
}

model Subcategoria {
  id           Int          @id @default(autoincrement())
  categoriaId  Int          @map("categoria_id")
  nome         String       @db.VarChar(255)
  descricao    String?
  ativa        Boolean      @default(true)
  criadoEm     DateTime     @default(now()) @map("criado_em")
  atualizadoEm DateTime     @default(now()) @updatedAt @map("atualizado_em")
  categoria    Categoria    @relation(fields: [categoriaId], references: [id], onDelete: Cascade)
  financeiros  Financeiro[]

  @@unique([categoriaId, nome])
  @@index([categoriaId])
  @@index([ativa])
  @@map("subcategoria")
}

model Financeiro {
  id             Int           @id @default(autoincrement())
  unidadeId      Int           @map("unidade_id")
  categoriaId    Int?          @map("categoria_id")
  subcategoriaId Int?          @map("subcategoria_id")
  criadoPorId    Int?          @map("criado_por_id")
  descricao      String
  tipoMovimento  TipoMovimento @map("tipo_movimento")
  formaPagamento String?       @map("forma_pagamento")
  valor          Decimal       @db.Decimal(12, 2)
  valorPago      Decimal?      @map("valor_pago") @db.Decimal(12, 2)
  competencia    DateTime?
  vencimento     DateTime
  dataPagamento  DateTime?     @map("data_pagamento")
  parcela        Int?
  totalParcelas  Int?          @map("total_parcelas")
  status         ContaStatus   @default(PENDENTE)
  documento      String?
  observacao     String?
  anexo          String?
  criadoEm       DateTime      @default(now()) @map("criado_em")
  atualizadoEm   DateTime      @default(now()) @updatedAt @map("atualizado_em")
  deletadoEm     DateTime?     @map("deletado_em")
  categoria      Categoria?    @relation(fields: [categoriaId], references: [id], onDelete: SetNull)
  subcategoria   Subcategoria? @relation(fields: [subcategoriaId], references: [id], onDelete: SetNull)
  unidade        Unidade       @relation(fields: [unidadeId], references: [id], onDelete: Cascade)
  criadoPor      Usuario?      @relation(fields: [criadoPorId], references: [id], onDelete: SetNull)

  @@index([competencia])
  @@index([status])
  @@index([tipoMovimento])
  @@index([unidadeId])
  @@index([criadoPorId])
  @@index([vencimento])
  @@index([categoriaId])
  @@index([subcategoriaId])
  @@map("financeiro")
}

enum ContaStatus {
  PENDENTE
  PAGA
  VENCIDA
  CANCELADA
}

enum TipoPerfil {
  GERENTE_MATRIZ
  GERENTE_FAZENDA
  GERENTE_LOJA
  FUNCIONARIO_LOJA
  FUNCIONARIO_FAZENDA
}

enum TipoUnidade {
  MATRIZ
  FAZENDA
  LOJA

  @@map("tipo_unidade")
}

enum TipoProduto {
  PLANTIO
  ANIMALIA
}

enum TipoLote {
  
  SOJA
  LEITE
  BOVINOS
  SUINOS
  OVINOS
  AVES
  EQUINO
  CAPRINOS
  OUTRO
  LEGUME
  FRUTA
  VERDURA
  GRÃOS
  PLANTIO

  @@map("tipo_lote")
}

enum TipoRegistroSanitario {
  VACINA
  MEDICACAO
  RACAO
  OUTRO

  @@map("tipo_registro_sanitario")
}

enum TipoPagamento {
  DINHEIRO
  CARTAO
  PIX

  @@map("tipo_pagamento")
}

enum TipoSaida {
  ALUGUEL
  AGUA
  ENERGIA
  MANUTENCAO
  SALARIOS
  ESTOQUE
}

enum AtividadesEnum {
  PLANTIO
  ADUBACAO
  FERTILIZACAO
}

enum StatusContrato {
  ATIVO
  INATIVO
}

enum FrequenciaEnum {
  SEMANALMENTE
  QUINZENAL
  MENSALMENTE
  SEMESTRAL
  TRIMESTRAL
}

enum UnidadesDeMedida {
  KG
  G
  T
  LOTE
  UNIDADE
  SACA
  CABECA
  ARROBA
  LITRO
  ML
}

enum StatusUnidade {
  ATIVA
  INATIVA
  MANUTENCAO
}

enum StatusQualidade {
  PROPRIO
  ALERTA
  IMPROPRIO

  @@map("status_qualidade")
}

enum TipoAtividadeAnimalia {
  // --- Sanidade ---
  VACINACAO
  VERMIFUGACAO
  TRATAMENTO
  SANIDADE_GERAL

  // --- Nutrição ---
  NUTRICAO
  SUPLEMENTACAO
  AJUSTE_DIETA

  // --- Reprodução ---
  INSEMINACAO
  MONITORAMENTO_GESTACAO
  PARTO
  SECAGEM

  // --- Manejo geral ---
  MANEJO_GERAL
  MOVIMENTACAO_INTERNA
  PESAGEM

  // --- Ordenha (para gado leiteiro) ---
  ORDENHA_DIARIA

  // --- Higiene e ambiente ---
  HIGIENIZACAO_AMBIENTE
  BANHO

  // --- Gestão de animais ---
  RECEBIMENTO
  TRANSFERENCIA
  VENDA_ANIMAL
  BAIXA_ANIMAL
  ABATE
  OCORRENCIA
}

enum SexoAnimal {
  MACHO
  FEMEA
}

enum TipoFormaAquisicao {
  COMPRA
  TRANSFERENCIA
  DOACAO
  NATURAL
  OUTRO
}

enum EspecieAnimal {
  BOVINO
  BUBALINO
  CAPRINO
  OVINO
  SUINO
  EQUINO
  MUAR
  AVE
  GALINHA
  PERU
  PATO
  MARRECO
  GANSO
  CODORNA
  COELHO
  PEIXE
  CAMARAO
  ABELHA
  OUTRO
}

enum TipoAnimais {
  ABATE
  VENDA
  REPRODUCAO
  ORDENHA
}

enum TipoMovimento {
  ENTRADA
  SAIDA
}

enum StatusFornecedor {
  ATIVO
  INATIVO
}

enum StatusVenda {
  OK
  A_RETIRAR
  CANCELADO
}

// enum StatusPlantacao {
//   EM_DESENVOLVIMENTO
//   COLHIDO
//   EM_PREPARO
//   SEMEADO
// }

enum StatusAtvdAnimalia {
  ATIVA
  INATIVA
  SUSPENSA
  CONCLUIDA
}

enum StatusProducao {
  PLANEJADA
  EM_ANDAMENTO
  FINALIZADA
  CANCELADA
  EM_ANALISE
}

enum MetodoProducao {
  MECANIZADA
  MANUAL
  INDUSTRIAL
  MISTA
}

enum CategoriaInsumo {
  SEMENTE
  FERTILIZANTE
  DEFENSIVO
  RACAO
  MEDICAMENTO
  SUPLEMENTO
  VACINA
  OUTROS
}

enum StatusPedido {
  PENDENTE
  ENVIADO
  EM_TRANSITO
  ENTREGUE
  CANCELADO
}

enum TipoTransporte {
  RODOVIARIO
  FERROVIARIO
  AEREO
  FLUVIAL
  INTERNO
  OUTRO
}

enum TipoAtvd {
  IRRIGACAO
  ADUBACAO
  USO_AGROTOXICO
  PLANTIO
  COLHEITA
  FERTILIZACAO
  OUTRO
}

enum StatusAtvd {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDA
  CANCELADA
}

enum StatusLote {
  //STATUS CASO FOR PLANTA
  SEMEADO // Plantio feito, início do ciclo
  CRESCIMENTO // Plantas em desenvolvimento
  COLHEITA // Lote em processo de colheita
  COLHIDO // Colheita finalizada
  //STATUS CASO FOR ANIMAL
  RECEBIDO // Animais chegaram no lote
  EM_QUARENTENA //Período inicial para avaliação sanitária.
  AVALIACAO_SANITARIA //Veterinário analisando condições gerais, peso, saúde etc.
  EM_CRESCIMENTO // Animais em crescimento 
  EM_ENGORDA // Animais em fase de engorda
  EM_REPRODUCAO // Lote destinado para produção de novos animais.
  LACTAÇÃO // Lote em fase de produção de leite
  ABATE // Lote em processo de abate ou envio
  //GERAL (serve pros dois)
  PENDENTE // Lote criado, aguardando início das operações
  PRONTO // Lote pronto para venda ou envio
  BLOQUEADO // Lote indisponível, bloqueado para operação ou venda
  VENDIDO // Animais vendidos ou enviados
  //vou apagar depois
  
  ENVIADO
  EM_PREPARO
}

enum StatusEtapa {
  PLANEJADA
  EM_ANDAMENTO
  CONCLUIDA
  CANCELADA
  BLOQUEADA
}
