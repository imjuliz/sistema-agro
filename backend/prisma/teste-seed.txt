import bcrypt from "bcryptjs";
import { configDotenv } from "dotenv";
configDotenv();
import prisma from "./client.js";
import * as pkg from "@prisma/client"; // mais seguro que named imports

// Extrai enums (podem ficar undefined se seu schema não os exportar)
const { TipoPerfil, TipoUnidade, TipoLote, TipoRegistroSanitario, TipoPagamento, TipoSaida, AtividadesEnum, StatusContrato, FrequenciaEnum, UnidadesDeMedida, tipoTransporte, StatusUnidade, StatusFornecedor, StatusQualidade, TipoMovimento, TipoAtvd, TipoAnimais, StatusVenda, StatusAtvdAnimalia, TipoAnimalia } = pkg;

// fallback simples caso enums não sejam exportados
const TP = TipoPerfil ?? {
    GERENTE_MATRIZ: "GERENTE_MATRIZ",
    GERENTE_FAZENDA: "GERENTE_FAZENDA",
    GERENTE_LOJA: "GERENTE_LOJA",
    FUNCIONARIO_LOJA: "FUNCIONARIO_LOJA",
    FUNCIONARIO_FAZENDA: "FUNCIONARIO_FAZENDA"
};

const TU = TipoUnidade ?? { MATRIZ: "MATRIZ", FAZENDA: "FAZENDA", LOJA: "LOJA" };
const TL = TipoLote ?? { GADO: "GADO", SOJA: "SOJA", LEITE: "LEITE", OUTRO: "OUTRO" };
const TRS = TipoRegistroSanitario ?? { VACINA: "VACINA", MEDICACAO: "MEDICACAO", RACAO: "RACAO", OUTRO: "OUTRO" };
const TPAG = TipoPagamento ?? { DINHEIRO: "DINHEIRO", CARTAO: "CARTAO", PIX: "PIX" };
const TSAIDA = TipoSaida ?? { ALUGUEL: "ALUGUEL", AGUA: "AGUA", ENERGIA: "ENERGIA", MANUTENCAO: "MANUTENCAO", SALARIOS: "SALARIOS", ESTOQUE: "ESTOQUE" };
const TAT = AtividadesEnum ?? { PLANTIO: "PLANTIO", ADUBACAO: "ADUBACAO", FERTILIZACAO: "FERTILIZACAO" };
const SCON = StatusContrato ?? { ATIVO: "ATIVO", INATIVO: "INATIVO" };
const FREQ = FrequenciaEnum ?? { SEMANALMENTE: "SEMANALMENTE", QUINZENAL: "QUINZENAL", MENSALMENTE: "MENSALMENTE", SEMESTRAL: "SEMESTRAL" };
const UMED = UnidadesDeMedida ?? { KG: "KG", UNIDADE: "UNIDADE", LITRO: "LITRO", SACA: "SACA", G: "G", ML: 'ML', CABECA: 'CABECA' };
const SUNI = StatusUnidade ?? { ATIVA: "ATIVA", INATIVA: "INATIVA", MANUTENCAO: "MANUTENCAO" };
const SF = StatusFornecedor ?? { ATIVO: "ATIVO", INATIVO: "INATIVO" };
const SQ = StatusQualidade ?? { PROPRIO: "PROPRIO", ALERTA: "ALERTA", IMPROPRIO: "IMPROPRIO" };
const TM = TipoMovimento ?? { ENTRADA: "ENTRADA", SAIDA: "SAIDA" };
const TATV = TipoAtvd ?? { IRRIGACAO: "IRRIGACAO", ADUBACAO: "ADUBACAO", USO_AGROTOXICO: "USO_AGROTOXICO", PLANTIO: "PLANTIO", COLHEITA: "COLHEITA" };
const TAN = TipoAnimais ?? { ABATE: "ABATE", VENDA: "VENDA", REPRODUCAO: "REPRODUCAO" };
const TS = StatusVenda ?? { OK: "OK", A_RETIRAR: "A_RETIRAR", CANCELADO: "CANCELADO" };
const TTRANS = tipoTransporte ?? { RODOVIARIO: "RODOVIARIO", FERROVIARIO: "FERROVIARIO", AEREO: "AEREO", FLUVIAL: "FLUVIAL", INTERNO: "INTERNO", OUTRO: "OUTRO" }
const SATVDA = StatusAtvdAnimalia ?? { ATIVA: "ATIVA", INATIVA: "INATIVA", SUSPENSA: "SUSPENSA", CONCLUIDA: "CONCLUIDA" }
const TANIMALIA = TipoAnimalia ?? { VACINACAO: "VACINACAO", VERMIFUGACAO: "VERMIFUGACAO", ANTIBIOTICO: "ANTIBIOTICO", TESTE_TUBERCULOSE: "TESTE_TUBERCULOSE", TESTE_BRUCELOSE: "TESTE_BRUCELOSE", SANIDADE_GERAL: "SANIDADE_GERAL", NUTRICAO: "NUTRICAO", SUPLEMENTACAO: "SUPLEMENTACAO", CONSUMO_RACAO: "CONSUMO_RACAO", AJUSTE_DIETA: "AJUSTE_DIETA", INSEMINACAO: "INSEMINACAO", MONITORAMENTO_CIO: "MONITORAMENTO_CIO", MONITORAMENTO_GESTACAO: "MONITORAMENTO_GESTACAO", PARTO: "PARTO", SECAGEM: "SECAGEM", TOURO_MANEJO: "TOURO_MANEJO", MANEJO_GERAL: "MANEJO_GERAL", MANEJO_PESAGEM: "MANEJO_PESAGEM", MANEJO_CARREIRA: "MANEJO_CARREIRA", MOVIMENTACAO_INTERNA: "MOVIMENTACAO_INTERNA", SEPARACAO_LOTE: "SEPARACAO_LOTE", ORDENHA_TESTE: "ORDENHA_TESTE", ORDENHA_DIARIA: "ORDENHA_DIARIA", COLETA_LEITE_AMOSTRA: "COLETA_LEITE_AMOSTRA", AVALIACAO_MASTITE: "AVALIACAO_MASTITE", RECEBIMENTO: "RECEBIMENTO", TRANSFERENCIA: "TRANSFERENCIA", VENDA_ANIMAL: "VENDA_ANIMAL", BAIXA_ANIMAL: "BAIXA_ANIMAL", BANHO: "BANHO", HIGIENIZACAO_AMBIENTE: "HIGIENIZACAO_AMBIENTE", TRATAMENTO_PE: "TRATAMENTO_PE", CURATIVO: "CURATIVO", OCORRENCIA: "OCORRENCIA", TRATAMENTO_URGENCIA: "TRATAMENTO_URGENCIA" };
// npx prisma db seed
async function main() {
    try {
        console.log("Conectando ao banco...");
        await prisma.$connect();

        // // ===== Limpeza (ordem pensada para FK) =====
        console.log("Limpando dados antigos...");
        await prisma.itemVenda.deleteMany({});
        await prisma.venda.deleteMany({});
        await prisma.caixa.deleteMany({});
        await prisma.estoque.deleteMany({});
        await prisma.produtoFornecedor.deleteMany({});
        await prisma.fornecedorExterno.deleteMany({});
        await prisma.contratos.deleteMany({});
        await prisma.registroSanitario.deleteMany({});
        await prisma.rastreabilidadeLote.deleteMany({});
        await prisma.producao.deleteMany({});
        await prisma.atividadesLote.deleteMany({});
        await prisma.produto.deleteMany({});
        await prisma.lote.deleteMany({});
        await prisma.saidas.deleteMany({});
        await prisma.sessao.deleteMany({});
        await prisma.resetSenha.deleteMany({});
        await prisma.usuario.deleteMany({});
        await prisma.unidade.deleteMany({});
        await prisma.perfil.deleteMany({});
        console.log("Limpeza concluída");

        // ===== Perfis =====
        console.log("Criando perfis...");
        const perfis = await prisma.perfil.createMany({
            data: [
                { funcao: TP.GERENTE_MATRIZ, descricao: "Gerente da matriz ou administração central" },
                { funcao: TP.GERENTE_FAZENDA, descricao: "Gerente responsável pela fazenda" },
                { funcao: TP.GERENTE_LOJA, descricao: "Gerente responsável pela loja ou filial" },
                { funcao: TP.FUNCIONARIO_LOJA, descricao: "Funcionário da loja" },
                { funcao: TP.FUNCIONARIO_FAZENDA, descricao: "Funcionário da fazenda" }
            ],
            skipDuplicates: true,
        });
        console.log("Perfis criados.");

        // Buscar perfis para map
        const perfisDb = await prisma.perfil.findMany();
        const perfilMap = Object.fromEntries(perfisDb.map(p => [String(p.funcao), p.id]));

        // // ===== Unidades =====
        console.log("Criando unidades...");
        const unidadesData = [
            { nome: "RuralTech", endereco: "Av. Empresarial, 1000", tipo: TU.MATRIZ, cidade: "São Paulo", estado: "SP", cep: "01000-000", latitude: -23.55052, longitude: -46.633308, cnpj: "12345678000101", email: "ruraltech91@gmail.com", telefone: "1140000001", status: SUNI.ATIVA, },
            { nome: "VerdeFresco Hortaliças", endereco: "Av. Central, 1", tipo: TU.LOJA, cidade: "São Paulo", estado: "SP", cep: "01001-001", latitude: -23.5450, longitude: -46.6340, cnpj: "12345678000202", email: "lojacentral@empresa.com", telefone: "1140000002", horarioAbertura: new Date('1970-01-01T09:00:00Z'), horarioFechamento: new Date('1970-01-01T19:00:00Z'), status: SUNI.ATIVA, },
            { nome: "AgroBoi", endereco: "Rua Norte, 23", tipo: TU.LOJA, cidade: "Guarulhos", estado: "SP", cep: "07010-000", latitude: -23.4628, longitude: -46.5333, cnpj: "12345678000303", email: "lojanorte@empresa.com", telefone: "1140000003", horarioAbertura: new Date('1970-01-01T09:00:00Z'), horarioFechamento: new Date('1970-01-01T18:00:00Z'), status: SUNI.ATIVA, },
            { nome: "Casa Útil Mercado", endereco: "Av. Sul, 45", tipo: TU.LOJA, cidade: "Santo André", estado: "SP", cep: "09010-000", latitude: -23.6639, longitude: -46.5361, cnpj: "12345678000404", email: "lojasul@empresa.com", telefone: "1140000004", horarioAbertura: new Date('1970-01-01T10:00:00Z'), horarioFechamento: new Date('1970-01-01T20:00:00Z'), status: SUNI.ATIVA, },
            { nome: "Sabor do Campo Laticínios", endereco: "Praça Leste, 10", tipo: TU.LOJA, cidade: "São Bernardo", estado: "SP", cep: "09810-000", latitude: -23.6916, longitude: -46.5644, cnpj: "12345678000505", email: "lojaleste@empresa.com", telefone: "1140000005", horarioAbertura: new Date('1970-01-01T09:30:00Z'), horarioFechamento: new Date('1970-01-01T19:30:00Z'), status: SUNI.ATIVA, },
            { nome: "Fazenda Alpha", endereco: "Rod. BR-101, km 100", tipo: TU.FAZENDA, cidade: "Campinas", estado: "SP", cep: "13010-000", areaTotal: 1500.5, areaProdutiva: 1200.3, latitude: -22.9099, longitude: -47.0626, cnpj: "12345678100110", email: "fazendaalpha@empresa.com", telefone: "1930001001", status: SUNI.ATIVA, },
            { nome: "Fazenda Gamma", endereco: "Rod. BR-101, km 150", tipo: TU.FAZENDA, cidade: "Ribeirão Preto", estado: "SP", cep: "14010-000", areaTotal: 980.75, areaProdutiva: 760.0, latitude: -21.1775, longitude: -47.8103, cnpj: "12345678100220", email: "fazendabeta@empresa.com", telefone: "1630001002", status: SUNI.ATIVA, },
            { nome: "Fazenda Beta", endereco: "Estrada Rural, 77", tipo: TU.FAZENDA, cidade: "Piracicaba", estado: "SP", cep: "13400-000", areaTotal: 420.0, areaProdutiva: 365.25, latitude: -22.7127, longitude: -47.6476, cnpj: "12345678100330", email: "fazendagamma@empresa.com", telefone: "1930001003", status: SUNI.ATIVA, },
            { nome: "Fazenda Delta", endereco: "Estrada Rural, 88", tipo: TU.FAZENDA, cidade: "Limeira", estado: "SP", cep: "13480-000", areaTotal: 600.0, areaProdutiva: 480.5, latitude: -22.5641, longitude: -47.4019, cnpj: "12345678100440", email: "fazendadelta@empresa.com", telefone: "1930001004", status: SUNI.ATIVA, },
            { nome: "Fazenda Teste", endereco: "Rua Teste, 9", tipo: TU.FAZENDA, cidade: "Itu", estado: "SP", cep: "13300-000", areaTotal: 50.0, areaProdutiva: 40.0, latitude: -23.2646, longitude: -47.2995, cnpj: "12345678100550", email: "teste@empresa.com", telefone: "1140000099", status: SUNI.ATIVA, },
            { nome: "Loja Teste", endereco: "Av. Caetano Limeira, 2205", tipo: TU.LOJA, cidade: "Atibaia", estado: "SP", cep: "04610-000", latitude: -23.6639, longitude: -46.5361, cnpj: "12345678951244", email: "teste.loja@empresa.com", telefone: "1145003151", horarioAbertura: new Date('1970-01-01T10:00:00Z'), horarioFechamento: new Date('1970-01-01T20:00:00Z'), status: SUNI.ATIVA, },
        ];
        await prisma.unidade.createMany({ data: unidadesData, skipDuplicates: true });
        const unidades = await prisma.unidade.findMany();
        const unidadeMap = Object.fromEntries(unidades.map(u => [u.nome, u.id]));
        const lojas = unidades.filter(u => u.tipo === TU.LOJA);
        const fazendas = unidades.filter(u => u.tipo === TU.FAZENDA);
        console.log("Unidades criadas:", unidades.length);

        // ===== Usuários =====
        console.log("Criando usuários...");
        const senhaHash = await bcrypt.hash("123456", 10);

        const usuariosRuralTech = [
            { nome: "Julia Alves", email: "juliaalvesdeo447@gmail.com", senha: senhaHash, telefone: "11987651001", perfilId: perfilMap["GERENTE_MATRIZ"], unidadeId: unidadeMap["RuralTech"], status: true },
            { nome: "Lorena Oshiro", email: "lorenaoshiro2007@gmail.com", senha: senhaHash, telefone: "11987652001", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["Sabor do Campo Laticínios"], status: true },
            { nome: "Maria Del Rey", email: "mebdelrey@gmail.com", senha: senhaHash, telefone: "11987653001", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["Casa Útil Mercado"], status: true },
            { nome: "Richard Souza", email: "richardrrggts@gmail.com", senha: senhaHash, telefone: "11916694683", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Beta"], status: true },
        ]
        const usuariosFicticios = [
            // gerente da loja
            { nome: "Bruna Carvalho", email: "bru.carvalho@gmail.com", senha: senhaHash, telefone: "11988821353", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["Fazenda Beta"], status: true },
            { nome: "Roberto Barros", email: "robertbarros01@gmail.com", senha: senhaHash, telefone: "11916683574", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["VerdeFresco Hortaliças"], status: true },
            { nome: "Renato Martins", email: "renato.martins@gmail.com", senha: senhaHash, telefone: "11944556677", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["Loja Teste"], status: true },
            // funcionarios da loja
            { nome: "Mariana Coelho", email: "mari.coelho@gmail.com", senha: senhaHash, telefone: "1199637392", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["Loja Teste"], status: true },
            { nome: "Jonatas Silva", email: "jonatas91silva@gmail.com", senha: senhaHash, telefone: "11958251620", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["VerdeFresco Hortaliças"], status: true },
            { nome: "Alice Chagas", email: "chagas.alice@gmail.com", senha: senhaHash, telefone: "11953821185", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["AgroBoi"], status: true },
            { nome: "Marco Lucca Costa", email: "lucca.costa@gmail.com", senha: senhaHash, telefone: "11942221116", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["Casa Útil Mercado"], status: true },
            { nome: "Lúcia Mello", email: "luciamello11@gmail.com", senha: senhaHash, telefone: "1190086499", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["Sabor do Campo Laticínios"], status: true },
            // funcionarios da fazenda
            { nome: "Bruno Tavares", email: "bruno.tavares@gmail.com", senha: senhaHash, telefone: "11987654321", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Teste"], status: true },
            { nome: "Camila Duarte", email: "camila.duarte@gmail.com", senha: senhaHash, telefone: "11999887766", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Gamma"], status: true },
            { nome: "Eduardo Lima", email: "edu.lima@gmail.com", senha: senhaHash, telefone: "11988776655", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Delta"], status: true },
            { nome: "Fernanda Rocha", email: "fernanda.rocha@gmail.com", senha: senhaHash, telefone: "11977665544", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Alpha"], status: true },
            { nome: "Rafael Nunes", email: "rafael.nunes@gmail.com", senha: senhaHash, telefone: "11966554433", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Beta"], status: true },
            // gerentes de fazenda
            { nome: "Usuario Ficticio", email: "user.teste@gmail.com", senha: senhaHash, telefone: "11995251689", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Teste"], status: true },
            { nome: "Otávio Viana", email: "otavio.viana89@gmail.com", senha: senhaHash, telefone: "11999215361", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Gamma"], status: true },
            { nome: "Kátia Oliveira", email: "oliveirakatia09@gmail.com", senha: senhaHash, telefone: "11924245261", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Delta"], status: true },
            { nome: "Juliana Correia", email: "correiajuh@gmail.com", senha: senhaHash, telefone: "11958283626", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Alpha"], status: true },

        ];
        await prisma.usuario.createMany({ data: usuariosFicticios, skipDuplicates: true });
        await prisma.usuario.createMany({ data: usuariosRuralTech, skipDuplicates: true });
        const usuarios = await prisma.usuario.findMany();
        const usuarioMap = Object.fromEntries(usuarios.map(u => [u.nome, u.id]));
        console.log("Usuários criados.");

        // ===== ATUALIZAR UNIDADES COM gerenteId =====
        console.log("Ajustando gerenteId nas unidades...");

        await prisma.unidade.update({
            where: { id: unidadeMap["RuralTech"] },
            data: { gerenteId: usuarioMap["Julia Alves"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Teste"] },
            data: { gerenteId: usuarioMap["Usuario Ficticio"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Sabor do Campo Laticínios"] },
            data: { gerenteId: usuarioMap["Lorena Oshiro"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Gamma"] },
            data: { gerenteId: usuarioMap["Otávio Viana"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Beta"] },
            data: { gerenteId: usuarioMap["Richard Souza"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Delta"] },
            data: { gerenteId: usuarioMap["Kátia Oliveira"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Casa Útil Mercado"] },
            data: { gerenteId: usuarioMap["Maria Del Rey"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["AgroBoi"] },
            data: { gerenteId: usuarioMap["Bruna Carvalho"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["VerdeFresco Hortaliças"] },
            data: { gerenteId: usuarioMap["Roberto Barros"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Alpha"] },
            data: { gerenteId: usuarioMap["Juliana Correia"] },
        });

        console.log("gerenteId configurado para todas as unidades.");

        // ===== Fornecedores =====
        console.log("Criando fornecedores...");
        const fornecedores = [
            // fazenda alpha
            {
                nomeEmpresa: "AgroFornecimentos Ltda",
                descricaoEmpresa: "Fornece rações e insumos",
                cnpjCpf: "12345678000190",
                email: "contato@agrofornece.com",
                telefone: "11999001122",
                endereco: "Rua do Agronegócio, 100",
                status: SF.ATIVO,
                // unidadeId: unidadeMap["Fazenda Alpha"],
            },
            {
                nomeEmpresa: "NutriBov Distribuidora",
                descricaoEmpresa: "Distribuição de ração bovina e suplementos",
                cnpjCpf: "10111213000144",
                email: "vendas@nutribov.com",
                telefone: "11988882211",
                endereco: "Rua NutriBov, 123",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "BovinoPrime Reprodutores",
                descricaoEmpresa: "Fornecimento de gado de corte e reprodutores certificados, com seleção genética.",
                cnpjCpf: "23242526000177",
                email: "comercial@bovinoprime.com.br",
                telefone: "11993004567",
                endereco: "Rod. Rural BR-050, km 200, Galpão 3",
                status: SF.ATIVO,
            },
            // fazenda gamma
            {
                nomeEmpresa: "Sementes Brasil",
                descricaoEmpresa: "Venda de sementes selecionadas",
                cnpjCpf: "11121314000155",
                email: "contato@sementesbrasil.com",
                telefone: "19997773344",
                endereco: "Av. Sementes, 200",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "AgroGrãos Comercial",
                descricaoEmpresa: "Comercialização de farelos e grãos",
                cnpjCpf: "12131415000166",
                email: "vendas@agrograos.com",
                telefone: "21996664455",
                endereco: "Rua Grãos, 50",
                status: SF.ATIVO,
            },
            // fazenda delta
            {
                nomeEmpresa: "FertSul Distribuição",
                descricaoEmpresa: "Distribuição de fertilizantes e corretivos",
                cnpjCpf: "13141516000177",
                email: "contato@fertsul.com",
                telefone: "51995555566",
                endereco: "Av. Fertilizantes, 300",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "BioInsumos Ltda",
                descricaoEmpresa: "Produtos biológicos e microbianos",
                cnpjCpf: "14151617000188",
                email: "contato@bioinsumos.com",
                telefone: "51994446677",
                endereco: "Rua Bio, 77",
                status: SF.ATIVO,
            },
            // fazenda beta
            {
                nomeEmpresa: "AgroLácteos Suprimentos",
                descricaoEmpresa: "Insumos para laticínios: coalho, culturas lácteas, consumíveis de processo e embalagens.",
                cnpjCpf: "15161718000199",
                email: "vendas@agrolacteos.com",
                telefone: "11993334455",
                endereco: "Av. Laticínios, 45",
                status: SF.ATIVO,
                // unidadeId: null // fornecedor externo
            },
            {
                nomeEmpresa: "Lácteos & Tecnologia Ltda",
                descricaoEmpresa: "Fornece starter cultures, enzimas, embalagens térmicas e equipamentos de pequeno porte para produção de queijo e iogurte.",
                cnpjCpf: "16171819000100",
                email: "contato@lacteostec.com.br",
                telefone: "11992223344",
                endereco: "Rua do Leite, 200",
                status: SF.ATIVO,
                // unidadeId: null
            },
            {
                nomeEmpresa: "AgroBov Genetics",
                descricaoEmpresa: "Fornecedor de animais reprodutores, touros de alto desempenho e serviços de inseminação artificial.",
                cnpjCpf: "17181920000111",
                email: "contato@agrobovgenetics.com.br",
                telefone: "11991112233",
                endereco: "Estrada da Cria, 500",
                status: SF.ATIVO,
                // unidadeId: null
            },
            {
                nomeEmpresa: "VetBov Serviços e Insumos",
                descricaoEmpresa: "Vacinas, medicamentos veterinários, assistência técnica e serviços de saúde animal.",
                cnpjCpf: "18192021000122",
                email: "vendas@vetbov.com.br",
                telefone: "11994445566",
                endereco: "Rua Veterinária, 77",
                status: SF.ATIVO,
                // unidadeId: null
            },
            // unidade teste
            {
                nomeEmpresa: "PastosVerde Nutrição Animal",
                descricaoEmpresa: "Produção e fornecimento de silagem, feno e suplementos minerais para bovinos.",
                cnpjCpf: "19192122000133",
                email: "contato@pastosverde.com.br",
                telefone: "11993332211",
                endereco: "Rodovia Rural, km 12",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "GenBov Melhoramento Genético",
                descricaoEmpresa: "Serviços de melhoramento genético, inseminação artificial e fornecimento de animais reprodutores.",
                cnpjCpf: "20212223000144",
                email: "vendas@genbov.com.br",
                telefone: "11992221100",
                endereco: "Estrada da Pecuária, 88",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "AgroVet Saúde Animal",
                descricaoEmpresa: "Medicamentos veterinários, vacinas e kits de diagnóstico para rebanhos bovinos.",
                cnpjCpf: "21222324000155",
                email: "contato@agrovetsaude.com.br",
                telefone: "11991114455",
                endereco: "Av. Veterinária, 300",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "CampoForte Equipamentos",
                descricaoEmpresa: "Equipamentos para manejo de gado: balanças, troncos de contenção e bebedouros automáticos.",
                cnpjCpf: "22232425000166",
                email: "suporte@campoforte.com.br",
                telefone: "11990002233",
                endereco: "Rua Agroindústria, 150",
                status: SF.ATIVO,
            },
        ];
        await prisma.fornecedorExterno.createMany({ data: fornecedores, skipDuplicates: true });
        const fornecedoresDb = await prisma.fornecedorExterno.findMany();
        const fornecedorMap = Object.fromEntries(fornecedoresDb.map(f => [f.nomeEmpresa, f.id]));
        console.log("Fornecedores criados.");

        // ----------------------------- PARA CONTRATOS ----------------------------------
        // ===== Contratos =====
        const contratos = [
            // ----------------------------------------------------------
            // FAZENDAS
            // externos -> Faz. Alpha
            {
                unidadeId: unidadeMap["Fazenda Alpha"],
                fornecedorExternoId: fornecedorMap["AgroFornecimentos Ltda"],
                dataInicio: new Date("2024-01-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-01-05T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.SACA,
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Alpha"],
                fornecedorExternoId: fornecedorMap["NutriBov Distribuidora"],
                dataInicio: new Date("2024-02-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-02-03T07:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.SACA,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Alpha"],
                fornecedorExternoId: fornecedorMap["BovinoPrime Reprodutores"],
                dataInicio: new Date("2025-02-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-02-03T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.CABECA,
                diaPagamento: "20",
                formaPagamento: TPAG.PIX,
            },
            // externos -> Faz. Gamma
            {
                unidadeId: unidadeMap["Fazenda Gamma"],
                fornecedorExternoId: fornecedorMap["Sementes Brasil"],
                dataInicio: new Date("2024-03-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-03-05T09:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE, // fallback
                unidadeMedida: UMED.SACA,
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Gamma"],
                fornecedorExternoId: fornecedorMap["AgroGrãos Comercial"],
                dataInicio: new Date("2024-04-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-04-03T08:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.KG,
                diaPagamento: "05",
                formaPagamento: TPAG.PIX,
            },

            // externos -> Faz. Delta
            {
                unidadeId: unidadeMap["Fazenda Delta"],
                fornecedorExternoId: fornecedorMap["FertSul Distribuição"],
                dataInicio: new Date("2024-01-15T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-01-20T06:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.SACA,
                diaPagamento: "20",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Delta"],
                fornecedorExternoId: fornecedorMap["BioInsumos Ltda"],
                dataInicio: new Date("2024-02-10T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-02-12T07:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.LITRO,
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },

            // externos -> Fazenda Beta
            {
                unidadeId: unidadeMap["Fazenda Beta"],
                fornecedorExternoId: fornecedorMap["AgroLácteos Suprimentos"],
                dataInicio: new Date("2024-07-15T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-07-18T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Beta"],
                fornecedorExternoId: fornecedorMap["Lácteos & Tecnologia Ltda"],
                dataInicio: new Date("2024-07-20T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-07-22T07:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Beta"],
                fornecedorExternoId: fornecedorMap["AgroBov Genetics"],
                dataInicio: new Date("2024-09-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-09-03T06:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.TRIMESTRAL, // inseminação/troca genética não é mensal
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Beta"],
                fornecedorExternoId: fornecedorMap["VetBov Serviços e Insumos"],
                dataInicio: new Date("2024-08-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-08-05T07:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },

            // Unidade Teste <- PastosVerde Nutrição Animal (silagem, feno, suplementos minerais)
            {
                unidadeId: unidadeMap["Unidade Teste"],
                fornecedorExternoId: fornecedorMap["PastosVerde Nutrição Animal"],
                dataInicio: new Date("2024-10-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-10-03T09:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },
            // Unidade Teste <- GenBov Melhoramento Genético (inseminação e consultoria)
            {
                unidadeId: unidadeMap["Unidade Teste"],
                fornecedorExternoId: fornecedorMap["GenBov Melhoramento Genético"],
                dataInicio: new Date("2024-11-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-11-04T08:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.TRIMESTRAL,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "20",
                formaPagamento: TPAG.PIX,
            },
            // Unidade Teste <- AgroVet Saúde Animal (medicamentos e vacinas)
            {
                unidadeId: unidadeMap["Unidade Teste"],
                fornecedorExternoId: fornecedorMap["AgroVet Saúde Animal"],
                dataInicio: new Date("2024-12-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-12-05T07:45:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "25",
                formaPagamento: TPAG.PIX,
            },
            // Unidade Teste <- CampoForte Equipamentos (balanças, troncos, bebedouros)
            {
                unidadeId: unidadeMap["Unidade Teste"],
                fornecedorExternoId: fornecedorMap["CampoForte Equipamentos"],
                dataInicio: new Date("2025-01-10T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-01-12T10:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.SEMESTRAL,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "05",
                formaPagamento: TPAG.PIX,
            },

            // -------------------------------------------------------
            // LOJAS
            // VerdeFresco Hortaliças (vende hortaliças) <- fornecedor: Fazenda Delta
            {
                unidadeId: unidadeMap["VerdeFresco Hortaliças"],
                fornecedorUnidadeId: unidadeMap["Fazenda Delta"],
                dataInicio: new Date("2025-05-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-05-02T06:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.SEMANALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },

            // AgroBoi (vende gado/insumos) <- fornecedor: Fazenda Alpha
            {
                unidadeId: unidadeMap["AgroBoi"],
                fornecedorUnidadeId: unidadeMap["Fazenda Alpha"],
                dataInicio: new Date("2025-05-10T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-05-12T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.SACA, // para insumos; animais podem ser UMED.UNIDADE/CAB em itens do contrato
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },

            // Casa Útil Mercado (produtos diversos) <- fornecedores variados (ex.: usa fazendas para apresentação do usuário Maria)
            {
                unidadeId: unidadeMap["Casa Útil Mercado"],
                fornecedorUnidadeId: unidadeMap["Fazenda Gamma"],
                dataInicio: new Date("2025-04-15T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-04-18T09:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.KG,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Casa Útil Mercado"],
                fornecedorUnidadeId: unidadeMap["Fazenda Alpha"],
                dataInicio: new Date("2025-04-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-04-03T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.KG,
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Casa Útil Mercado"],
                fornecedorUnidadeId: unidadeMap["Fazenda Teste"],
                dataInicio: new Date("2025-03-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-03-02T09:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "05",
                formaPagamento: TPAG.PIX,
            },

            // Sabor do Campo Laticínios (laticínios) <- fornecedor: Fazenda Beta
            {
                unidadeId: unidadeMap["Sabor do Campo Laticínios"],
                fornecedorUnidadeId: unidadeMap["Fazenda Beta"],
                dataInicio: new Date("2025-05-05T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-05-06T07:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.SEMANALMENTE,
                unidadeMedida: UMED.LITRO, // leite e derivados
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },

            // Loja Teste (laticínios e carne) <- fornecedor: Unidade Teste
            {
                unidadeId: unidadeMap["Loja Teste"],
                fornecedorUnidadeId: unidadeMap["Unidade Teste"],
                dataInicio: new Date("2025-06-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-06-03T10:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE, // mistura (laticínios unid., carnes kg em itens do contrato)
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },
        ];
        await prisma.contrato.createMany({ data: contratos, skipDuplicates: true });
        console.log("Contratos criados (seed).");
        // Atualize os maps caso precise utilizar IDs logo depois
        const contratosDb = await prisma.contrato.findMany();
        const contratoMap = Object.fromEntries(
            contratosDb.map(c => {
                const unidadeNome = c.unidade?.nome;
                const fornecedorNome =
                    c.fornecedorExterno?.nome ||
                    c.fornecedorUnidade?.nome;

                // chave simples: "Unidade - Fornecedor"
                const chave = `${unidadeNome} - ${fornecedorNome}`;

                return [chave, c.id];
            })
        );
        console.log("Quantidade de contratos:", contratosDb.length);

        // ===== insumos que NAO vao p producao. São pra representar o que vai ser fornecido no contrato, APENAS =====
        console.log("Criando insumos para fazendas")
        const insumosContrato = [
            // Fazenda Alpha → AgroFornecimentos Ltda
            {
                contratoId: contratoMap["Fazenda Alpha - AgroFornecimentos Ltda"],
                sku: "RACAO-BOV-050",
                nome: "Ração Bovino Engorda 50kg",
                categoria: ["Ração"],
                unidadeMedida: UMED.SACA,
                quantidade: 200, // 200 sacas/mês (10 toneladas)
                precoUnitario: "260.00",
                ativo: true,
                criadoEm: new Date("2025-01-20"),
            },
            // Fazenda Alpha → NutriBov Distribuidora
            {
                contratoId: contratoMap["Fazenda Alpha - NutriBov Distribuidora"],
                sku: "SUP-MIN-BOV-005",
                nome: "Suplemento Mineral Bovino 5kg",
                categoria: ["Suplemento"],
                unidadeMedida: UMED.KG,
                quantidade: 500, // 500 kg/mês
                precoUnitario: "42.00",
                ativo: true,
                criadoEm: new Date("2025-02-01"),
            },
            {
                contratoId: contratoMap["Fazenda Alpha - NutriBov Distribuidora"],
                sku: "BLOCO-MIN-BOV-010",
                nome: "Bloco Mineral Bovino 10kg",
                categoria: ["Suplemento"],
                unidadeMedida: UMED.KG,
                quantidade: 300, // 300 blocos/mês
                precoUnitario: "95.00",
                ativo: true,
                criadoEm: new Date("2025-02-10"),
            },

            // Fazenda Gamma → Sementes Brasil
            {
                contratoId: contratoMap["Fazenda Gamma - Sementes Brasil"],
                sku: "SEED-SOJA-020",
                nome: "Semente Soja Alta Germinacao 20kg",
                categoria: ["Sementes"],
                unidadeMedida: UMED.SACA,
                quantidade: 150, // 150 sacas/mês
                precoUnitario: "320.00",
                ativo: true,
                criadoEm: new Date("2025-01-10"),
            },
            // Fazenda Gamma → AgroGrãos Comercial
            {
                contratoId: contratoMap["Fazenda Gamma - AgroGrãos Comercial"],
                sku: "FARELO-SOJA-025",
                nome: "Farelo de Soja 25kg",
                categoria: ["Insumos"],
                unidadeMedida: UMED.SACA,
                quantidade: 400, // 400 sacas/mês
                precoUnitario: "130.00",
                ativo: true,
                criadoEm: new Date("2025-08-10"),
            },
            // Fazenda Gamma → FertSul Distribuição
            {
                contratoId: contratoMap["Fazenda Gamma - FertSul Distribuição"],
                sku: "CALC-AG-040",
                nome: "Calcario Agricola 40kg",
                categoria: ["Corretivo"],
                unidadeMedida: UMED.KG,
                quantidade: 1000, // 40 toneladas/mês
                precoUnitario: "75.00",
                ativo: true,
                criadoEm: new Date("2025-02-15"),
            },

            // Fazenda Delta → FertSul Distribuição
            {
                contratoId: contratoMap["Fazenda Delta - FertSul Distribuição"],
                sku: "NPK-20520-025",
                nome: "NPK 20-05-20 25kg",
                categoria: ["Fertilizantes"],
                unidadeMedida: UMED.KG,
                quantidade: 600, // 15 toneladas/mês
                precoUnitario: "95.00",
                ativo: true,
                criadoEm: new Date("2025-01-10"),
            },

            // Fazenda Delta → BioInsumos Ltda
            {
                contratoId: contratoMap["Fazenda Delta - BioInsumos Ltda"],
                sku: "COMPO-MIC-010",
                nome: "Composto Microbiano 10kg",
                categoria: ["Adubo"],
                unidadeMedida: UMED.KG,
                quantidade: 200, // 2 toneladas/mês
                precoUnitario: "48.00",
                ativo: true,
                criadoEm: new Date("2025-03-01"),
            },
            {
                contratoId: contratoMap["Fazenda Delta - BioInsumos Ltda"],
                sku: "INOC-SOJA-001",
                nome: "Inoculante Microbiano para Soja 1L",
                categoria: ["Inoculante"],
                unidadeMedida: UMED.LITRO,
                quantidade: 300, // 300 litros/mês
                precoUnitario: "38.00",
                ativo: true,
                criadoEm: new Date("2025-01-12"),
            },

            // Fazenda Beta → AgroLácteos Suprimentos
            {
                contratoId: contratoMap["Fazenda Beta - AgroLácteos Suprimentos"],
                sku: "COALHO-LIQ-001",
                nome: "Coalho Líquido para Queijo 1L",
                categoria: ["Coagulação"],
                unidadeMedida: UMED.LITRO,
                quantidade: 50, // 50 litros/mês
                precoUnitario: "85.00",
                ativo: true,
                criadoEm: new Date("2025-03-01"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - AgroLácteos Suprimentos"],
                sku: "CULT-LACT-010",
                nome: "Cultura Láctea Termófila 10g",
                categoria: ["Fermento"],
                unidadeMedida: UMED.G,
                quantidade: 200, // 200 doses/mês
                precoUnitario: "32.00",
                ativo: true,
                criadoEm: new Date("2025-03-02"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - AgroLácteos Suprimentos"],
                sku: "EMBAL-LEITE-1L",
                nome: "Embalagem Plástica para Leite 1L (pacote c/ 100)",
                categoria: ["Embalagem"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 100, // 100 pacotes/mês
                precoUnitario: "55.00",
                ativo: true,
                criadoEm: new Date("2025-03-05"),
            },

            // Fazenda Beta → Lácteos & Tecnologia Ltda
            {
                contratoId: contratoMap["Fazenda Beta - Lácteos & Tecnologia Ltda"],
                sku: "START-YOG-005",
                nome: "Starter Culture para Iogurte 5g",
                categoria: ["Fermento"],
                unidadeMedida: UMED.GRAMAS,
                quantidade: 150, // 150 doses/mês
                precoUnitario: "27.00",
                ativo: true,
                criadoEm: new Date("2025-03-03"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - Lácteos & Tecnologia Ltda"],
                sku: "ENZ-QUEIJO-020",
                nome: "Enzima Lipase para Queijo 20ml",
                categoria: ["Enzimas"],
                unidadeMedida: UMED.ML,
                quantidade: 80, // 80 frascos/mês
                precoUnitario: "19.00",
                ativo: true,
                criadoEm: new Date("2025-03-04"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - Lácteos & Tecnologia Ltda"],
                sku: "POTE-YOG-200ML",
                nome: "Pote Plástico 200ml para Iogurte (caixa c/ 50)",
                categoria: ["Embalagem"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 60, // 60 caixas/mês
                precoUnitario: "34.00",
                ativo: true,
                criadoEm: new Date("2025-03-06"),
            },

            // Fazenda Beta → AgroBov Genetics
            {
                contratoId: contratoMap["Fazenda Beta - AgroBov Genetics"],
                sku: "SEME-STR-001",
                nome: "Sêmen Bovino (dose - straw) - Alta Fertilidade",
                categoria: ["Genética", "Sêmen"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 100, // 100 doses/mês
                precoUnitario: "120.00",
                ativo: true,
                criadoEm: new Date("2025-04-03"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - AgroBov Genetics"],
                sku: "SERV-IAF-001",
                nome: "Serviço Inseminação Artificial (por cabeça)",
                categoria: ["Serviço"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 50, // 50 serviços/mês
                precoUnitario: "250.00",
                ativo: true,
                criadoEm: new Date("2025-04-04")
            },

            // Fazenda Beta → VetBov Serviços e Insumos
            {
                contratoId: contratoMap["Fazenda Beta - VetBov Serviços e Insumos"],
                sku: "VAC-BRU-010",
                nome: "Vacina Brucelose (dose)",
                categoria: ["Vacina"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 300, // 300 doses/mês
                precoUnitario: "18.00",
                ativo: true,
                criadoEm: new Date("2025-04-05")
            },
            {
                contratoId: contratoMap["Fazenda Beta - VetBov Serviços e Insumos"],
                sku: "ANTIPAR-50ML",
                nome: "Antiparasitário Oral 50ml (dose unitária)",
                categoria: ["Medicamento"],
                unidadeMedida: UMED.ML,
                quantidade: 200, // 200 doses/mês
                precoUnitario: "12.00",
                ativo: true,
                criadoEm: new Date("2025-04-06")
            },
            {
                contratoId: contratoMap["Fazenda Beta - VetBov Serviços e Insumos"],
                sku: "KIT-SAN-001",
                nome: "Kit Sanidade (antiparasitário + vitaminas) - por animal",
                categoria: ["Kit", "Sanidade"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 150, // 150 kits/mês
                precoUnitario: "35.00",
                ativo: true,
                criadoEm: new Date("2025-04-07")
            },

            // Unidade Teste → PastosVerde Nutrição Animal
            {
                contratoId: contratoMap["Unidade Teste - PastosVerde Nutrição Animal"],
                sku: "SILAGEM-MILHO-500KG",
                nome: "Silagem de Milho 500kg",
                categoria: ["Nutrição Animal"],
                unidadeMedida: UMED.KG,
                quantidade: 5000, // 5 toneladas/mês
                precoUnitario: "480.00",
                ativo: true,
                criadoEm: new Date("2025-03-10"),
            },
            {
                contratoId: contratoMap["Unidade Teste - PastosVerde Nutrição Animal"],
                sku: "FENO-CAPIM-BALE",
                nome: "Fardo de Feno de Capim 25kg",
                categoria: ["Nutrição Animal"],
                unidadeMedida: UMED.KG,
                quantidade: 2000, // 2 toneladas/mês
                precoUnitario: "95.00",
                ativo: true,
                criadoEm: new Date("2025-03-11"),
            },

            // Unidade Teste → GenBov Melhoramento Genético
            {
                contratoId: contratoMap["Unidade Teste - GenBov Melhoramento Genético"],
                sku: "SEMEN-TOURO-ALTA",
                nome: "Sêmen de Touro Alta Performance (dose)",
                categoria: ["Genética"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 80, // 80 doses/mês
                precoUnitario: "250.00",
                ativo: true,
                criadoEm: new Date("2025-03-15"),
            },
            {
                contratoId: contratoMap["Unidade Teste - GenBov Melhoramento Genético"],
                sku: "SERV-INSEM-001",
                nome: "Serviço de Inseminação Artificial",
                categoria: ["Serviço"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 40, // 40 serviços/mês
                precoUnitario: "500.00",
                ativo: true,
                criadoEm: new Date("2025-03-16"),
            },

            // Unidade Teste → AgroVet Saúde Animal
            {
                contratoId: contratoMap["Unidade Teste - AgroVet Saúde Animal"],
                sku: "VACINA-FOOT-AND-MOUTH",
                nome: "Vacina contra Febre Aftosa (dose)",
                categoria: ["Vacinas"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 400, // 400 doses/mês
                precoUnitario: "22.00",
                ativo: true,
                criadoEm: new Date("2025-03-20"),
            },
            {
                contratoId: contratoMap["Unidade Teste - AgroVet Saúde Animal"],
                sku: "ANTIBIOTICO-BOV-100ML",
                nome: "Antibiótico Bovino 100ml",
                categoria: ["Medicamentos"],
                unidadeMedida: UMED.ML,
                quantidade: 150, // 150 frascos/mês
                precoUnitario: "75.00",
                ativo: true,
                criadoEm: new Date("2025-03-21"),
            },

            // Unidade Teste → CampoForte Equipamentos
            {
                contratoId: contratoMap["Unidade Teste - CampoForte Equipamentos"],
                sku: "BALANCA-BOV-500KG",
                nome: "Balança Eletrônica para Bovinos até 500kg",
                categoria: ["Equipamentos"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 5, // 5 unidades/mês
                precoUnitario: "3500.00",
                ativo: true,
                criadoEm: new Date("2025-03-25"),
            },
            {
                contratoId: contratoMap["Unidade Teste - CampoForte Equipamentos"],
                sku: "TRONCO-CONTENCAO-001",
                nome: "Tronco de Contenção Bovino",
                categoria: ["Equipamentos"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 3, // 3 unidades/mês
                precoUnitario: "7200.00",
                ativo: true,
                criadoEm: new Date("2025-03-26"),
            }
        ];
        await prisma.fornecedorItem.createMany({ data: insumosContrato, skipDuplicates: true });
        console.log("insumos criados com sucesso")

        console.log("Criando animais para contrato....")
        const animaisContrato = [
            // ----------------------- FAZENDA ALPHA
            {
                contratoId: contratoMap["Fazenda Alpha - BovinoPrime Reprodutores"],
                // sku: "BOI-NEL-ALPHA-001",
                nome: "Boi Nelore Reprodutor (macho adulto)",
                raca: "Nelore",
                categoria: ["Animal", "Reprodutor"],
                unidadeMedida: UMED.CABECA,
                quantidade: 8,
                precoUnitario: "13500.00",
                ativo: true,
                criadoEm: new Date("2025-02-04")
            },
            // ----------------------- FAZENDA BETA
            // AgroBov Genetics -> animais e genética
            {
                contratoId: contratoMap["Fazenda Beta - AgroBov Genetics"],
                // sku: "TOURO-NEL-001",
                nome: "Touro Nelore Reprodutor - 1 (macho adulto)",
                raca: "Nelore",
                categoria: ["Animal", "Reprodutor"],
                unidadeMedida: UMED.CABECA, // cabeça
                quantidade: 2, // 
                precoUnitario: "15000.00",
                ativo: true,
                criadoEm: new Date("2025-04-01")
            },
            {
                contratoId: contratoMap["Fazenda Beta - AgroBov Genetics"],
                // sku: "VACA-HOL-001",
                nome: "Vaca Holandesa - Reposição (fêmea adulta pronta para ordenha)",
                raca: "Holandesa",
                categoria: ["Animal", "Reprodução"],
                unidadeMedida: UMED.CABECA,
                quantidade: 5,
                precoUnitario: "6500.00",
                ativo: true,
                criadoEm: new Date("2025-04-02")
            },

            // -------------------- UNIDADE TESTE
            {
                contratoId: contratoMap["Unidade Teste - GenBov Melhoramento Genético"],
                // sku: "TOURO-NELORE-002",
                nome: "Touro Nelore Reprodutor (macho adulto)",
                raca: "Nelore",
                categoria: ["Animal", "Reprodutor"],
                unidadeMedida: UMED.CABECA,
                quantidade: 1,
                precoUnitario: "16000.00",
                ativo: true,
                criadoEm: new Date("2025-04-10")
            },
            {
                contratoId: contratoMap["Unidade Teste - GenBov Melhoramento Genético"],
                // sku: "VACA-HOLANDESA-002",
                nome: "Vaca Holandesa (fêmea adulta pronta para ordenha)",
                raca: "Holandesa",
                categoria: ["Animal", "Reprodução"],
                unidadeMedida: UMED.CABECA,
                quantidade: 3, // 10 vacas/mês
                precoUnitario: "7000.00",
                ativo: true,
                criadoEm: new Date("2025-04-11")
            }
        ];
        // inserir no banco (adicione ao seu fluxo de seed existente)
        await prisma.fornecedorItem.createMany({ data: animaisContrato, skipDuplicates: true });
        console.log("animais / itens pecuários do contrato criados com sucesso.");

        // produtos relacionados aos contratos
        const produtosContrato = [
            // Fazenda Alpha → AgroBoi (carne bovina)
            {
                contratoId: contratoMap["Fazenda Alpha - AgroBoi"],
                // sku: "CARNE-DIANT-001",
                nome: "Carne bovina dianteiro (kg)",
                categoria: ["Carne"],
                unidadeMedida: UMED.KG,
                quantidade: 1000, // 1000 kg/mês
                precoUnitario: "38.00",
                ativo: true,
                criadoEm: new Date("2025-01-10")
            },
            {
                contratoId: contratoMap["Fazenda Alpha - AgroBoi"],
                // sku: "CARNE-TRASEIRO-001",
                nome: "Carne bovina traseiro (kg)",
                categoria: ["Carne"],
                unidadeMedida: UMED.KG,
                quantidade: 800, // 800 kg/mês
                precoUnitario: "45.00",
                ativo: true,
                criadoEm: new Date("2025-01-11")
            },

            // Fazenda Gamma → Casa Útil Mercado (grãos)
            {
                contratoId: contratoMap["Fazenda Gamma - Casa Útil Mercado"],
                // sku: "SOJA-SACA-60KG",
                nome: "Soja em saca 60kg",
                categoria: ["Grãos"],
                unidadeMedida: UMED.SACA,
                quantidade: 500, // 500 sacas/mês
                precoUnitario: "180.00",
                ativo: true,
                criadoEm: new Date("2025-02-01")
            },
            {
                contratoId: contratoMap["Fazenda Gamma - Casa Útil Mercado"],
                // sku: "MILHO-SACA-60KG",
                nome: "Milho em saca 60kg",
                categoria: ["Grãos"],
                unidadeMedida: UMED.SACA,
                quantidade: 400, // 400 sacas/mês
                precoUnitario: "150.00",
                ativo: true,
                criadoEm: new Date("2025-02-02")
            },

            // Fazenda Beta → Sabor do Campo Laticínios (laticínios)
            {
                contratoId: contratoMap["Fazenda Beta - Sabor do Campo Laticínios"],
                // sku: "LEITE-PASTEUR-1L",
                nome: "Leite pasteurizado 1L",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.LITRO,
                quantidade: 2000, // 2000 litros/mês
                precoUnitario: "4.50",
                ativo: true,
                criadoEm: new Date("2025-03-01")
            },
            {
                contratoId: contratoMap["Fazenda Beta - Sabor do Campo Laticínios"],
                // sku: "QUEIJO-MINAS-500G",
                nome: "Queijo Minas Frescal 500g",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.KG,
                quantidade: 300, // 300 kg/mês
                precoUnitario: "25.00",
                ativo: true,
                criadoEm: new Date("2025-03-02")
            },
            {
                contratoId: contratoMap["Fazenda Beta - Sabor do Campo Laticínios"],
                // sku: "IOGURTE-NATURAL-170G",
                nome: "Iogurte natural 170g",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 1000, // 1000 unidades/mês
                precoUnitario: "3.20",
                ativo: true,
                criadoEm: new Date("2025-03-03")
            },

            // Fazenda Delta → VerdeFresco Hortaliças (hortaliças)
            {
                contratoId: contratoMap["Fazenda Delta - VerdeFresco Hortaliças"],
                // sku: "ALFACE-CRESPA-UN",
                nome: "Alface crespa unidade",
                categoria: ["Hortaliças"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: 1500, // 1500 unidades/mês
                precoUnitario: "2.50",
                ativo: true,
                criadoEm: new Date("2025-04-01")
            },
            {
                contratoId: contratoMap["Fazenda Delta - VerdeFresco Hortaliças"],
                // sku: "TOMATE-CAIXA-20KG",
                nome: "Tomate caixa 20kg",
                categoria: ["Hortaliças"],
                unidadeMedida: UMED.KG,
                quantidade: 500, // 500 caixas (20kg cada) ≈ 10 toneladas/mês
                precoUnitario: "80.00",
                ativo: true,
                criadoEm: new Date("2025-04-02")
            },

            // Loja Teste (laticínios e carne) <- fornecedor: Unidade Teste
            {
                contratoId: contratoMap["Loja Teste - Unidade Teste"],
                // sku: "LEITE-TESTE-1L",
                nome: "Leite pasteurizado 1L (teste)",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.LITRO,
                quantidade: 500, // 500 litros/mês
                precoUnitario: "4.00",
                ativo: true,
                criadoEm: new Date("2025-06-01")
            },
            {
                contratoId: contratoMap["Loja Teste - Unidade Teste"],
                // sku: "QUEIJO-TESTE-500G",
                nome: "Queijo fresco 500g (teste)",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.KG,
                quantidade: 100, // 100 kg/mês
                precoUnitario: "22.00",
                ativo: true,
                criadoEm: new Date("2025-06-01")
            },
            {
                contratoId: contratoMap["Loja Teste - Unidade Teste"],
                // sku: "CARNE-BOVINA-TESTE-1KG",
                nome: "Carne bovina corte dianteiro (teste)",
                categoria: ["Carne"],
                unidadeMedida: UMED.KG,
                quantidade: 200, // 200 kg/mês
                precoUnitario: "40.00",
                ativo: true,
                criadoEm: new Date("2025-06-01")
            },
            {
                contratoId: contratoMap["Loja Teste - Unidade Teste"],
                // sku: "CARNE-BOVINA-TESTE-TRASEIRO",
                nome: "Carne bovina corte traseiro (teste)",
                categoria: ["Carne"],
                unidadeMedida: UMED.KG,
                quantidade: 150, // 150 kg/mês
                precoUnitario: "48.00",
                ativo: true,
                criadoEm: new Date("2025-06-01")
            }
        ];

        await prisma.fornecedorItem.createMany({ data: produtosContrato, skipDuplicates: true });
        console.log(`Produtos de contrato inseridos: ${produtosContrato.length}`);

        for (const contrato of contratosDb) {
            // Buscar todos os itens vinculados a esse contrato
            const itens = await prisma.fornecedorItem.findMany({
                where: { contratoId: contrato.id }
            });

            // Calcular o valor total (precoUnitario × quantidade)
            let valorTotal = 0;
            for (const item of itens) {
                const preco = parseFloat(item.precoUnitario || 0);
                const qtd = parseFloat(item.quantidade || 0);
                valorTotal += preco * qtd;
            }

            // Atualizar o contrato com o valor total calculado
            await prisma.contrato.update({
                where: { id: contrato.id },
                data: { valorTotal: valorTotal.toFixed(2) }
            });

            console.log(`Contrato ${contrato.id} atualizado com valorTotal = ${valorTotal.toFixed(2)}`);
        }

        // Função utilitária para criar pedido + itens automaticamente
        async function criarPedidoComItens({
            contratoId,
            origemFornecedorExternoId,
            origemUnidadeId,
            destinoUnidadeId,
            criadoPorId,
            dataEnvio,
            documentoReferencia,
            observacoes
        }) {
            // 1) Cria o pedido
            const pedido = await prisma.pedido.create({
                data: {
                    contratoId,
                    origemFornecedorExternoId,
                    origemUnidadeId,
                    destinoUnidadeId,
                    criadoPorId,
                    dataPedido: new Date(),        // sempre agora
                    dataEnvio: dataEnvio ?? new Date(),
                    status: "PENDENTE",
                    documentoReferencia,
                    observacoes
                }
            });

            // 2) Carrega os itens do contrato
            const itensContrato = await prisma.fornecedorItem.findMany({
                where: { contratoId }
            });

            // 3) Gera os itens do pedido usando a quantidade DEFINIDA no fornecedorItem
            const itensPedidoData = itensContrato.map(it => ({
                pedidoId: pedido.id,
                fornecedorItemId: it.id,
                quantidade: Number(it.quantidade || 0), // <-- USA A QUANTIDADE DO CONTRATO
                unidadeMedida: it.unidadeMedida ?? "UNIDADE",
                precoUnitario: Number(it.precoUnitario || 0),
                custoTotal: it.quantidade && it.precoUnitario
                    ? Number(it.quantidade) * Number(it.precoUnitario)
                    : null,
                observacoes: `Item gerado automaticamente do contrato ${contratoId}`
            }));

            if (itensPedidoData.length > 0) {
                await prisma.pedidoItem.createMany({
                    data: itensPedidoData,
                    skipDuplicates: true
                });
            }

            console.log(`Pedido ${pedido.id} criado com ${itensPedidoData.length} itens.`);
            return pedido;
        }

        // pedidos da fazenda
        const pedidosFazenda = [
            // Fazenda Alpha <- AgroFornecimentos Ltda
            {
                contratoId: contratoMap["Fazenda Alpha - AgroFornecimentos Ltda"],
                origemFornecedorExternoId: fornecedorMap["AgroFornecimentos Ltda"],
                destinoUnidadeId: unidadeMap["Fazenda Alpha"],
                criadoPorId: usuarioMap["Juliana Correia"],
                dataPedido: new Date("2025-06-01T09:00:00.000Z"),
                dataEnvio: new Date("2025-06-05T08:00:00.000Z"),
                valorTotal: "25000.00",
                documentoReferencia: "PED-AF-20250601",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido automático gerado pelo contrato (frequência mensal)."
            },
            // Fazenda Alpha <- NutriBov Distribuidora
            {
                contratoId: contratoMap["Fazenda Alpha - NutriBov Distribuidora"],
                origemFornecedorExternoId: fornecedorMap["NutriBov Distribuidora"],
                destinoUnidadeId: unidadeMap["Fazenda Alpha"],
                criadoPorId: usuarioMap["Juliana Correia"],
                dataPedido: new Date("2025-06-02T09:30:00.000Z"),
                dataEnvio: new Date("2025-06-06T07:30:00.000Z"),
                valorTotal: "8000.00",
                documentoReferencia: "PED-NB-20250602",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido automático — suplementação."
            },

            // Fazenda Gamma <- Sementes Brasil
            {
                contratoId: contratoMap["Fazenda Gamma - Sementes Brasil"],
                origemFornecedorExternoId: fornecedorMap["Sementes Brasil"],
                destinoUnidadeId: unidadeMap["Fazenda Gamma"],
                criadoPorId: usuarioMap["Otávio Viana"],
                dataPedido: new Date("2025-06-03T10:15:00.000Z"),
                dataEnvio: new Date("2025-06-05T09:00:00.000Z"),
                valorTotal: "12000.00",
                documentoReferencia: "PED-SB-20250603",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido mensal de sementes."
            },
            // Fazenda Gamma <- AgroGrãos Comercial
            {
                contratoId: contratoMap["Fazenda Gamma - AgroGrãos Comercial"],
                origemFornecedorExternoId: fornecedorMap["AgroGrãos Comercial"],
                destinoUnidadeId: unidadeMap["Fazenda Gamma"],
                criadoPorId: usuarioMap["Otávio Viana"],
                dataPedido: new Date("2025-06-04T11:40:00.000Z"),
                dataEnvio: new Date("2025-06-03T08:30:00.000Z"),
                valorTotal: "40000.00",
                documentoReferencia: "PED-AGC-20250604",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Entrega contratual — grãos/farelo."
            },

            // Fazenda Delta <- FertSul Distribuição
            {
                contratoId: contratoMap["Fazenda Delta - FertSul Distribuição"],
                origemFornecedorExternoId: fornecedorMap["FertSul Distribuição"],
                destinoUnidadeId: unidadeMap["Fazenda Delta"],
                criadoPorId: usuarioMap["Kátia Oliveira"],
                dataPedido: new Date("2025-06-05T07:00:00.000Z"),
                dataEnvio: new Date("2025-06-20T06:00:00.000Z"),
                valorTotal: "18000.00",
                documentoReferencia: "PED-FSD-20250605",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido mensal de fertilizantes."
            },
            // Fazenda Delta <- BioInsumos Ltda
            {
                contratoId: contratoMap["Fazenda Delta - BioInsumos Ltda"],
                origemFornecedorExternoId: fornecedorMap["BioInsumos Ltda"],
                destinoUnidadeId: unidadeMap["Fazenda Delta"],
                criadoPorId: usuarioMap["Kátia Oliveira"],
                dataPedido: new Date("2025-06-06T07:30:00.000Z"),
                dataEnvio: new Date("2025-06-12T07:00:00.000Z"),
                valorTotal: "6000.00",
                documentoReferencia: "PED-BIO-20250606",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido mensal — insumos biológicos."
            },

            // Fazenda Beta
            {
                contratoId: contratoMap["Fazenda Beta - AgroLácteos Suprimentos"],
                origemFornecedorExternoId: fornecedorMap["AgroLácteos Suprimentos"],
                destinoUnidadeId: unidadeMap["Fazenda Beta"],
                criadoPorId: usuarioMap["Richard Souza"],
                dataPedido: new Date("2025-06-07T08:00:00.000Z"),
                dataEnvio: new Date("2025-06-12T08:00:00.000Z"),
                valorTotal: "5000.00",
                documentoReferencia: "PED-ALS-20250607",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido automático — insumos para laticínios (coalho, culturas, embalagens)."
            },
            {
                contratoId: contratoMap["Fazenda Beta - Lácteos & Tecnologia Ltda"],
                origemFornecedorExternoId: fornecedorMap["Lácteos & Tecnologia Ltda"],
                destinoUnidadeId: unidadeMap["Fazenda Beta"],
                criadoPorId: usuarioMap["Richard Souza"],
                dataPedido: new Date("2025-06-08T08:30:00.000Z"),
                dataEnvio: new Date("2025-06-13T07:30:00.000Z"),
                valorTotal: "8000.00",
                documentoReferencia: "PED-LT-20250608",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido automático — culturas starter, enzimas e embalagens."
            },
            // Fazenda Beta <- AgroBov Genetics (animais e genética)
            {
                contratoId: contratoMap["Fazenda Beta - AgroBov Genetics"],
                origemFornecedorExternoId: fornecedorMap["AgroBov Genetics"],
                destinoUnidadeId: unidadeMap["Fazenda Beta"],
                criadoPorId: usuarioMap["Richard Souza"],
                dataPedido: new Date("2025-06-09T09:00:00.000Z"),
                dataEnvio: new Date("2025-06-15T08:00:00.000Z"),
                valorTotal: "35000.00",
                documentoReferencia: "PED-AGB-20250609",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido contratual — genética bovina (touros, vacas e sêmen)."
            },
            // Fazenda Beta <- VetBov Serviços e Insumos (vacinas, antiparasitários, kits)
            {
                contratoId: contratoMap["Fazenda Beta - VetBov Serviços e Insumos"],
                origemFornecedorExternoId: fornecedorMap["VetBov Serviços e Insumos"],
                destinoUnidadeId: unidadeMap["Fazenda Beta"],
                criadoPorId: usuarioMap["Richard Souza"],
                dataPedido: new Date("2025-06-10T10:20:00.000Z"),
                dataEnvio: new Date("2025-06-14T07:30:00.000Z"),
                valorTotal: "12000.00",
                documentoReferencia: "PED-VB-20250610",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido mensal — vacinas, antiparasitário e kits de sanidade."
            },

            // Unidade Teste <- PastosVerde Nutrição Animal (silagem e feno)
            {
                contratoId: contratoMap["Unidade Teste - PastosVerde Nutrição Animal"],
                origemFornecedorExternoId: fornecedorMap["PastosVerde Nutrição Animal"],
                destinoUnidadeId: unidadeMap["Unidade Teste"],
                criadoPorId: usuarioMap["Renato Martins"], // gerente da Loja Teste
                dataPedido: new Date("2025-06-11T08:00:00.000Z"),
                dataEnvio: new Date("2025-06-15T08:00:00.000Z"),
                valorTotal: "12000.00",
                documentoReferencia: "PED-PV-20250611",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido mensal — silagem de milho e fardos de feno para nutrição animal."
            },
            // Unidade Teste <- GenBov Melhoramento Genético (animais e genética)
            {
                contratoId: contratoMap["Unidade Teste - GenBov Melhoramento Genético"],
                origemFornecedorExternoId: fornecedorMap["GenBov Melhoramento Genético"],
                destinoUnidadeId: unidadeMap["Unidade Teste"],
                criadoPorId: usuarioMap["Renato Martins"],
                dataPedido: new Date("2025-06-12T09:30:00.000Z"),
                dataEnvio: new Date("2025-06-18T07:30:00.000Z"),
                valorTotal: "45000.00",
                documentoReferencia: "PED-GB-20250612",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido contratual — genética bovina (sêmen, embriões e animais reprodutores)."
            },
            // Unidade Teste <- AgroVet Saúde Animal (vacinas e medicamentos)
            {
                contratoId: contratoMap["Unidade Teste - AgroVet Saúde Animal"],
                origemFornecedorExternoId: fornecedorMap["AgroVet Saúde Animal"],
                destinoUnidadeId: unidadeMap["Unidade Teste"],
                criadoPorId: usuarioMap["Renato Martins"],
                dataPedido: new Date("2025-06-13T10:00:00.000Z"),
                dataEnvio: new Date("2025-06-17T08:00:00.000Z"),
                valorTotal: "18000.00",
                documentoReferencia: "PED-AV-20250613",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido mensal — vacinas contra febre aftosa e antibióticos bovinos."
            },
            // Unidade Teste <- CampoForte Equipamentos (balanças e troncos de contenção)
            {
                contratoId: contratoMap["Unidade Teste - CampoForte Equipamentos"],
                origemFornecedorExternoId: fornecedorMap["CampoForte Equipamentos"],
                destinoUnidadeId: unidadeMap["Unidade Teste"],
                criadoPorId: usuarioMap["Renato Martins"],
                dataPedido: new Date("2025-06-14T11:15:00.000Z"),
                dataEnvio: new Date("2025-06-20T09:00:00.000Z"),
                valorTotal: "75000.00",
                documentoReferencia: "PED-CF-20250614",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido semestral — equipamentos de manejo (balança eletrônica e tronco de contenção)."
            }
        ];
        for (const p of pedidosFazenda) {
            await criarPedidoComItens({
                contratoId: p.contratoId,
                origemFornecedorExternoId: p.origemFornecedorExternoId,
                origemUnidadeId: p.origemUnidadeId,
                destinoUnidadeId: p.destinoUnidadeId,
                criadoPorId: p.criadoPorId,
                dataEnvio: p.dataEnvio,
                documentoReferencia: p.documentoReferencia,
                observacoes: p.observacoes
            });
        }

        console.log("Pedidos e itens criados com sucesso!");

        // === Após criar pedidos ===

        // // Buscar itens de contrato
        // const contratoItens = await prisma.fornecedorItem.findMany({
        //     select: { id: true, contratoId: true, sku: true, nome: true, unidadeMedida: true, precoUnitario: true }
        // });

        // // Agrupar por contrato
        // const itensPorContrato = contratoItens.reduce((acc, it) => {
        //     if (!acc[it.contratoId]) acc[it.contratoId] = [];
        //     acc[it.contratoId].push(it);
        //     return acc;
        // }, {});

        // // Função simples para sugerir quantidade
        // function sugestaoQuantidade(um) {
        //     switch (um) {
        //         case "UNIDADE": return 10;
        //         case "KG": return 50;
        //         case "SACA": return 50;
        //         case "LITRO": return 5;
        //         case "G": return 100;
        //         case "CABECA": return 1;
        //         default: return 10;
        //     }
        // }

        // const pedidosEntregues = await prisma.pedido.findMany({
        //     where: { status: "ENTREGUE" },
        //     select: { id: true, contratoId: true }
        // });

        // for (const ped of pedidosEntregues) {
        //     if (!ped.contratoId) continue;
        //     const itensContrato = itensPorContrato[ped.contratoId] || [];

        //     const jaTemItens = await prisma.pedidoItem.count({ where: { pedidoId: ped.id } });
        //     if (jaTemItens > 0) continue;

        //     const itensPedidoData = itensContrato.map(it => ({
        //         pedidoId: ped.id,
        //         fornecedorItemId: it.id,
        //         quantidade: sugestaoQuantidade(it.unidadeMedida),
        //         unidadeMedida: it.unidadeMedida || "UNIDADE",
        //         precoUnitario: it.precoUnitario || 0,
        //         custoTotal: it.precoUnitario ? it.precoUnitario * sugestaoQuantidade(it.unidadeMedida) : null,
        //         observacoes: "Item gerado a partir do contrato"
        //     }));

        //     if (itensPedidoData.length > 0) {
        //         await prisma.pedidoItem.createMany({ data: itensPedidoData, skipDuplicates: true });
        //         console.log(`Itens de pedido criados para pedido ${ped.id}: ${itensPedidoData.length}`);
        //     }
        // }

        // constantes (ajuste se seus enums tiverem nomes diferentes)
        // const MOV_ENTRADA = "ENTRADA";
        // const STATUS_ENTREGUE = "ENTREGUE";

        // // --------------- 1) Atualizar pedidos -> marcar ENTREGUE ---------------
        // console.log("1) Atualizando pedidos para ENTREGUE...");

        // for (const pedidoObj of pedidosFazenda) {
        //     // tenta achar pelo documentoReferencia (presume pedidos já existem no DB)
        //     const pedidoDb = await prisma.pedido.findFirst({ where: { documentoReferencia: pedidoObj.documentoReferencia } });
        //     if (!pedidoDb) {
        //         console.warn(`Pedido não encontrado: ${pedidoObj.documentoReferencia} — pulando update.`);
        //         continue;
        //     }

        //     // dataRecebimento: usar dataEnvio + 1 dia para simular entrega (se dataEnvio estiver set)
        //     const dataRecebimento = pedidoDb.dataEnvio ? new Date(new Date(pedidoDb.dataEnvio).getTime() + 24 * 60 * 60 * 1000) : new Date();

        //     await prisma.pedido.update({
        //         where: { id: pedidoDb.id },
        //         data: {
        //             status: STATUS_ENTREGUE,
        //             dataRecebimento: dataRecebimento,
        //             updatedAt: new Date()
        //         }
        //     });

        //     console.log(`Pedido ${pedidoObj.documentoReferencia} (id ${pedidoDb.id}) marcado como ENTREGUE com data ${dataRecebimento.toISOString()}.`);
        // }

        // // === Após criar PedidoItem ===

        // // Buscar insumos existentes
        // const insumosAll = await prisma.insumo.findMany({ select: { id: true, sku: true } });
        // const insumoBySku = {};
        // insumosAll.forEach(i => { if (i.sku) insumoBySku[i.sku] = i; });

        // const pedidosComItens = await prisma.pedido.findMany({
        //     where: { status: "ENTREGUE" },
        //     select: {
        //         id: true,
        //         destinoUnidadeId: true,
        //         origemFornecedorExternoId: true,
        //         dataRecebimento: true,
        //         itens: { select: { id: true, fornecedorItemId: true, quantidade: true } }
        //     }
        // });

        // for (const ped of pedidosComItens) {
        //     if (!ped.destinoUnidadeId) continue;

        //     for (const item of ped.itens) {
        //         if (!item.fornecedorItemId) continue;

        //         const fornecedorItem = await prisma.fornecedorItem.findUnique({
        //             where: { id: item.fornecedorItemId },
        //             select: { sku: true }
        //         });

        //         const sku = fornecedorItem?.sku;
        //         if (!sku || !insumoBySku[sku]) continue;

        //         const insumoCatalogo = insumoBySku[sku];
        //         const quantidadeInt = Math.round(item.quantidade);

        //         let estoque = await prisma.estoque.findFirst({
        //             where: { unidadeId: ped.destinoUnidadeId, insumoId: insumoCatalogo.id }
        //         });

        //         if (!estoque) {
        //             estoque = await prisma.estoque.create({
        //                 data: {
        //                     unidadeId: ped.destinoUnidadeId,
        //                     insumoId: insumoCatalogo.id,
        //                     quantidade: quantidadeInt,
        //                     estoqueMinimo: 0
        //                 }
        //             });
        //             console.log(`Estoque criado: unidade ${ped.destinoUnidadeId} - insumo ${insumoCatalogo.id} (+${quantidadeInt})`);
        //         } else {
        //             await prisma.estoque.update({
        //                 where: { id: estoque.id },
        //                 data: { quantidade: { increment: quantidadeInt } }
        //             });
        //             console.log(`Estoque atualizado: id ${estoque.id} (+${quantidadeInt})`);
        //         }

        //         await prisma.estoqueMovimento.create({
        //             data: {
        //                 estoqueId: estoque.id,
        //                 tipoMovimento: "ENTRADA",
        //                 quantidade: quantidadeInt,
        //                 pedidoId: ped.id,
        //                 origemUnidadeId: null,
        //                 destinoUnidadeId: ped.destinoUnidadeId,
        //                 data: ped.dataRecebimento || new Date()
        //             }
        //         });
        //         console.log(`Movimento de ENTRADA registrado para estoque ${estoque.id}, pedido ${ped.id}`);
        //     }
        // }
        // ===============================
        // CONSTANTES
        // ===============================
        const MOV_ENTRADA = "ENTRADA";
        const STATUS_ENTREGUE = "ENTREGUE";

        // ===============================
        // 1) MARCAR PEDIDOS COMO ENTREGUE
        // ===============================
        async function marcarPedidosComoEntregues(prisma, pedidosFazenda) {
            console.log("1) Atualizando pedidos para ENTREGUE...");

            for (const pedido of pedidosFazenda) {
                const pedidoDb = await prisma.pedido.findFirst({
                    where: { documentoReferencia: pedido.documentoReferencia }
                });

                if (!pedidoDb) {
                    console.warn(`Pedido não encontrado: ${pedido.documentoReferencia}`);
                    continue;
                }

                const dataRecebimento =
                    pedidoDb.dataEnvio
                        ? new Date(new Date(pedidoDb.dataEnvio).getTime() + 86400000)
                        : new Date();

                await prisma.pedido.update({
                    where: { id: pedidoDb.id },
                    data: {
                        status: STATUS_ENTREGUE,
                        dataRecebimento,
                        updatedAt: new Date()
                    }
                });

                console.log(
                    `Pedido ${pedido.documentoReferencia} marcado como ENTREGUE.`
                );
            }
        }

        // ===============================
        // 2) MAPEAR INSUMOS POR SKU
        // ===============================
        async function mapearInsumosPorSku(prisma) {
            const insumos = await prisma.insumo.findMany({
                select: { id: true, sku: true }
            });

            const mapa = {};
            for (const ins of insumos) {
                if (ins.sku) mapa[ins.sku] = ins;
            }
            return mapa;
        }

        // ===============================
        // 3) DAR ENTRADA NO ESTOQUE
        // ===============================
        async function registrarEntradaEstoque(prisma, pedidosComItens, insumoBySku) {
            for (const ped of pedidosComItens) {
                if (!ped.destinoUnidadeId) continue;

                for (const item of ped.itens) {
                    const fornecedorItem = await prisma.fornecedorItem.findUnique({
                        where: { id: item.fornecedorItemId },
                        select: { sku: true }
                    });

                    const sku = fornecedorItem?.sku;
                    if (!sku || !insumoBySku[sku]) continue;

                    const insumoCatalogo = insumoBySku[sku];
                    const quantidade = Math.round(item.quantidade);

                    // buscar ou criar estoque
                    let estoque = await prisma.estoque.findFirst({
                        where: {
                            unidadeId: ped.destinoUnidadeId,
                            insumoId: insumoCatalogo.id
                        }
                    });

                    if (!estoque) {
                        estoque = await prisma.estoque.create({
                            data: {
                                unidadeId: ped.destinoUnidadeId,
                                insumoId: insumoCatalogo.id,
                                quantidade,
                                estoqueMinimo: 0
                            }
                        });

                        console.log(
                            `Estoque criado: unidade ${ped.destinoUnidadeId} - insumo ${insumoCatalogo.id} (+${quantidade})`
                        );
                    } else {
                        await prisma.estoque.update({
                            where: { id: estoque.id },
                            data: { quantidade: { increment: quantidade } }
                        });

                        console.log(
                            `Estoque atualizado: id ${estoque.id} (+${quantidade})`
                        );
                    }

                    // registrar movimento
                    await prisma.estoqueMovimento.create({
                        data: {
                            estoqueId: estoque.id,
                            tipoMovimento: MOV_ENTRADA,
                            quantidade,
                            pedidoId: ped.id,
                            origemUnidadeId: null,
                            destinoUnidadeId: ped.destinoUnidadeId,
                            data: ped.dataRecebimento ?? new Date()
                        }
                    });

                    console.log(
                        `Movimento de ENTRADA registrado no estoque ${estoque.id} para pedido ${ped.id}.`
                    );
                }
            }
        }

        // ===============================
        // FUNÇÃO ORQUESTRADORA
        // ===============================
        async function processarEntradasDePedidos(prisma, pedidosFazenda) {
            // 1) marcar como entregue
            await marcarPedidosComoEntregues(prisma, pedidosFazenda);

            // 2) mapear insumos por sku
            const insumoBySku = await mapearInsumosPorSku(prisma);

            // 3) buscar pedidos já entregues
            const pedidosComItens = await prisma.pedido.findMany({
                where: { status: STATUS_ENTREGUE },
                select: {
                    id: true,
                    destinoUnidadeId: true,
                    dataRecebimento: true,
                    itens: {
                        select: {
                            id: true,
                            fornecedorItemId: true,
                            quantidade: true
                        }
                    }
                }
            });

            // 4) registrar entrada do estoque
            await registrarEntradaEstoque(prisma, pedidosComItens, insumoBySku);
        }
        await processarEntradasDePedidos(prisma, pedidosFazenda);

        // === Após registrar EstoqueMovimento ===
        // helper para mapear categoria Json -> TipoAnimais
        function tipoAnimalFromCategoria(categoriaJson, TAN) {
            const cats = Array.isArray(categoriaJson) ? categoriaJson.map(c => String(c).toLowerCase()) : [];
            if (cats.includes("reprodutor") || cats.includes("reprodução") || cats.includes("reproducao")) return TAN.REPRODUCAO;
            if (cats.includes("abate")) return TAN.ABATE;
            if (cats.includes("venda")) return TAN.VENDA;
            // fallback
            return TAN.REPRODUCAO;
        }

        /* Busca ou cria um lote com o nome dado para a unidade indicada. Retorna o registro do lote. */
        async function findOrCreateLote(prisma, nome, unidadeId, responsavelId, tipoLote, unidadeMedida) {
            const existente = await prisma.lote.findFirst({
                where: { nome, unidadeId }
            });
            if (existente) {
                console.log(`Lote existente: ${nome} (id ${existente.id})`);
                return existente;
            }
            const criado = await prisma.lote.create({
                data: {
                    nome,
                    unidadeId,
                    responsavelId,
                    tipo: tipoLote,
                    preco: 0,
                    unidadeMedida,
                    criadoEm: new Date()
                }
            });
            console.log(`Lote criado: ${nome} (id ${criado.id})`);
            return criado;
        }

        /* Principal: processa pedidos ENTREGUE, cria animais e garante lotes iniciais.  */
        async function processarAnimaisELotes(prisma, unidadeMap, usuarioMap, enums, options = {}) {
            const { TAN, TL, UMED } = enums;
            const STATUS_ENTREGUE = options.statusEntregue ?? "ENTREGUE";

            // 1) Buscar pedidos ENTREGUE com itens
            const pedidosEntreguesAnimais = await prisma.pedido.findMany({
                where: { status: STATUS_ENTREGUE },
                select: {
                    id: true,
                    destinoUnidadeId: true,
                    origemFornecedorExternoId: true,
                    dataRecebimento: true,
                    itens: { select: { fornecedorItemId: true, quantidade: true } }
                }
            });

            if (!pedidosEntreguesAnimais.length) {
                console.log("Nenhum pedido ENTREGUE encontrado para processar animais.");
            }

            // 2) Coletar ids de fornecedorItem para buscar em batch
            const fornecedorItemIdsSet = new Set();
            for (const ped of pedidosEntreguesAnimais) {
                for (const it of ped.itens) {
                    if (it.fornecedorItemId) fornecedorItemIdsSet.add(it.fornecedorItemId);
                }
            }
            const fornecedorItemIds = Array.from(fornecedorItemIdsSet);
            const fornecedorItems = fornecedorItemIds.length
                ? await prisma.fornecedorItem.findMany({
                    where: { id: { in: fornecedorItemIds } },
                    select: { id: true, sku: true, nome: true, raca: true, categoria: true }
                })
                : [];

            const fiById = Object.fromEntries(fornecedorItems.map(fi => [fi.id, fi]));

            // 3) Para cada pedido, criar animais baseado em fornecedorItem (somente se categoria incluir "animal")
            for (const ped of pedidosEntreguesAnimais) {
                if (!ped.destinoUnidadeId) continue;

                for (const it of ped.itens) {
                    if (!it.fornecedorItemId) continue;
                    const fi = fiById[it.fornecedorItemId];
                    if (!fi) continue;

                    const categorias = Array.isArray(fi.categoria) ? fi.categoria.map(c => String(c).toLowerCase()) : [];
                    const isAnimal = categorias.includes("animal");
                    if (!isAnimal) continue; // pula itens que não são animais

                    const quantidadeInt = Math.round(Number(it.quantidade || 0));
                    if (quantidadeInt <= 0) {
                        console.log(`Quantidade zero no item ${fi.id} do pedido ${ped.id} — pulando criação de animal.`);
                        continue;
                    }

                    const racaFinal = fi.raca || "Indefinido";
                    const tipoFinal = tipoAnimalFromCategoria(fi.categoria, TAN);

                    const nomeLower = (fi.nome || "").toLowerCase();
                    const animalBase =
                        nomeLower.includes("touro") ? "Touro" :
                            nomeLower.includes("vaca") || nomeLower.includes("vache") ? "Vaca" :
                                "Bovino";

                    // 1) cria o registro de animal agregando a quantidade
                    const createdAnimal = await prisma.animal.create({
                        data: {
                            animal: animalBase,
                            raca: racaFinal,
                            unidadeId: ped.destinoUnidadeId,
                            quantidade: quantidadeInt,
                            tipo: tipoFinal,
                            custo: null,
                            dataEntrada: ped.dataRecebimento || new Date(),
                            fornecedorId: ped.origemFornecedorExternoId || null
                        }
                    });

                    // 2) gera um SKU único para esse animal e cria um fornecedorItem representando esse animal
                    //    formato SKU: <RACA_ABREV>-<TIPO_ABREV>-<pedidoId>-<fornecedorItemId>
                    const racaAbrev = (racaFinal || 'XXX').toString().replace(/\s+/g, '').slice(0, 4).toUpperCase();
                    const tipoAbrev = (animalBase || 'ANM').toString().replace(/\s+/g, '').slice(0, 4).toUpperCase();
                    // usar timestamp curto para evitar colisão
                    const ts = String(Date.now()).slice(-6);
                    const newSku = `${racaAbrev}-${tipoAbrev}-${ped.id}-${ts}`;

                    // tenta reutilizar contratoId (se disponível no fornecedorItem original)
                    const contratoIdParaItem = fi.contratoId || null;

                    // cria o fornecedorItem que representa esse animal (se sua tabela fornecedorItem aceitar esses campos)
                    // ajuste campos conforme seu schema se necessário.
                    try {
                        const novoFornecedorItem = await prisma.fornecedorItem.create({
                            data: {
                                contratoId: contratoIdParaItem,
                                sku: newSku,
                                nome: fi.nome || `${animalBase} ${racaFinal}`,
                                raca: fi.raca || null,
                                categoria: fi.categoria || ["Animal"],
                                unidadeMedida: UMED.CABECA || null,
                                quantidade: quantidadeInt,
                                precoUnitario: fi.precoUnitario ?? 0,
                                ativo: true,
                                criadoEm: new Date()
                            }
                        });
                        console.log(`FornecedorItem criado para animal: sku=${newSku} (id fornecedorItem ${novoFornecedorItem.id})`);
                    } catch (err) {
                        // se a criação do fornecedorItem falhar por qualquer motivo, apenas loga e segue
                        console.warn(`Falha ao criar fornecedorItem para animal ${createdAnimal.id} (sku ${newSku}):`, err?.message || err);
                    }

                    // 3) popula animalMap por sku (agora animalMap[sku] = id)
                    try {
                        if (typeof animalMap === "object" && animalMap !== null) {
                            animalMap[newSku] = createdAnimal.id;
                        } else {
                            // se animalMap não existir, cria o objeto globalmente
                            globalThis.animalMap = globalThis.animalMap || {};
                            globalThis.animalMap[newSku] = createdAnimal.id;
                        }
                    } catch (err) {
                        console.warn("Não foi possível escrever em animalMap:", err?.message || err);
                    }

                    console.log(`Criado animal (${animalBase}) x${quantidadeInt} para unidade ${ped.destinoUnidadeId} — animal.id=${createdAnimal.id}, sku=${newSku}.`);
                }
            }
            // 4) Garantir lotes iniciais (cria apenas se não existir)
            // Use nomes e responsáveis conforme seu seed original
            await findOrCreateLote(prisma, "Lote Inicial Beta", unidadeMap["Fazenda Beta"], usuarioMap["Richard Souza"], TL.GADO, UMED.CABECA);
            await findOrCreateLote(prisma, "Lote Inicial Teste", unidadeMap["Fazenda Teste"], usuarioMap["Usuario Ficticio"], TL.GADO, UMED.CABECA);
            await findOrCreateLote(prisma, "Lote Inicial Alpha", unidadeMap["Fazenda Alpha"], usuarioMap["Juliana Correia"], TL.GADO, UMED.KG);
            await findOrCreateLote(prisma, "Lote Inicial Gamma", unidadeMap["Fazenda Gamma"], usuarioMap["Otávio Viana"], TL.PLANTIO, UMED.SACA);
            await findOrCreateLote(prisma, "Lote Inicial Delta", unidadeMap["Fazenda Delta"], usuarioMap["Kátia Oliveira"], TL.PLANTIO, UMED.UNIDADE);

            console.log("Processamento de animais e lotes concluído.");
        }

        await processarAnimaisELotes(prisma, unidadeMap, usuarioMap, { TAN, TL, UMED });
        // const pedidosEntreguesAnimais = await prisma.pedido.findMany({
        //     where: { status: "ENTREGUE" },
        //     select: {
        //         id: true,
        //         destinoUnidadeId: true,
        //         origemFornecedorExternoId: true,
        //         dataRecebimento: true,
        //         itens: { select: { fornecedorItemId: true, quantidade: true } }
        //     }
        // });

        // for (const ped of pedidosEntreguesAnimais) {
        //     if (!ped.destinoUnidadeId) continue;

        //     for (const it of ped.itens) {
        //         if (!it.fornecedorItemId) continue;
        //         const fi = await prisma.fornecedorItem.findUnique({
        //             where: { id: it.fornecedorItemId },
        //             select: { sku: true, nome: true, raca: true, categoria: true }
        //         });

        //         // Só cria animal quando o item é de fato “Animal”
        //         const categorias = Array.isArray(fi?.categoria) ? fi.categoria : [];
        //         const isAnimal = categorias.map(c => String(c).toLowerCase()).includes("animal");
        //         if (!isAnimal) continue;

        //         const quantidadeInt = Math.round(Number(it.quantidade || 0));
        //         const racaFinal = fi?.raca || "Indefinido"; // preferível ser sempre preenchida no item
        //         const tipoFinal = tipoAnimalFromCategoria(fi?.categoria);
        //         const nomeLower = (fi?.nome || "").toLowerCase();
        //         const animalBase =
        //             nomeLower.includes("touro") ? "Touro" :
        //                 nomeLower.includes("vaca") ? "Vaca" :
        //                     "Bovino";

        //         await prisma.animal.create({
        //             data: {
        //                 animal: animalBase,
        //                 raca: racaFinal,
        //                 unidadeId: ped.destinoUnidadeId,
        //                 quantidade: quantidadeInt,
        //                 tipo: tipoFinal,
        //                 custo: null,
        //                 dataEntrada: ped.dataRecebimento || new Date(),
        //                 fornecedorId: ped.origemFornecedorExternoId || null
        //             }
        //         });
        //     }
        // }

        // // ===== LOTES =====
        // let loteBeta = await prisma.lote.findFirst({
        //     where: { nome: "Lote Inicial Beta", unidadeId: unidadeMap["Fazenda Beta"] }
        // });
        // if (!loteBeta) {
        //     loteBeta = await prisma.lote.create({
        //         data: {
        //             nome: "Lote Inicial Beta",
        //             unidadeId: unidadeMap["Fazenda Beta"],
        //             responsavelId: usuarioMap["Richard Souza"],
        //             tipo: TL.GADO,
        //             preco: 0,
        //             unidadeMedida: UMED.CABECA,
        //             criadoEm: new Date()
        //         }
        //     });
        //     console.log(`Lote criado: Lote Inicial Beta (id ${loteBeta.id})`);
        // } else {
        //     console.log(`Lote existente: Lote Inicial Beta (id ${loteBeta.id})`);
        // }

        // let loteTeste = await prisma.lote.findFirst({
        //     where: { nome: "Lote Inicial Teste", unidadeId: unidadeMap["Fazenda Teste"] }
        // });
        // if (!loteTeste) {
        //     loteTeste = await prisma.lote.create({
        //         data: {
        //             nome: "Lote Inicial Teste",
        //             unidadeId: unidadeMap["Fazenda Teste"],
        //             responsavelId: usuarioMap["Usuario Ficticio"],
        //             tipo: TL.GADO,
        //             preco: 0,
        //             unidadeMedida: UMED.CABECA,
        //             criadoEm: new Date()
        //         }
        //     });
        //     console.log(`Lote criado: Lote Inicial Teste (id ${loteTeste.id})`);
        // } else {
        //     console.log(`Lote existente: Lote Inicial Teste (id ${loteTeste.id})`);
        // }

        // // Fazenda Alpha
        // let loteAlpha = await prisma.lote.findFirst({
        //     where: { nome: "Lote Inicial Alpha", unidadeId: unidadeMap["Fazenda Alpha"] }
        // });
        // if (!loteAlpha) {
        //     loteAlpha = await prisma.lote.create({
        //         data: {
        //             nome: "Lote Inicial Alpha",
        //             unidadeId: unidadeMap["Fazenda Alpha"],
        //             responsavelId: usuarioMap["Juliana Correia"],
        //             tipo: TL.GADO, // pode ser TL.CARNE se você tiver enum específico
        //             preco: 0,
        //             unidadeMedida: UMED.KG,
        //             criadoEm: new Date()
        //         }
        //     });
        //     console.log(`Lote criado: Lote Inicial Alpha (id ${loteAlpha.id})`);
        // } else {
        //     console.log(`Lote existente: Lote Inicial Alpha (id ${loteAlpha.id})`);
        // }

        // // Fazenda Gamma
        // let loteGamma = await prisma.lote.findFirst({
        //     where: { nome: "Lote Inicial Gamma", unidadeId: unidadeMap["Fazenda Gamma"] }
        // });
        // if (!loteGamma) {
        //     loteGamma = await prisma.lote.create({
        //         data: {
        //             nome: "Lote Inicial Gamma",
        //             unidadeId: unidadeMap["Fazenda Gamma"],
        //             responsavelId: usuarioMap["Otávio Viana"],
        //             tipo: TL.PLANTIO,
        //             preco: 0,
        //             unidadeMedida: UMED.SACA,
        //             criadoEm: new Date()
        //         }
        //     });
        //     console.log(`Lote criado: Lote Inicial Gamma (id ${loteGamma.id})`);
        // } else {
        //     console.log(`Lote existente: Lote Inicial Gamma (id ${loteGamma.id})`);
        // }

        // // Fazenda Delta
        // let loteDelta = await prisma.lote.findFirst({
        //     where: { nome: "Lote Inicial Delta", unidadeId: unidadeMap["Fazenda Delta"] }
        // });
        // if (!loteDelta) {
        //     loteDelta = await prisma.lote.create({
        //         data: {
        //             nome: "Lote Inicial Delta",
        //             unidadeId: unidadeMap["Fazenda Delta"],
        //             responsavelId: usuarioMap["Kátia Oliveira"],
        //             tipo: TL.PLANTIO,
        //             preco: 0,
        //             unidadeMedida: UMED.UNIDADE,
        //             criadoEm: new Date()
        //         }
        //     });
        //     console.log(`Lote criado: Lote Inicial Delta (id ${loteDelta.id})`);
        // } else {
        //     console.log(`Lote existente: Lote Inicial Delta (id ${loteDelta.id})`);
        // }

        // movimentacao estoque dos insumos pra uso (saida)
        // ===== SAÍDA DE ESTOQUE =====
        async function registrarSaida(insumoId, unidadeId, quantidade, responsavelId, loteId) {
            const estoque = await prisma.estoque.findFirst({ where: { unidadeId, insumoId } });
            if (!estoque) {
                console.log(`Estoque não encontrado para insumo ${insumoId}`);
                return;
            }
            // Atualiza quantidade
            await prisma.estoque.update({
                where: { id: estoque.id },
                data: { quantidade: { decrement: quantidade } }
            });
            // Registra movimento
            await prisma.estoqueMovimento.create({
                data: {
                    estoqueId: estoque.id,
                    tipoMovimento: TM.SAIDA,
                    quantidade,
                    origemUnidadeId: unidadeId,
                    data: new Date(),
                    loteId
                }
            });
            console.log(`Saída registrada: insumo ${insumoId}, qtd ${quantidade}`);
        }

        // ------------------ atvd_animalia ------------------
        const animals = await prisma.animal.findMany({
            select: { id: true, sku: true, nome: true }
        });
        const animalMap = {};
        for (const a of animals) {
            if (a.sku) animalMap[a.sku] = a.id;
        }
        // 4) Montar atividades realistas (cada item precisa de animalId)
        const atvdAnimaliaBeta = [
            // RECEBIMENTO: animais vivos chegam
            {
                animalId: animalMap["TOURO-NEL-001"],
                insumoId: null,
                descricao: "Recebimento do touro Nelore reprodutor. Checagem sanitária, identificação e quarentena inicial (observação 48h).",
                tipo: TANIMALIA.RECEBIMENTO,
                loteId: loteBeta.id,
                dataInicio: new Date("2025-04-10T09:00:00.000Z"),
                responsavelId: usuarioMap["Richard Souza"],
                // anexos: { nf: "NF-ANIM-20250410", fotos: [] },
                status: "ATIVA"
            },
            {
                animalId: animalMap["VACA-HOL-001"],
                insumoId: null,
                descricao: "Recebimento de vaca de reposição. Registro, identificação (brinco) e exame clínico inicial.",
                tipo: TANIMALIA.RECEBIMENTO,
                loteId: loteBeta.id,
                dataInicio: new Date("2025-04-10T09:30:00.000Z"),
                responsavelId: usuarioMap["Richard Souza"],
                // anexos: { nf: "NF-ANIM-20250410-2" },
                status: "ATIVA"
            },

            // VACINAÇÃO: aplicar vacina brucelose
            {
                animalId: animalMap["VACA-HOL-001"],
                insumoId: insumoMap["VAC-BRU-010"] || null,
                descricao: "Aplicação de vacina contra brucelose (registro do lote da vacina e nota fiscal).",
                tipo: TANIMALIA.VACINACAO,
                loteId: loteBeta.id,
                dataInicio: new Date("2025-04-12T08:30:00.000Z"),
                responsavelId: usuarioMap["Richard Souza"],
                // anexos: { loteVacina: "L20B-2025", nf: "NF-VAC-20250412" },
                status: "ATIVA"
            },

            // VERMIFUGAÇÃO / Sanidade geral (kit)
            {
                animalId: animalMap["VACA-HOL-001"],
                insumoId: insumoMap["KIT-SAN-001"] || insumoMap["ANTIPAR-50ML"] || null,
                descricao: "Aplicação de kit de sanidade (antiparasitário + vitaminas) na vaca de reposição.",
                tipo: TANIMALIA.SANIDADE_GERAL,
                loteId: loteBeta.id,
                dataInicio: new Date("2025-04-12T09:15:00.000Z"),
                responsavelId: usuarioMap["Richard Souza"],
                // anexos: { nf: "NF-SAN-20250412" },
                status: "ATIVA"
            },

            // INSEMINAÇÃO (serviço) — vinculado à vaca
            {
                animalId: animalMap["VACA-HOL-001"],
                insumoId: null,
                descricao: "Inseminação artificial (serviço) — dose aplicada, técnico e protocolo.",
                tipo: TANIMALIA.INSEMINACAO,
                loteId: loteBeta.id,
                dataInicio: new Date("2025-04-20T07:00:00.000Z"),
                responsavelId: usuarioMap["Richard Souza"],
                // anexos: { tecnico: "Dr. João Vet", protocolo: "IA-20250420" },
                status: "ATIVA"
            },

            // ORDENHA_TESTE: controle de qualidade / amostragem de leite (vinculado à vaca)
            {
                animalId: animalMap["VACA-HOL-001"],
                insumoId: insumoMap["EMBAL-LEITE-1L"] || null,
                descricao: "Ordenha de prova: medição de volume, amostra para análise e checagem de mastite.",
                tipo: TANIMALIA.ORDENHA_TESTE,
                loteId: loteBeta.id,
                dataInicio: new Date("2025-04-15T05:30:00.000Z"),
                responsavelId: usuarioMap["Richard Souza"],
                // anexos: { volumeMl: 3200, resultadoPh: "6.7" },
                status: "ATIVA"
            },

            // COLETA_LEITE_AMOSTRA / uso de cultura para iogurte (atividade ligada ao leite)
            {
                animalId: animalMap["VACA-HOL-001"],
                insumoId: insumoMap["CULT-LACT-010"] || null,
                descricao: "Coleta de leite amostra para lote piloto de iogurte e adição de cultura starter (registro do lote da cultura).",
                tipo: TANIMALIA.COLETA_LEITE_AMOSTRA,
                loteId: loteBeta.id,
                dataInicio: new Date("2025-04-16T10:00:00.000Z"),
                responsavelId: usuarioMap["Richard Souza"],
                // anexos: { loteCultura: "CL-20250301" },
                status: "ATIVA"
            },

            // OCORRÊNCIA: transporte/saúde do touro
            {
                animalId: animalMap["TOURO-NEL-001"],
                insumoId: null,
                descricao: "Ocorrência: reação leve ao transporte — observação e repouso 48h, sem necessidade de intervenção farmacológica.",
                tipo: TANIMALIA.OCORRENCIA,
                loteId: loteBeta.id,
                dataInicio: new Date("2025-04-11T14:00:00.000Z"),
                responsavelId: usuarioMap["Richard Souza"],
                // anexos: null,
                status: "ATIVA"
            },

        ];
        // Registrar saída antes de inserir atividade
        for (const atvd of atvdAnimaliaBeta) {
            if (atvd.insumoId) {
                await registrarSaida(atvd.insumoId, unidadeMap["Fazenda Beta"], 1, atvd.responsavelId, loteBeta.id);
            }
        }
        await prisma.atvdAnimalia.createMany({ data: atvdAnimaliaBeta, skipDuplicates: true });
        console.log(`Atividades Beta inseridas: ${atvdAnimaliaBeta.length}`);


        // ===== ATIVIDADES ANIMALIA (Unidade Teste) =====
        const atividadesTeste = [
            // Recebimento dos animais
            {
                animalId: animalMapTeste["TOURO NELORE"],
                insumoId: null,
                descricao: "Recebimento do touro Nelore reprodutor. Checagem sanitária e quarentena inicial.",
                tipo: TANIMALIA.RECEBIMENTO,
                loteId: loteTeste.id,
                dataInicio: new Date("2025-04-10T09:00:00.000Z"),
                responsavelId: usuarioMap["Usuario Ficticio"],
                // anexos: { nf: "NF-TESTE-ANIM-001" },
                status: "ATIVA"
            },
            {
                animalId: animalMapTeste["VACA HOLANDESA"],
                insumoId: null,
                descricao: "Recebimento da vaca Holandesa pronta para ordenha.",
                tipo: TANIMALIA.RECEBIMENTO,
                loteId: loteTeste.id,
                dataInicio: new Date("2025-04-11T09:00:00.000Z"),
                responsavelId: usuarioMap["Usuario Ficticio"],
                // anexos: { nf: "NF-TESTE-ANIM-002" },
                status: "ATIVA"
            },

            // Nutrição
            {
                animalId: animalMapTeste["VACA HOLANDESA"],
                insumoId: insumoMap["SILAGEM-MILHO-500KG"],
                descricao: "Fornecimento de silagem de milho para vaca Holandesa.",
                tipo: TANIMALIA.ALIMENTACAO,
                loteId: loteTeste.id,
                dataInicio: new Date("2025-04-12T08:00:00.000Z"),
                responsavelId: usuarioMap["Usuario Ficticio"],
                // anexos: { quantidadeKg: 25 },
                status: "ATIVA"
            },
            {
                animalId: animalMapTeste["TOURO NELORE"],
                insumoId: insumoMap["FENO-CAPIM-BALE"],
                descricao: "Fornecimento de feno de capim para touro Nelore.",
                tipo: TANIMALIA.ALIMENTACAO,
                loteId: loteTeste.id,
                data: new Date("2025-04-12T09:00:00.000Z"),
                responsavelId: usuarioMap["Usuario Ficticio"],
                // anexos: { quantidadeKg: 10 },
                status: "ATIVA"
            },

            // Sanidade
            {
                animalId: animalMapTeste["TOURO NELORE"],
                insumoId: insumoMap["VACINA-FOOT-AND-MOUTH"],
                descricao: "Aplicação de vacina contra febre aftosa.",
                tipo: TANIMALIA.VACINACAO,
                loteId: loteTeste.id,
                dataInicio: new Date("2025-04-20T08:00:00.000Z"),
                responsavelId: usuarioMap["Usuario Ficticio"],
                // anexos: { loteVacina: "FA-2025" },
                status: "ATIVA"
            },
            {
                animalId: animalMapTeste["VACA HOLANDESA"],
                insumoId: insumoMap["ANTIBIOTICO-BOV-100ML"],
                descricao: "Aplicação de antibiótico bovino para tratamento preventivo.",
                tipo: TANIMALIA.MEDICACAO,
                loteId: loteTeste.id,
                dataInicio: new Date("2025-04-21T09:00:00.000Z"),
                responsavelId: usuarioMap["Usuario Ficticio"],
                // anexos: { doseMl: 20 },
                status: "ATIVA"
            },

            // Genética
            {
                animalId: animalMapTeste["VACA HOLANDESA"],
                insumoId: insumoMap["SEMEN-TOURO-ALTA"],
                descricao: "Inseminação artificial com sêmen de alta performance.",
                tipo: TANIMALIA.INSEMINACAO,
                loteId: loteTeste.id,
                dataInicio: new Date("2025-04-22T07:00:00.000Z"),
                responsavelId: usuarioMap["Usuario Ficticio"],
                // anexos: { tecnico: "Dr. Silva", protocolo: "IA-TESTE-2025" },
                status: "ATIVA"
            },

            // Equipamentos
            {
                animalId: animalMapTeste["TOURO NELORE"],
                insumoId: insumoMap["BALANCA-BOV-500KG"],
                descricao: "Pesagem do touro Nelore em balança eletrônica.",
                tipo: TANIMALIA.PESAGEM,
                loteId: loteTeste.id,
                dataInicio: new Date("2025-04-23T10:00:00.000Z"),
                responsavelId: usuarioMap["Usuario Ficticio"],
                // anexos: { pesoKg: 480 },
                status: "ATIVA"
            },
            {
                animalId: animalMapTeste["VACA HOLANDESA"],
                insumoId: insumoMap["TRONCO-CONTENCAO-001"],
                descricao: "Uso de tronco de contenção para exame clínico.",
                tipo: TANIMALIA.EXAME_CLINICO,
                loteId: loteTeste.id,
                dataInicio: new Date("2025-04-23T11:00:00.000Z"),
                responsavelId: usuarioMap["Usuario Ficticio"],
                // anexos: { observacoes: "Animal contido sem estresse" },
                status: "ATIVA"
            }
        ];
        // Registrar saída antes de inserir atividade
        for (const atvd of atividadesTeste) {
            if (atvd.insumoId) {
                await registrarSaida(atvd.insumoId, unidadeMap["Fazenda Teste"], 1, atvd.responsavelId, loteTeste.id);
            }
        }
        await prisma.atvdAnimalia.createMany({ data: atividadesTeste, skipDuplicates: true });
        console.log(`Atividades Teste inseridas: ${atividadesTeste.length}`);

        const atvdsTeste = await prisma.atvdAnimalia.findMany({ where: { status: "ATIVA" } });

        for (const atvd of atvdsTeste) {
            await prisma.atvdAnimalia.update({
                where: { id: atvd.id },
                data: {
                    dataFim: new Date(new Date(atvd.dataInicio).getTime() + 60 * 60 * 1000), // +1h
                    status: "CONCLUIDA"
                }
            });
        }

        // Saída de estoque
        await registrarSaida(insumoBySku["CALC-AG-040"]?.id, unidadeMap["Fazenda Gamma"], 10, usuarioMap["Otávio Viana"], loteGamma.id);
        await registrarSaida(insumoBySku["SEED-SOJA-020"]?.id, unidadeMap["Fazenda Gamma"], 50, usuarioMap["Otávio Viana"], loteGamma.id);

        const atvdAgricolaGamma = [
            {
                insumoId: insumoBySku["CALC-AG-040"]?.id,
                descricao: "Calagem com calcário para correção de acidez do solo antes do plantio.",
                tipo: TAT.ADUBACAO, // uso como correção/adubação de base
                loteId: loteGamma.id,
                dataInicio: new Date("2025-02-15T07:00:00.000Z"),
                responsavelId: usuarioMap["Otávio Viana"],
                status: "EM_PREPARO",
            },
            {
                insumoId: insumoBySku["SEED-SOJA-020"]?.id,
                descricao: "Plantio de soja com semente de alta germinação (20kg por saca).",
                tipo: TAT.PLANTIO,
                loteId: loteGamma.id,
                dataInicio: new Date("2025-03-01T07:00:00.000Z"),
                responsavelId: usuarioMap["Otávio Viana"],
                status: "SEMEADO",
            },
            {
                insumoId: null,
                descricao: "Irrigação do talhão de soja (controle de umidade).",
                tipo: TAT.IRRIGACAO,
                loteId: loteGamma.id,
                dataInicio: new Date("2025-03-07T06:00:00.000Z"),
                responsavelId: usuarioMap["Otávio Viana"],
                status: "EM_DESENVOLVIMENTO",
            },
            {
                insumoId: null,
                descricao: "Colheita da soja do lote.",
                tipo: TAT.COLHEITA,
                loteId: loteGamma.id,
                dataInicio: new Date("2025-05-20T07:00:00.000Z"),
                responsavelId: usuarioMap["Otávio Viana"],
                status: "COLHIDO",
            },
        ];

        await prisma.atvdAgricola.createMany({ data: atvdAgricolaGamma, skipDuplicates: true });
        console.log(`Atividades de plantio (Gamma) inseridas: ${atvdAgricolaGamma.length}`);
        await prisma.atvdPlantio.createMany({ data: atvdPlantioGamma, skipDuplicates: true });

        // Saída de estoque (opcional, para refletir uso dos insumos nas atividades)
        await registrarSaida(insumoBySku["COMPO-MIC-010"]?.id, unidadeMap["Fazenda Delta"], 5, usuarioMap["Kátia Oliveira"], loteDelta.id);
        await registrarSaida(insumoBySku["NPK-20520-025"]?.id, unidadeMap["Fazenda Delta"], 20, usuarioMap["Kátia Oliveira"], loteDelta.id);
        await registrarSaida(insumoBySku["INOC-SOJA-001"]?.id, unidadeMap["Fazenda Delta"], 10, usuarioMap["Kátia Oliveira"], loteDelta.id);

        const atvdAgricolaDelta = [
            {
                insumoId: insumoBySku["COMPO-MIC-010"]?.id,
                descricao: "Aplicação de composto microbiano para aumentar a atividade biológica do solo nos canteiros.",
                tipo: TAT.ADUBACAO,
                loteId: loteDelta.id,
                dataInicio: new Date("2025-03-01T08:00:00.000Z"),
                responsavelId: usuarioMap["Kátia Oliveira"],
                status: "EM_PREPARO",
            },
            {
                insumoId: insumoBySku["NPK-20520-025"]?.id,
                descricao: "Adubação química de base com NPK 20-05-20 nos canteiros de alface e tomate.",
                tipo: TAT.ADUBACAO,
                loteId: loteDelta.id,
                dataInicio: new Date("2025-03-05T08:00:00.000Z"),
                responsavelId: usuarioMap["Kátia Oliveira"],
                status: "EM_DESENVOLVIMENTO",
            },
            {
                insumoId: null,
                descricao: "Plantio de mudas de alface e tomate nos canteiros preparados.",
                tipo: TAT.PLANTIO,
                loteId: loteDelta.id,
                dataInicio: new Date("2025-03-06T07:00:00.000Z"),
                responsavelId: usuarioMap["Kátia Oliveira"],
                status: "SEMEADO",
            },
            {
                insumoId: null,
                descricao: "Irrigação dos canteiros (controle diário de umidade).",
                tipo: TAT.IRRIGACAO,
                loteId: loteDelta.id,
                dataInicio: new Date("2025-03-07T06:00:00.000Z"),
                responsavelId: usuarioMap["Kátia Oliveira"],
                status: "EM_DESENVOLVIMENTO",
            },
            {
                insumoId: insumoBySku["INOC-SOJA-001"]?.id,
                descricao: "Aplicação de inoculante microbiano para reforço biológico no ciclo vegetativo.",
                tipo: TAT.USO_AGROTOXICO, // proxy para 'tratamento biológico' (enum não possui TRATAMENTO)
                loteId: loteDelta.id,
                dataInicio: new Date("2025-03-10T09:00:00.000Z"),
                responsavelId: usuarioMap["Kátia Oliveira"],
                status: "EM_DESENVOLVIMENTO",
            },
            {
                insumoId: null,
                descricao: "Colheita das hortaliças do lote.",
                tipo: TAT.COLHEITA,
                loteId: loteDelta.id,
                dataInicio: new Date("2025-04-01T06:00:00.000Z"),
                responsavelId: usuarioMap["Kátia Oliveira"],
                status: "COLHIDO",
            },
        ];

        await prisma.atvdAgricola.createMany({ data: atvdAgricolaDelta, skipDuplicates: true });
        console.log(`Atividades de plantio (Delta) inseridas: ${atvdAgricolaDelta.length}`);

        // ===== 15) Produção =====
        const producoesData = [
            // Fazenda Alpha (carne bovina)
            {
                loteId: loteMap["Lote Inicial Alpha"],
                animalId: animalMap["BOI NELORE"], // se tiver animal cadastrado
                tipoProduto: "Carne bovina dianteiro",
                quantidadeBruta: 500, // kg
                quantidadeLiquida: 480,
                unidadeMedida: UMED.KG,
                dataInicio: new Date("2025-05-10T08:00:00.000Z"),
                dataFim: new Date("2025-05-10T12:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Juliana Correia"],
                observacoes: "Abate de lote para fornecimento de carne dianteiro"
            },
            {
                loteId: loteMap["Lote Inicial Alpha"],
                animalId: animalMap["BOI NELORE"],
                tipoProduto: "Carne bovina traseiro",
                quantidadeBruta: 600,
                quantidadeLiquida: 580,
                unidadeMedida: UMED.KG,
                dataInicio: new Date("2025-05-11T08:00:00.000Z"),
                dataFim: new Date("2025-05-11T12:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Juliana Correia"],
                observacoes: "Abate de lote para fornecimento de carne traseiro"
            },

            // Fazenda Gamma (grãos)
            {
                loteId: loteMap["Lote Inicial Gamma"],
                tipoProduto: "Soja em saca 60kg",
                quantidadeBruta: 600, // sacas
                quantidadeLiquida: 590,
                unidadeMedida: UMED.SACA,
                dataInicio: new Date("2025-05-20T07:00:00.000Z"),
                dataFim: new Date("2025-05-20T18:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Otávio Viana"],
                observacoes: "Colheita de soja"
            },
            {
                loteId: loteMap["Lote Inicial Gamma"],
                tipoProduto: "Milho em saca 60kg",
                quantidadeBruta: 400,
                quantidadeLiquida: 395,
                unidadeMedida: UMED.SACA,
                dataInicio: new Date("2025-05-25T07:00:00.000Z"),
                dataFim: new Date("2025-05-25T18:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Otávio Viana"],
                observacoes: "Colheita de milho"
            },

            // Fazenda Beta (laticínios)
            {
                loteId: loteMap["Lote Inicial Beta"],
                animalId: animalMap["VACA HOLANDESA"],
                tipoProduto: "Leite pasteurizado 1L",
                quantidadeBruta: 1000, // litros
                quantidadeLiquida: 980,
                unidadeMedida: UMED.LITRO,
                dataInicio: new Date("2025-06-01T05:00:00.000Z"),
                dataFim: new Date("2025-06-01T08:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Richard Souza"],
                observacoes: "Ordenha e pasteurização"
            },
            {
                loteId: loteMap["Lote Inicial Beta"],
                tipoProduto: "Queijo Minas Frescal 500g",
                quantidadeBruta: 200, // kg
                quantidadeLiquida: 195,
                unidadeMedida: UMED.KG,
                dataInicio: new Date("2025-06-02T09:00:00.000Z"),
                dataFim: new Date("2025-06-02T15:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Richard Souza"],
                observacoes: "Produção de queijo frescal"
            },
            {
                loteId: loteMap["Lote Inicial Beta"],
                tipoProduto: "Iogurte natural 170g",
                quantidadeBruta: 500, // unidades
                quantidadeLiquida: 495,
                unidadeMedida: UMED.UNIDADE,
                dataInicio: new Date("2025-06-03T07:00:00.000Z"),
                dataFim: new Date("2025-06-03T12:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Richard Souza"],
                observacoes: "Produção de iogurte natural"
            },

            // Fazenda Delta (hortaliças)
            {
                loteId: loteMap["Lote Inicial Delta"],
                tipoProduto: "Alface crespa unidade",
                quantidadeBruta: 1000,
                quantidadeLiquida: 980,
                unidadeMedida: UMED.UNIDADE,
                dataInicio: new Date("2025-06-05T06:00:00.000Z"),
                dataFim: new Date("2025-06-05T12:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Kátia Oliveira"],
                observacoes: "Colheita de alface crespa"
            },
            {
                loteId: loteMap["Lote Inicial Delta"],
                tipoProduto: "Tomate caixa 20kg",
                quantidadeBruta: 200, // caixas
                quantidadeLiquida: 198,
                unidadeMedida: UMED.KG,
                dataInicio: new Date("2025-06-06T06:00:00.000Z"),
                dataFim: new Date("2025-06-06T12:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Kátia Oliveira"],
                observacoes: "Colheita de tomate"
            },

            // Unidade Teste (laticínios e carne)
            {
                loteId: loteMap["Lote Inicial Teste"],
                tipoProduto: "Leite pasteurizado 1L (teste)",
                quantidadeBruta: 200,
                quantidadeLiquida: 198,
                unidadeMedida: UMED.LITRO,
                dataInicio: new Date("2025-06-10T07:00:00.000Z"),
                dataFim: new Date("2025-06-10T09:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Usuario Ficticio"],
                observacoes: "Ordenha experimental e pasteurização"
            },
            {
                loteId: loteMap["Lote Inicial Teste"],
                tipoProduto: "Queijo fresco 500g (teste)",
                quantidadeBruta: 50,
                quantidadeLiquida: 49,
                unidadeMedida: UMED.KG,
                dataInicio: new Date("2025-06-11T08:00:00.000Z"),
                dataFim: new Date("2025-06-11T12:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Usuario Ficticio"],
                observacoes: "Produção de queijo fresco experimental"
            },
            {
                loteId: loteMap["Lote Inicial Teste"],
                tipoProduto: "Carne bovina corte dianteiro (teste)",
                quantidadeBruta: 100,
                quantidadeLiquida: 98,
                unidadeMedida: UMED.KG,
                dataInicio: new Date("2025-06-12T07:00:00.000Z"),
                dataFim: new Date("2025-06-12T12:00:00.000Z"),
                status: "CONCLUIDA",
                responsavelId: usuarioMap["Usuario Ficticio"],
                observacoes: "Abate experimental para carne dianteiro"
            }
        ];
        await prisma.producao.createMany({ data: producoesData, skipDuplicates: true });
        console.log(`Produções inseridas: ${producoesData.length}`);

        // pedidos
        const pedidosLojas = [
            // VerdeFresco Hortaliças → Fazenda Delta
            {
                contratoId: contratoMap["Fazenda Delta - VerdeFresco Hortaliças"],
                origemUnidadeId: unidadeMap["Fazenda Delta"], // fornecedor
                destinoUnidadeId: unidadeMap["VerdeFresco Hortaliças"], // loja
                criadoPorId: usuarioMap["Roberto Barros"], // gerente da loja
                dataPedido: new Date("2025-06-02T09:00:00.000Z"),
                dataEnvio: new Date("2025-06-04T08:00:00.000Z"),
                valorTotal: "12000.00",
                documentoReferencia: "PED-DELTA-VERDEFRESCO-20250602",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido mensal de hortaliças frescas."
            },

            // AgroBoi → Fazenda Alpha
            {
                contratoId: contratoMap["Fazenda Alpha - AgroBoi"],
                origemUnidadeId: unidadeMap["Fazenda Alpha"], // fornecedor
                destinoUnidadeId: unidadeMap["AgroBoi"], // loja
                criadoPorId: usuarioMap["Bruna Carvalho"], // gerente da loja
                dataPedido: new Date("2025-06-03T10:00:00.000Z"),
                dataEnvio: new Date("2025-06-06T07:30:00.000Z"),
                valorTotal: "18000.00",
                documentoReferencia: "PED-ALPHA-AGROBOI-20250603",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido de carne bovina para abastecimento semanal."
            },

            // Casa Útil Mercado → Fazenda Gamma
            {
                contratoId: contratoMap["Fazenda Gamma - Casa Útil Mercado"],
                origemUnidadeId: unidadeMap["Fazenda Gamma"], // fornecedor
                destinoUnidadeId: unidadeMap["Casa Útil Mercado"], // loja
                criadoPorId: usuarioMap["Maria Del Rey"], // gerente da loja
                dataPedido: new Date("2025-06-04T11:00:00.000Z"),
                dataEnvio: new Date("2025-06-07T09:00:00.000Z"),
                valorTotal: "22000.00",
                documentoReferencia: "PED-GAMMA-CASAUTIL-20250604",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido de grãos e cereais para reposição mensal."
            },

            // Sabor do Campo Laticínios → Fazenda Beta
            {
                contratoId: contratoMap["Fazenda Beta - Sabor do Campo Laticínios"],
                origemUnidadeId: unidadeMap["Fazenda Beta"], // fornecedor
                destinoUnidadeId: unidadeMap["Sabor do Campo Laticínios"], // loja
                criadoPorId: usuarioMap["Lorena Oshiro"], // gerente da loja
                dataPedido: new Date("2025-06-05T08:30:00.000Z"),
                dataEnvio: new Date("2025-06-08T07:00:00.000Z"),
                valorTotal: "15000.00",
                documentoReferencia: "PED-BETA-SABORCAMPO-20250605",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido de laticínios (leite, queijo, iogurte) para abastecimento quinzenal."
            },
            {
                contratoId: contratoMap["Loja Teste - Unidade Teste"],
                origemUnidadeId: unidadeMap["Unidade Teste"], // fornecedor
                destinoUnidadeId: unidadeMap["Loja Teste"],   // loja
                criadoPorId: usuarioMap["Renato Martins"],    // gerente da Loja Teste
                dataPedido: new Date("2025-06-06T09:00:00.000Z"),
                dataEnvio: new Date("2025-06-08T08:00:00.000Z"),
                valorTotal: "10000.00",
                documentoReferencia: "PED-TESTE-LOJA-20250606",
                tipoTransporte: TTRANS.RODOVIARIO,
                observacoes: "Pedido de laticínios e carne bovina para abastecimento da Loja Teste."
            }
        ];

        await prisma.pedido.createMany({ data: pedidosLojas, skipDuplicates: true });
        console.log("Pedidos das lojas criados com sucesso");

        // movimentacao estoque (entrada)

        // produtos que ja estao na loja mas nao estao pra venda
        console.log("Criando produtos...");
        // ------------------------ PRODUTOS PARA ESTOQUE DAS LOJAS ------------------------
        const produtosEstoqueLoja = [
        ];
        await prisma.produto.createMany({ data: produtosEstoqueLoja, skipDuplicates: true });

        // ===== Estoques =====
        console.log("Criando estoques...");
        const estoqueLoja = [
        ]
        await prisma.estoque.createMany({ data: estoqueLoja, skipDuplicates: true });
        console.log("Estoques criados:", estoqueData.length);

        // movimento estoque (saida)

        // ------------------------ PRODUTOS PARA VENDA DAS LOJAS ------------------------
        const produtosVendaLoja = [
            // VerdeFresco Hortaliças (hortaliças / vegetais) - origin: Fazenda Delta (hortas)
            {
                unidadeId: unidadeMap["VerdeFresco Hortaliças"],
                origemUnidadeId: unidadeMap["Fazenda Delta"],
                loteId: loteMap["Lote Horta 2025-02"],
                criadoPorId: usuarioMap["Roberto Barros"],
                nome: "Alface Crespa (maço)",
                sku: "ALFACE-CRES-001",
                categoria: "Hortaliça",
                descricao: "Alface crespa colhida para venda por unidade (maço)",
                preco: "2.50",
                dataFabricacao: new Date("2025-06-01"),
                dataValidade: new Date("2025-06-07"),
                unidadeMedida: UMED.UNIDADE,
                codigoBarras: "7891000000011",
                ncm: "07051100",
                pesoUnidade: "0.150",
                tags: ["folha", "orgânico"],
                impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
            },
            {
                unidadeId: unidadeMap["VerdeFresco Hortaliças"],
                origemUnidadeId: unidadeMap["Fazenda Delta"],
                loteId: loteMap["Lote Horta 2025-01"],
                criadoPorId: usuarioMap["Roberto Barros"],
                nome: "Tomate Carmem (kg)",
                sku: "TOMATE-CARM-001",
                categoria: "Hortaliça",
                descricao: "Tomate Carmem, vendido a granel por kg",
                preco: "6.80",
                dataFabricacao: new Date("2025-05-28"),
                dataValidade: new Date("2025-06-10"),
                unidadeMedida: UMED.KG,
                codigoBarras: "7891000000012",
                ncm: "07020010",
                pesoUnidade: "1.000",
                tags: ["tomate", "fresco"],
                impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
            },
            {
                unidadeId: unidadeMap["VerdeFresco Hortaliças"],
                origemUnidadeId: unidadeMap["Fazenda Delta"],
                loteId: loteMap["Lote Horta 2025-02"],
                criadoPorId: usuarioMap["Roberto Barros"],
                nome: "Mix Verduras (pack)",
                sku: "MIX-VERD-001",
                categoria: "Hortaliça",
                descricao: "Pack com mix de rúcula, agrião e alface (porção pronta para venda)",
                preco: "5.50",
                dataFabricacao: new Date("2025-06-01"),
                dataValidade: new Date("2025-06-06"),
                unidadeMedida: UMED.UNIDADE,
                codigoBarras: "7891000000013",
                ncm: "07059000",
                pesoUnidade: "0.350",
                tags: ["mix", "salada"],
                impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
            },
            // AgroBoi (gado / insumos para bovinos) - origin: Fazenda Alpha (gado)
            {
                unidadeId: unidadeMap["AgroBoi"],
                origemUnidadeId: unidadeMap["Fazenda Alpha"],
                loteId: loteMap["Lote Gado 2025-01"],
                criadoPorId: usuarioMap["Bruna Carvalho"],
                nome: "Carne Contrafilé (1kg)",
                sku: "CARNE-CF-001",
                categoria: "Carne",
                descricao: "Contrafilé bovino - embalagem por 1kg (procedência Fazenda Alpha)",
                preco: "39.00",
                dataFabricacao: new Date("2025-05-25"),
                dataValidade: new Date("2025-06-05"),
                unidadeMedida: UMED.KG,
                codigoBarras: "7891000000020",
                ncm: "02023000",
                pesoUnidade: "1.000",
                tags: ["bovino", "corte"],
                impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
            },
            {
                unidadeId: unidadeMap["AgroBoi"],
                origemUnidadeId: unidadeMap["Fazenda Alpha"],
                loteId: loteMap["Lote Gado 2025-01"],
                criadoPorId: usuarioMap["Bruna Carvalho"],
                nome: "Ração Bovino Engorda 50kg (loja)",
                sku: "RACAO-BOV-050-LOJA",
                categoria: "Ração",
                descricao: "Ração para engorda - saco 50kg (transferência interna da fazenda)",
                preco: "265.00",
                dataFabricacao: new Date("2025-01-20"),
                dataValidade: new Date("2026-01-20"),
                unidadeMedida: UMED.SACA,
                codigoBarras: "7891000000021",
                ncm: "23091000",
                pesoUnidade: "50.000",
                tags: ["racao", "bovino"],
                impostos: { icms: 12.0 }
            },
            {
                unidadeId: unidadeMap["AgroBoi"],
                origemUnidadeId: unidadeMap["Fazenda Alpha"],
                loteId: loteMap["Lote Gado 2025-02"],
                criadoPorId: usuarioMap["Bruna Carvalho"],
                nome: "Suplemento Mineral Bovino 5kg (loja)",
                sku: "SUP-MIN-BOV-005-LOJA",
                categoria: "Suplemento",
                descricao: "Bloco mineral 5kg para bovinos - vendido na loja AgroBoi",
                preco: "45.00",
                dataFabricacao: new Date("2025-02-01"),
                dataValidade: new Date("2027-02-01"),
                unidadeMedida: UMED.KG,
                codigoBarras: "7891000000022",
                ncm: "23099000",
                pesoUnidade: "5.000",
                tags: ["suplemento", "bovino"],
                impostos: { icms: 12.0 }
            },
            // Sabor do Campo Laticínios (laticínios) - origin: Fazenda Beta (leite)
            {
                unidadeId: unidadeMap["Sabor do Campo Laticínios"],
                origemUnidadeId: unidadeMap["Fazenda Beta"],
                loteId: loteMap["Lote Leite 2025-01"],
                criadoPorId: usuarioMap["Lorena Oshiro"],
                nome: "Leite Pasteurizado 1L",
                sku: "LEITE-PAST-001",
                categoria: "Laticínio",
                descricao: "Leite pasteurizado, 1 litro, procedência Fazenda Beta",
                preco: "4.50",
                dataFabricacao: new Date("2025-05-10"),
                dataValidade: new Date("2025-05-17"),
                unidadeMedida: UMED.LITRO,
                codigoBarras: "7891000000030",
                ncm: "04012010",
                pesoUnidade: "1.000",
                tags: ["leite", "pasteurizado"],
                impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
            },
            {
                unidadeId: unidadeMap["Sabor do Campo Laticínios"],
                origemUnidadeId: unidadeMap["Fazenda Beta"],
                loteId: loteMap["Lote Leite 2025-01"],
                criadoPorId: usuarioMap["Lorena Oshiro"],
                nome: "Queijo Minas Frescal 200g",
                sku: "QUEIJO-MINAS-200",
                categoria: "Laticínio",
                descricao: "Queijo Minas fresco - 200g (produção local)",
                preco: "16.00",
                dataFabricacao: new Date("2025-05-05"),
                dataValidade: new Date("2025-05-20"),
                unidadeMedida: UMED.UNIDADE,
                codigoBarras: "7891000000031",
                ncm: "04063010",
                pesoUnidade: "0.200",
                tags: ["queijo", "fresco"],
                impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
            },
            {
                unidadeId: unidadeMap["Sabor do Campo Laticínios"],
                origemUnidadeId: unidadeMap["Fazenda Beta"],
                loteId: loteMap["Lote Leite 2025-02"],
                criadoPorId: usuarioMap["Lorena Oshiro"],
                nome: "Iogurte Natural 500g",
                sku: "IOGURTE-NAT-500",
                categoria: "Laticínio",
                descricao: "Iogurte natural sem açúcar - pote 500g",
                preco: "7.50",
                dataFabricacao: new Date("2025-05-12"),
                dataValidade: new Date("2025-05-22"),
                unidadeMedida: UMED.UNIDADE,
                codigoBarras: "7891000000032",
                ncm: "04031000",
                pesoUnidade: "0.500",
                tags: ["iogurte", "natural"],
                impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
            },
            // Casa Útil Mercado (produtos diversos pequenos) - origem variada
            {
                unidadeId: unidadeMap["Casa Útil Mercado"],
                origemUnidadeId: unidadeMap["Fazenda Gamma"],
                loteId: loteMap["Lote Trigo 2025-01"],
                criadoPorId: usuarioMap["Maria Del Rey"],
                nome: "Farinha de Trigo Tipo 1 1kg",
                sku: "FARIN-TRIG-1KG",
                categoria: "Alimentos",
                descricao: "Farinha de trigo tipo 1 - pacote 1kg (produção local / moagem a partir do lote)",
                preco: "6.80",
                dataFabricacao: new Date("2025-04-15"),
                dataValidade: new Date("2026-04-15"),
                unidadeMedida: UMED.KG,
                codigoBarras: "7891000000040",
                ncm: "11010000",
                pesoUnidade: "1.000",
                tags: ["farinha", "trigo"],
                impostos: { icms: 12.0 }
            },
            {
                unidadeId: unidadeMap["Casa Útil Mercado"],
                origemUnidadeId: unidadeMap["Fazenda Teste"],
                loteId: loteMap["Lote Teste 01"],
                criadoPorId: usuarioMap["Maria Del Rey"],
                nome: "Sabão em Pó 1kg (marca local)",
                sku: "SABAO-PO-1KG",
                categoria: "Higiene",
                descricao: "Sabão em pó embalagem 1kg - marca local/teste",
                preco: "9.50",
                dataFabricacao: new Date("2025-03-01"),
                dataValidade: new Date("2027-03-01"),
                unidadeMedida: UMED.UNIDADE,
                codigoBarras: "7891000000041",
                ncm: "34021300",
                pesoUnidade: "1.000",
                tags: ["limpeza"],
                impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
            },
            {
                unidadeId: unidadeMap["Casa Útil Mercado"],
                origemUnidadeId: unidadeMap["Fazenda Alpha"],
                loteId: loteMap["Lote Milho 2025-01"],
                criadoPorId: usuarioMap["Maria Del Rey"],
                nome: "Milho Para Pipoca 1kg",
                sku: "MILHO-PIPE-1KG",
                categoria: "Alimentos",
                descricao: "Milho seco para consumo/uso doméstico - 1kg",
                preco: "7.20",
                dataFabricacao: new Date("2025-04-01"),
                dataValidade: new Date("2026-04-01"),
                unidadeMedida: UMED.KG,
                codigoBarras: "7891000000042",
                ncm: "10059011",
                pesoUnidade: "1.000",
                tags: ["milho", "seco"],
                impostos: { icms: 12.0 }
            },
        ];
        await prisma.produto.createMany({ data: produtosVendaLoja, skipDuplicates: true });

        let produtosDb = await prisma.produto.findMany();
        const produtoMap = Object.fromEntries(produtosDb.map(p => [p.sku, p.id]));
        console.log("Produtos criados:", produtosDb.length);

        // caixa 

        // venda

        // itens venda



        // dados financeiros de todas as unidades

        console.log("SEED finalizado com sucesso!");
    } catch (error) {
        console.error("Erro durante seed:", error);
        process.exitCode = 1;
    } finally {
        await prisma.$disconnect();
        console.log("Desconectado do banco.");
    }
}

main();



























































import bcrypt from "bcryptjs";
import 'dotenv/config'
import { configDotenv } from "dotenv";
configDotenv();
import prisma from "./client.js";
import * as pkg from "./generated/client.ts"; 

// Extrai enums (podem ficar undefined se seu schema não os exportar)
const { TipoPerfil, TipoUnidade, TipoLote, TipoRegistroSanitario, TipoPagamento, TipoSaida, AtividadesEnum, StatusContrato, FrequenciaEnum, UnidadesDeMedida, tipoTransporte, StatusUnidade, StatusFornecedor, StatusQualidade, TipoMovimento, TipoAtvd, TipoAnimais, StatusVenda, StatusAtvdAnimalia, TipoAnimalia, StatusPedido, StatusProducao, StatusPlantacao, } = pkg;

// fallback simples caso enums não sejam exportados
const TP = TipoPerfil ?? {
    GERENTE_MATRIZ: "GERENTE_MATRIZ",
    GERENTE_FAZENDA: "GERENTE_FAZENDA",
    GERENTE_LOJA: "GERENTE_LOJA",
    FUNCIONARIO_LOJA: "FUNCIONARIO_LOJA",
    FUNCIONARIO_FAZENDA: "FUNCIONARIO_FAZENDA"
};

const TU = TipoUnidade ?? { MATRIZ: "MATRIZ", FAZENDA: "FAZENDA", LOJA: "LOJA" };
const TL = TipoLote ?? { GADO: "GADO", SOJA: "SOJA", LEITE: "LEITE", OUTRO: "OUTRO", PLANTIO: "PLANTIO" };
const TRS = TipoRegistroSanitario ?? { VACINA: "VACINA", MEDICACAO: "MEDICACAO", RACAO: "RACAO", OUTRO: "OUTRO" };
const TPAG = TipoPagamento ?? { DINHEIRO: "DINHEIRO", CARTAO: "CARTAO", PIX: "PIX" };
const TSAIDA = TipoSaida ?? { ALUGUEL: "ALUGUEL", AGUA: "AGUA", ENERGIA: "ENERGIA", MANUTENCAO: "MANUTENCAO", SALARIOS: "SALARIOS", ESTOQUE: "ESTOQUE" };
const TAT = AtividadesEnum ?? { PLANTIO: "PLANTIO", ADUBACAO: "ADUBACAO", FERTILIZACAO: "FERTILIZACAO" };
const SCON = StatusContrato ?? { ATIVO: "ATIVO", INATIVO: "INATIVO" };
const FREQ = FrequenciaEnum ?? { SEMANALMENTE: "SEMANALMENTE", QUINZENAL: "QUINZENAL", MENSALMENTE: "MENSALMENTE", SEMESTRAL: "SEMESTRAL", TRIMESTRAL: "TRIMESTRAL" };
const UMED = UnidadesDeMedida ?? { KG: "KG", UNIDADE: "UNIDADE", LITRO: "LITRO", SACA: "SACA", G: "G", ML: 'ML', CABECA: 'CABECA' };
const SUNI = StatusUnidade ?? { ATIVA: "ATIVA", INATIVA: "INATIVA", MANUTENCAO: "MANUTENCAO" };
const SF = StatusFornecedor ?? { ATIVO: "ATIVO", INATIVO: "INATIVO" };
const SQ = StatusQualidade ?? { PROPRIO: "PROPRIO", ALERTA: "ALERTA", IMPROPRIO: "IMPROPRIO" };
const TM = TipoMovimento ?? { ENTRADA: "ENTRADA", SAIDA: "SAIDA" };
const TATV = TipoAtvd ?? { IRRIGACAO: "IRRIGACAO", ADUBACAO: "ADUBACAO", USO_AGROTOXICO: "USO_AGROTOXICO", PLANTIO: "PLANTIO", COLHEITA: "COLHEITA" };
const TAN = TipoAnimais ?? { ABATE: "ABATE", VENDA: "VENDA", REPRODUCAO: "REPRODUCAO" };
const TS = StatusVenda ?? { OK: "OK", A_RETIRAR: "A_RETIRAR", CANCELADO: "CANCELADO" };
const TTRANS = tipoTransporte ?? { RODOVIARIO: "RODOVIARIO", FERROVIARIO: "FERROVIARIO", AEREO: "AEREO", FLUVIAL: "FLUVIAL", INTERNO: "INTERNO", OUTRO: "OUTRO" }
const SATVDA = StatusAtvdAnimalia ?? { ATIVA: "ATIVA", INATIVA: "INATIVA", SUSPENSA: "SUSPENSA", CONCLUIDA: "CONCLUIDA" }
const SPLANT = StatusPlantacao ?? { EM_DESENVOLVIMENTO: "EM_DESENVOLVIMENTO", COLHIDO: "COLHIDO", EM_PREPARO: "EM_PREPARO", SEMEADO: "SEMEADO" }
const TANIMALIA = TipoAnimalia ?? { VACINACAO: "VACINACAO", VERMIFUGACAO: "VERMIFUGACAO", ANTIBIOTICO: "ANTIBIOTICO", TESTE_TUBERCULOSE: "TESTE_TUBERCULOSE", TESTE_BRUCELOSE: "TESTE_BRUCELOSE", SANIDADE_GERAL: "SANIDADE_GERAL", NUTRICAO: "NUTRICAO", SUPLEMENTACAO: "SUPLEMENTACAO", CONSUMO_RACAO: "CONSUMO_RACAO", AJUSTE_DIETA: "AJUSTE_DIETA", INSEMINACAO: "INSEMINACAO", MONITORAMENTO_CIO: "MONITORAMENTO_CIO", MONITORAMENTO_GESTACAO: "MONITORAMENTO_GESTACAO", PARTO: "PARTO", SECAGEM: "SECAGEM", TOURO_MANEJO: "TOURO_MANEJO", MANEJO_GERAL: "MANEJO_GERAL", MANEJO_PESAGEM: "MANEJO_PESAGEM", MANEJO_CARREIRA: "MANEJO_CARREIRA", MOVIMENTACAO_INTERNA: "MOVIMENTACAO_INTERNA", SEPARACAO_LOTE: "SEPARACAO_LOTE", ORDENHA_TESTE: "ORDENHA_TESTE", ORDENHA_DIARIA: "ORDENHA_DIARIA", COLETA_LEITE_AMOSTRA: "COLETA_LEITE_AMOSTRA", AVALIACAO_MASTITE: "AVALIACAO_MASTITE", RECEBIMENTO: "RECEBIMENTO", TRANSFERENCIA: "TRANSFERENCIA", VENDA_ANIMAL: "VENDA_ANIMAL", BAIXA_ANIMAL: "BAIXA_ANIMAL", BANHO: "BANHO", HIGIENIZACAO_AMBIENTE: "HIGIENIZACAO_AMBIENTE", TRATAMENTO_PE: "TRATAMENTO_PE", CURATIVO: "CURATIVO", OCORRENCIA: "OCORRENCIA", TRATAMENTO_URGENCIA: "TRATAMENTO_URGENCIA" };

const SPEDIDO = StatusPedido ?? { PENDENTE: "PENDENTE", ENVIADO: "ENVIADO", EM_TRANSITO: "EM_TRANSITO", ENTREGUE: "ENTREGUE", CANCELADO: "CANCELADO" }
const SPROD = StatusProducao ?? { PLANEJADA: "PLANEJADA", EM_ANDAMENTO: "EM_ANDAMENTO", FINALIZADA: "FINALIZADA", CANCELADA: "CANCELADA", EM_ANALISE: "EM_ANALISE" }

// npx prisma db seed
async function main() {
    try {
        console.log("Conectando ao banco...");
        await prisma.$connect();

        // // ===== Limpeza (ordem pensada para FK) =====
        // console.log("Limpando dados antigos...");
        // await prisma.itemVenda.deleteMany({});
        // await prisma.venda.deleteMany({});
        // await prisma.caixa.deleteMany({});
        // await prisma.estoque.deleteMany({});
        // await prisma.produtoFornecedor.deleteMany({});
        // await prisma.fornecedorExterno.deleteMany({});
        // await prisma.contratos.deleteMany({});
        // await prisma.registroSanitario.deleteMany({});
        // await prisma.rastreabilidadeLote.deleteMany({});
        // await prisma.producao.deleteMany({});
        // await prisma.atividadesLote.deleteMany({});
        // await prisma.produto.deleteMany({});
        // await prisma.lote.deleteMany({});
        // await prisma.saidas.deleteMany({});
        // await prisma.sessao.deleteMany({});
        // await prisma.resetSenha.deleteMany({});
        // await prisma.usuario.deleteMany({});
        // await prisma.unidade.deleteMany({});
        // await prisma.perfil.deleteMany({});
        // console.log("Limpeza concluída");

        // ===== Perfis =====
        console.log("Criando perfis...");
        const perfis = await prisma.perfil.createMany({
            data: [
                { funcao: TP.GERENTE_MATRIZ, descricao: "Gerente da matriz ou administração central" },
                { funcao: TP.GERENTE_FAZENDA, descricao: "Gerente responsável pela fazenda" },
                { funcao: TP.GERENTE_LOJA, descricao: "Gerente responsável pela loja ou filial" },
                { funcao: TP.FUNCIONARIO_LOJA, descricao: "Funcionário da loja" },
                { funcao: TP.FUNCIONARIO_FAZENDA, descricao: "Funcionário da fazenda" }
            ],
            skipDuplicates: true,
        });
        console.log("Perfis criados.");

        // Buscar perfis para map
        const perfisDb = await prisma.perfil.findMany();
        const perfilMap = Object.fromEntries(perfisDb.map(p => [String(p.funcao), p.id]));

        // ===== Unidades =====
        console.log("Criando unidades...");
        const unidadesData = [
            { nome: "RuralTech", endereco: "Av. Empresarial, 1000", tipo: TU.MATRIZ, cidade: "São Paulo", estado: "SP", cep: "01000-000", latitude: -23.55052, longitude: -46.633308, cnpj: "12345678000101", email: "ruraltech91@gmail.com", telefone: "1140000001", status: SUNI.ATIVA, },
            { nome: "VerdeFresco Hortaliças", endereco: "Av. Central, 1", tipo: TU.LOJA, cidade: "São Paulo", estado: "SP", cep: "01001-001", latitude: -23.5450, longitude: -46.6340, cnpj: "12345678000202", email: "lojacentral@empresa.com", telefone: "1140000002", horarioAbertura: new Date('1970-01-01T09:00:00Z'), horarioFechamento: new Date('1970-01-01T19:00:00Z'), status: SUNI.ATIVA, },
            { nome: "AgroBoi", endereco: "Rua Norte, 23", tipo: TU.LOJA, cidade: "Guarulhos", estado: "SP", cep: "07010-000", latitude: -23.4628, longitude: -46.5333, cnpj: "12345678000303", email: "lojanorte@empresa.com", telefone: "1140000003", horarioAbertura: new Date('1970-01-01T09:00:00Z'), horarioFechamento: new Date('1970-01-01T18:00:00Z'), status: SUNI.ATIVA, },
            { nome: "Casa Útil Mercado", endereco: "Av. Sul, 45", tipo: TU.LOJA, cidade: "Santo André", estado: "SP", cep: "09010-000", latitude: -23.6639, longitude: -46.5361, cnpj: "12345678000404", email: "lojasul@empresa.com", telefone: "1140000004", horarioAbertura: new Date('1970-01-01T10:00:00Z'), horarioFechamento: new Date('1970-01-01T20:00:00Z'), status: SUNI.ATIVA, },
            { nome: "Sabor do Campo Laticínios", endereco: "Praça Leste, 10", tipo: TU.LOJA, cidade: "São Bernardo", estado: "SP", cep: "09810-000", latitude: -23.6916, longitude: -46.5644, cnpj: "12345678000505", email: "lojaleste@empresa.com", telefone: "1140000005", horarioAbertura: new Date('1970-01-01T09:30:00Z'), horarioFechamento: new Date('1970-01-01T19:30:00Z'), status: SUNI.ATIVA, },
            { nome: "Fazenda Alpha", endereco: "Rod. BR-101, km 100", tipo: TU.FAZENDA, cidade: "Campinas", estado: "SP", cep: "13010-000", areaTotal: 1500.5, areaProdutiva: 1200.3, latitude: -22.9099, longitude: -47.0626, cnpj: "12345678100110", email: "fazendaalpha@empresa.com", telefone: "1930001001", status: SUNI.ATIVA, },
            { nome: "Fazenda Gamma", endereco: "Rod. BR-101, km 150", tipo: TU.FAZENDA, cidade: "Ribeirão Preto", estado: "SP", cep: "14010-000", areaTotal: 980.75, areaProdutiva: 760.0, latitude: -21.1775, longitude: -47.8103, cnpj: "12345678100220", email: "fazendabeta@empresa.com", telefone: "1630001002", status: SUNI.ATIVA, },
            { nome: "Fazenda Beta", endereco: "Estrada Rural, 77", tipo: TU.FAZENDA, cidade: "Piracicaba", estado: "SP", cep: "13400-000", areaTotal: 420.0, areaProdutiva: 365.25, latitude: -22.7127, longitude: -47.6476, cnpj: "12345678100330", email: "fazendagamma@empresa.com", telefone: "1930001003", status: SUNI.ATIVA, },
            { nome: "Fazenda Delta", endereco: "Estrada Rural, 88", tipo: TU.FAZENDA, cidade: "Limeira", estado: "SP", cep: "13480-000", areaTotal: 600.0, areaProdutiva: 480.5, latitude: -22.5641, longitude: -47.4019, cnpj: "12345678100440", email: "fazendadelta@empresa.com", telefone: "1930001004", status: SUNI.ATIVA, },
            { nome: "Fazenda Teste", endereco: "Rua Teste, 9", tipo: TU.FAZENDA, cidade: "Itu", estado: "SP", cep: "13300-000", areaTotal: 50.0, areaProdutiva: 40.0, latitude: -23.2646, longitude: -47.2995, cnpj: "12345678100550", email: "teste@empresa.com", telefone: "1140000099", status: SUNI.ATIVA, },
            { nome: "Loja Teste", endereco: "Av. Caetano Limeira, 2205", tipo: TU.LOJA, cidade: "Atibaia", estado: "SP", cep: "04610-000", latitude: -23.6639, longitude: -46.5361, cnpj: "12345678951244", email: "teste.loja@empresa.com", telefone: "1145003151", horarioAbertura: new Date('1970-01-01T10:00:00Z'), horarioFechamento: new Date('1970-01-01T20:00:00Z'), status: SUNI.ATIVA, },
        ];
        await prisma.unidade.createMany({ data: unidadesData, skipDuplicates: true });
        const unidades = await prisma.unidade.findMany();
        const unidadeMap = Object.fromEntries(unidades.map(u => [u.nome, u.id]));
        const lojas = unidades.filter(u => u.tipo === TU.LOJA);
        const fazendas = unidades.filter(u => u.tipo === TU.FAZENDA);
        console.log("Unidades criadas:", unidades.length);

        // ===== Usuários =====
        console.log("Criando usuários...");
        const senhaHash = await bcrypt.hash("123456", 10);

        const usuariosRuralTech = [
            { nome: "Julia Alves", email: "juliaalvesdeo447@gmail.com", senha: senhaHash, telefone: "11987651001", perfilId: perfilMap["GERENTE_MATRIZ"], unidadeId: unidadeMap["RuralTech"], status: true },
            { nome: "Lorena Oshiro", email: "lorenaoshiro2007@gmail.com", senha: senhaHash, telefone: "11987652001", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["Sabor do Campo Laticínios"], status: true },
            { nome: "Maria Del Rey", email: "mebdelrey@gmail.com", senha: senhaHash, telefone: "11987653001", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["Casa Útil Mercado"], status: true },
            { nome: "Richard Souza", email: "richardrrggts@gmail.com", senha: senhaHash, telefone: "11916694683", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Beta"], status: true },
        ]
        const usuariosFicticios = [
            // gerente da loja
            { nome: "Bruna Carvalho", email: "bru.carvalho@gmail.com", senha: senhaHash, telefone: "11988821353", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["Fazenda Beta"], status: true },
            { nome: "Roberto Barros", email: "robertbarros01@gmail.com", senha: senhaHash, telefone: "11916683574", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["VerdeFresco Hortaliças"], status: true },
            { nome: "Renato Martins", email: "renato.martins@gmail.com", senha: senhaHash, telefone: "11944556677", perfilId: perfilMap["GERENTE_LOJA"], unidadeId: unidadeMap["Loja Teste"], status: true },
            // funcionarios da loja
            { nome: "Mariana Coelho", email: "mari.coelho@gmail.com", senha: senhaHash, telefone: "1199637392", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["Loja Teste"], status: true },
            { nome: "Jonatas Silva", email: "jonatas91silva@gmail.com", senha: senhaHash, telefone: "11958251620", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["VerdeFresco Hortaliças"], status: true },
            { nome: "Alice Chagas", email: "chagas.alice@gmail.com", senha: senhaHash, telefone: "11953821185", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["AgroBoi"], status: true },
            { nome: "Marco Lucca Costa", email: "lucca.costa@gmail.com", senha: senhaHash, telefone: "11942221116", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["Casa Útil Mercado"], status: true },
            { nome: "Lúcia Mello", email: "luciamello11@gmail.com", senha: senhaHash, telefone: "1190086499", perfilId: perfilMap["FUNCIONARIO_LOJA"], unidadeId: unidadeMap["Sabor do Campo Laticínios"], status: true },
            // funcionarios da fazenda
            { nome: "Bruno Tavares", email: "bruno.tavares@gmail.com", senha: senhaHash, telefone: "11987654321", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Teste"], status: true },
            { nome: "Camila Duarte", email: "camila.duarte@gmail.com", senha: senhaHash, telefone: "11999887766", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Gamma"], status: true },
            { nome: "Eduardo Lima", email: "edu.lima@gmail.com", senha: senhaHash, telefone: "11988776655", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Delta"], status: true },
            { nome: "Fernanda Rocha", email: "fernanda.rocha@gmail.com", senha: senhaHash, telefone: "11977665544", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Alpha"], status: true },
            { nome: "Rafael Nunes", email: "rafael.nunes@gmail.com", senha: senhaHash, telefone: "11966554433", perfilId: perfilMap["FUNCIONARIO_FAZENDA"], unidadeId: unidadeMap["Fazenda Beta"], status: true },
            // gerentes de fazenda
            { nome: "Usuario Ficticio", email: "user.teste@gmail.com", senha: senhaHash, telefone: "11995251689", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Teste"], status: true },
            { nome: "Otávio Viana", email: "otavio.viana89@gmail.com", senha: senhaHash, telefone: "11999215361", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Gamma"], status: true },
            { nome: "Kátia Oliveira", email: "oliveirakatia09@gmail.com", senha: senhaHash, telefone: "11924245261", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Delta"], status: true },
            { nome: "Juliana Correia", email: "correiajuh@gmail.com", senha: senhaHash, telefone: "11958283626", perfilId: perfilMap["GERENTE_FAZENDA"], unidadeId: unidadeMap["Fazenda Alpha"], status: true },

        ];
        await prisma.usuario.createMany({ data: usuariosFicticios, skipDuplicates: true });
        await prisma.usuario.createMany({ data: usuariosRuralTech, skipDuplicates: true });
        const usuarios = await prisma.usuario.findMany();
        const usuarioMap = Object.fromEntries(usuarios.map(u => [u.nome, u.id]));
        console.log("Usuários criados.");

        // ===== ATUALIZAR UNIDADES COM gerenteId =====
        console.log("Ajustando gerenteId nas unidades...");

        await prisma.unidade.update({
            where: { id: unidadeMap["RuralTech"] },
            data: { gerenteId: usuarioMap["Julia Alves"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Teste"] },
            data: { gerenteId: usuarioMap["Usuario Ficticio"], matrizId: unidadeMap["RuralTech"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Sabor do Campo Laticínios"] },
            data: { gerenteId: usuarioMap["Lorena Oshiro"], matrizId: unidadeMap["RuralTech"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Gamma"] },
            data: { gerenteId: usuarioMap["Otávio Viana"], matrizId: unidadeMap["RuralTech"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Beta"] },
            data: { gerenteId: usuarioMap["Richard Souza"], matrizId: unidadeMap["RuralTech"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Delta"] },
            data: { gerenteId: usuarioMap["Kátia Oliveira"], matrizId: unidadeMap["RuralTech"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Casa Útil Mercado"] },
            data: { gerenteId: usuarioMap["Maria Del Rey"], matrizId: unidadeMap["RuralTech"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["AgroBoi"] },
            data: { gerenteId: usuarioMap["Bruna Carvalho"], matrizId: unidadeMap["RuralTech"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["VerdeFresco Hortaliças"] },
            data: { gerenteId: usuarioMap["Roberto Barros"], matrizId: unidadeMap["RuralTech"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Fazenda Alpha"] },
            data: { gerenteId: usuarioMap["Juliana Correia"], matrizId: unidadeMap["RuralTech"] },
        });
        await prisma.unidade.update({
            where: { id: unidadeMap["Loja Teste"] },
            data: { gerenteId: usuarioMap["GERENTE_LOJA"], matrizId: unidadeMap["RuralTech"] },
        });

        console.log("gerenteId configurado para todas as unidades.");

        // ===== Fornecedores =====
        console.log("Criando fornecedores...");
        const fornecedores = [
            // fazenda alpha
            {
                nomeEmpresa: "AgroFornecimentos Ltda",
                descricaoEmpresa: "Fornece rações e insumos",
                cnpjCpf: "12345678000190",
                email: "contato@agrofornece.com",
                telefone: "11999001122",
                endereco: "Rua do Agronegócio, 100",
                status: SF.ATIVO,
                // unidadeId: unidadeMap["Fazenda Alpha"],
            },
            {
                nomeEmpresa: "NutriBov Distribuidora",
                descricaoEmpresa: "Distribuição de ração bovina e suplementos",
                cnpjCpf: "10111213000144",
                email: "vendas@nutribov.com",
                telefone: "11988882211",
                endereco: "Rua NutriBov, 123",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "BovinoPrime Reprodutores",
                descricaoEmpresa: "Fornecimento de gado de corte e reprodutores certificados, com seleção genética.",
                cnpjCpf: "23242526000177",
                email: "comercial@bovinoprime.com.br",
                telefone: "11993004567",
                endereco: "Rod. Rural BR-050, km 200, Galpão 3",
                status: SF.ATIVO,
            },
            // fazenda gamma
            {
                nomeEmpresa: "Sementes Brasil",
                descricaoEmpresa: "Venda de sementes selecionadas",
                cnpjCpf: "11121314000155",
                email: "contato@sementesbrasil.com",
                telefone: "19997773344",
                endereco: "Av. Sementes, 200",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "AgroGrãos Comercial",
                descricaoEmpresa: "Comercialização de farelos e grãos",
                cnpjCpf: "12131415000166",
                email: "vendas@agrograos.com",
                telefone: "21996664455",
                endereco: "Rua Grãos, 50",
                status: SF.ATIVO,
            },
            // fazenda delta
            {
                nomeEmpresa: "FertSul Distribuição",
                descricaoEmpresa: "Distribuição de fertilizantes e corretivos",
                cnpjCpf: "13141516000177",
                email: "contato@fertsul.com",
                telefone: "51995555566",
                endereco: "Av. Fertilizantes, 300",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "BioInsumos Ltda",
                descricaoEmpresa: "Produtos biológicos e microbianos",
                cnpjCpf: "14151617000188",
                email: "contato@bioinsumos.com",
                telefone: "51994446677",
                endereco: "Rua Bio, 77",
                status: SF.ATIVO,
            },
            // fazenda beta
            {
                nomeEmpresa: "AgroLácteos Suprimentos",
                descricaoEmpresa: "Insumos para laticínios: coalho, culturas lácteas, consumíveis de processo e embalagens.",
                cnpjCpf: "15161718000199",
                email: "vendas@agrolacteos.com",
                telefone: "11993334455",
                endereco: "Av. Laticínios, 45",
                status: SF.ATIVO,
                // unidadeId: null // fornecedor externo
            },
            {
                nomeEmpresa: "Lácteos & Tecnologia Ltda",
                descricaoEmpresa: "Fornece starter cultures, enzimas, embalagens térmicas e equipamentos de pequeno porte para produção de queijo e iogurte.",
                cnpjCpf: "16171819000100",
                email: "contato@lacteostec.com.br",
                telefone: "11992223344",
                endereco: "Rua do Leite, 200",
                status: SF.ATIVO,
                // unidadeId: null
            },
            {
                nomeEmpresa: "AgroBov Genetics",
                descricaoEmpresa: "Fornecedor de animais reprodutores, touros de alto desempenho e serviços de inseminação artificial.",
                cnpjCpf: "17181920000111",
                email: "contato@agrobovgenetics.com.br",
                telefone: "11991112233",
                endereco: "Estrada da Cria, 500",
                status: SF.ATIVO,
                // unidadeId: null
            },
            {
                nomeEmpresa: "VetBov Serviços e Insumos",
                descricaoEmpresa: "Vacinas, medicamentos veterinários, assistência técnica e serviços de saúde animal.",
                cnpjCpf: "18192021000122",
                email: "vendas@vetbov.com.br",
                telefone: "11994445566",
                endereco: "Rua Veterinária, 77",
                status: SF.ATIVO,
                // unidadeId: null
            },
            // unidade teste
            {
                nomeEmpresa: "PastosVerde Nutrição Animal",
                descricaoEmpresa: "Produção e fornecimento de silagem, feno e suplementos minerais para bovinos.",
                cnpjCpf: "19192122000133",
                email: "contato@pastosverde.com.br",
                telefone: "11993332211",
                endereco: "Rodovia Rural, km 12",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "GenBov Melhoramento Genético",
                descricaoEmpresa: "Serviços de melhoramento genético, inseminação artificial e fornecimento de animais reprodutores.",
                cnpjCpf: "20212223000144",
                email: "vendas@genbov.com.br",
                telefone: "11992221100",
                endereco: "Estrada da Pecuária, 88",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "AgroVet Saúde Animal",
                descricaoEmpresa: "Medicamentos veterinários, vacinas e kits de diagnóstico para rebanhos bovinos.",
                cnpjCpf: "21222324000155",
                email: "contato@agrovetsaude.com.br",
                telefone: "11991114455",
                endereco: "Av. Veterinária, 300",
                status: SF.ATIVO,
            },
            {
                nomeEmpresa: "CampoForte Equipamentos",
                descricaoEmpresa: "Equipamentos para manejo de gado: balanças, troncos de contenção e bebedouros automáticos.",
                cnpjCpf: "22232425000166",
                email: "suporte@campoforte.com.br",
                telefone: "11990002233",
                endereco: "Rua Agroindústria, 150",
                status: SF.ATIVO,
            },
        ];
        await prisma.fornecedorExterno.createMany({ data: fornecedores, skipDuplicates: true });
        const fornecedoresDb = await prisma.fornecedorExterno.findMany();
        const fornecedorMap = Object.fromEntries(fornecedoresDb.map(f => [f.nomeEmpresa, f.id]));
        console.log("Fornecedores criados.");

        // ----------------------------- PARA CONTRATOS ----------------------------------
        // ===== Contratos =====
        const contratos = [
            // ----------------------------------------------------------
            // FAZENDAS
            // externos -> Faz. Alpha
            {
                unidadeId: unidadeMap["Fazenda Alpha"],
                fornecedorExternoId: fornecedorMap["AgroFornecimentos Ltda"],
                dataInicio: new Date("2024-01-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-01-05T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.SACA,
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Alpha"],
                fornecedorExternoId: fornecedorMap["NutriBov Distribuidora"],
                dataInicio: new Date("2024-02-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-02-03T07:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.SACA,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Alpha"],
                fornecedorExternoId: fornecedorMap["BovinoPrime Reprodutores"],
                dataInicio: new Date("2025-02-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-02-03T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.CABECA,
                diaPagamento: "20",
                formaPagamento: TPAG.PIX,
            },
            // externos -> Faz. Gamma
            {
                unidadeId: unidadeMap["Fazenda Gamma"],
                fornecedorExternoId: fornecedorMap["Sementes Brasil"],
                dataInicio: new Date("2024-03-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-03-05T09:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE, // fallback
                unidadeMedida: UMED.SACA,
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Gamma"],
                fornecedorExternoId: fornecedorMap["AgroGrãos Comercial"],
                dataInicio: new Date("2024-04-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-04-03T08:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.KG,
                diaPagamento: "05",
                formaPagamento: TPAG.PIX,
            },

            // externos -> Faz. Delta
            {
                unidadeId: unidadeMap["Fazenda Delta"],
                fornecedorExternoId: fornecedorMap["FertSul Distribuição"],
                dataInicio: new Date("2024-01-15T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-01-20T06:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.SACA,
                diaPagamento: "20",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Delta"],
                fornecedorExternoId: fornecedorMap["BioInsumos Ltda"],
                dataInicio: new Date("2024-02-10T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-02-12T07:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.LITRO,
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },

            // externos -> Fazenda Beta
            {
                unidadeId: unidadeMap["Fazenda Beta"],
                fornecedorExternoId: fornecedorMap["AgroLácteos Suprimentos"],
                dataInicio: new Date("2024-07-15T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-07-18T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Beta"],
                fornecedorExternoId: fornecedorMap["Lácteos & Tecnologia Ltda"],
                dataInicio: new Date("2024-07-20T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-07-22T07:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Beta"],
                fornecedorExternoId: fornecedorMap["AgroBov Genetics"],
                dataInicio: new Date("2024-09-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-09-03T06:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.TRIMESTRAL, // inseminação/troca genética não é mensal
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Fazenda Beta"],
                fornecedorExternoId: fornecedorMap["VetBov Serviços e Insumos"],
                dataInicio: new Date("2024-08-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-08-05T07:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },

            // Fazenda Teste <- PastosVerde Nutrição Animal (silagem, feno, suplementos minerais)
            {
                unidadeId: unidadeMap["Fazenda Teste"],
                fornecedorExternoId: fornecedorMap["PastosVerde Nutrição Animal"],
                dataInicio: new Date("2024-10-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-10-03T09:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },
            // Fazenda Teste <- GenBov Melhoramento Genético (inseminação e consultoria)
            {
                unidadeId: unidadeMap["Fazenda Teste"],
                fornecedorExternoId: fornecedorMap["GenBov Melhoramento Genético"],
                dataInicio: new Date("2024-11-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-11-04T08:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.TRIMESTRAL,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "20",
                formaPagamento: TPAG.PIX,
            },
            // Fazenda Teste <- AgroVet Saúde Animal (medicamentos e vacinas)
            {
                unidadeId: unidadeMap["Fazenda Teste"],
                fornecedorExternoId: fornecedorMap["AgroVet Saúde Animal"],
                dataInicio: new Date("2024-12-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2024-12-05T07:45:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "25",
                formaPagamento: TPAG.PIX,
            },
            // Fazenda Teste <- CampoForte Equipamentos (balanças, troncos, bebedouros)
            {
                unidadeId: unidadeMap["Fazenda Teste"],
                fornecedorExternoId: fornecedorMap["CampoForte Equipamentos"],
                dataInicio: new Date("2025-01-10T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-01-12T10:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.SEMESTRAL,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "05",
                formaPagamento: TPAG.PIX,
            },

            // -------------------------------------------------------
            // LOJAS
            // VerdeFresco Hortaliças (vende hortaliças) <- fornecedor: Fazenda Delta
            {
                unidadeId: unidadeMap["VerdeFresco Hortaliças"],
                fornecedorUnidadeId: unidadeMap["Fazenda Delta"],
                dataInicio: new Date("2025-05-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-05-02T06:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.SEMANALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },

            // AgroBoi (vende gado/insumos) <- fornecedor: Fazenda Alpha
            {
                unidadeId: unidadeMap["AgroBoi"],
                fornecedorUnidadeId: unidadeMap["Fazenda Alpha"],
                dataInicio: new Date("2025-05-10T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-05-12T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.SACA, // para insumos; animais podem ser UMED.UNIDADE/CAB em itens do contrato
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },

            // Casa Útil Mercado (produtos diversos) <- fornecedores variados (ex.: usa fazendas para apresentação do usuário Maria)
            {
                unidadeId: unidadeMap["Casa Útil Mercado"],
                fornecedorUnidadeId: unidadeMap["Fazenda Gamma"],
                dataInicio: new Date("2025-04-15T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-04-18T09:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.KG,
                diaPagamento: "15",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Casa Útil Mercado"],
                fornecedorUnidadeId: unidadeMap["Fazenda Alpha"],
                dataInicio: new Date("2025-04-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-04-03T08:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.KG,
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },
            {
                unidadeId: unidadeMap["Casa Útil Mercado"],
                fornecedorUnidadeId: unidadeMap["Fazenda Teste"],
                dataInicio: new Date("2025-03-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-03-02T09:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE,
                diaPagamento: "05",
                formaPagamento: TPAG.PIX,
            },

            // Sabor do Campo Laticínios (laticínios) <- fornecedor: Fazenda Beta
            {
                unidadeId: unidadeMap["Sabor do Campo Laticínios"],
                fornecedorUnidadeId: unidadeMap["Fazenda Beta"],
                dataInicio: new Date("2025-05-05T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-05-06T07:30:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.SEMANALMENTE,
                unidadeMedida: UMED.LITRO, // leite e derivados
                diaPagamento: "30",
                formaPagamento: TPAG.PIX,
            },

            // Loja Teste (laticínios e carne) <- fornecedor: Fazenda Teste
            {
                unidadeId: unidadeMap["Loja Teste"],
                fornecedorUnidadeId: unidadeMap["Fazenda Teste"],
                dataInicio: new Date("2025-06-01T00:00:00.000Z"),
                dataFim: null,
                dataEnvio: new Date("2025-06-03T10:00:00.000Z"),
                status: SCON.ATIVO,
                frequenciaEntregas: FREQ.MENSALMENTE,
                unidadeMedida: UMED.UNIDADE, // mistura (laticínios unid., carnes kg em itens do contrato)
                diaPagamento: "10",
                formaPagamento: TPAG.PIX,
            },
        ];
        await prisma.contrato.createMany({ data: contratos, skipDuplicates: true });
        console.log("Contratos criados (seed).");
        const contratosDb = await prisma.contrato.findMany({
            include: {
                unidade: true,
                fornecedorExterno: true,
                fornecedorInterno: true
            }
        });

        const contratoMap = {};

        for (const c of contratosDb) {
            const unidadeNome =
                c.unidade?.nome?.trim() || "SEM_UNIDADE";

            const fornecedorNome =
                c.fornecedorExterno?.nomeEmpresa?.trim() ||
                c.fornecedorInterno?.nome?.trim() ||
                "SEM_FORNECEDOR";

            const chave = `${unidadeNome} - ${fornecedorNome}`;
            contratoMap[chave] = c.id;
        }

        console.log("ContratoMap:", contratoMap);

        // ===== insumos que NAO vao p producao. São pra representar o que vai ser fornecido no contrato, APENAS =====
        console.log("Criando insumos para fazendas")
        const insumosContrato = [
            // Fazenda Alpha → AgroFornecimentos Ltda
            {
                contratoId: contratoMap["Fazenda Alpha - AgroFornecimentos Ltda"],
                // sku: "RACAO-BOV-050",
                nome: "Ração Bovino Engorda 50kg",
                categoria: ["Ração"],
                unidadeMedida: UMED.SACA,
                quantidade: "200", // 200 sacas/mês (10 toneladas)
                precoUnitario: "260.00",
                ativo: true,
                criadoEm: new Date("2025-01-20"),
            },
            // Fazenda Alpha → NutriBov Distribuidora
            {
                contratoId: contratoMap["Fazenda Alpha - NutriBov Distribuidora"],
                // sku: "SUP-MIN-BOV-005",
                nome: "Suplemento Mineral Bovino 5kg",
                categoria: ["Suplemento"],
                unidadeMedida: UMED.KG,
                quantidade: "500",
                precoUnitario: "42.00",
                ativo: true,
                criadoEm: new Date("2025-02-01"),
            },
            {
                contratoId: contratoMap["Fazenda Alpha - NutriBov Distribuidora"],
                // sku: "BLOCO-MIN-BOV-010",
                nome: "Bloco Mineral Bovino 10kg",
                categoria: ["Suplemento"],
                unidadeMedida: UMED.KG,
                quantidade: "300", // 300 blocos/mês
                precoUnitario: "95.00",
                ativo: true,
                criadoEm: new Date("2025-02-10"),
            },

            // Fazenda Gamma → Sementes Brasil
            {
                contratoId: contratoMap["Fazenda Gamma - Sementes Brasil"],
                // sku: "SEED-SOJA-020",
                nome: "Semente Soja Alta Germinacao 20kg",
                categoria: ["Sementes"],
                unidadeMedida: UMED.SACA,
                quantidade: "150", // 150 sacas/mês
                precoUnitario: "320.00",
                ativo: true,
                criadoEm: new Date("2025-01-10"),
            },
            // Fazenda Gamma → AgroGrãos Comercial
            {
                contratoId: contratoMap["Fazenda Gamma - AgroGrãos Comercial"],
                // sku: "FARELO-SOJA-025",
                nome: "Farelo de Soja 25kg",
                categoria: ["Insumos"],
                unidadeMedida: UMED.SACA,
                quantidade: "400", // 400 sacas/mês
                precoUnitario: "130.00",
                ativo: true,
                criadoEm: new Date("2025-08-10"),
            },
            // Fazenda Gamma → FertSul Distribuição
            {
                contratoId: contratoMap["Fazenda Gamma - Sementes Brasil"],
                // sku: "CALC-AG-040",
                nome: "Calcario Agricola 40kg",
                categoria: ["Corretivo"],
                unidadeMedida: UMED.KG,
                quantidade: "1000", // 40 toneladas/mês
                precoUnitario: "75.00",
                ativo: true,
                criadoEm: new Date("2025-02-15"),
            },

            // Fazenda Delta → FertSul Distribuição
            {
                contratoId: contratoMap["Fazenda Delta - FertSul Distribuição"],
                // sku: "NPK-20520-025",
                nome: "NPK 20-05-20 25kg",
                categoria: ["Fertilizantes"],
                unidadeMedida: UMED.KG,
                quantidade: "600", // 15 toneladas/mês
                precoUnitario: "95.00",
                ativo: true,
                criadoEm: new Date("2025-01-10"),
            },

            // Fazenda Delta → BioInsumos Ltda
            {
                contratoId: contratoMap["Fazenda Delta - BioInsumos Ltda"],
                // sku: "COMPO-MIC-010",
                nome: "Composto Microbiano 10kg",
                categoria: ["Adubo"],
                unidadeMedida: UMED.KG,
                quantidade: "200", // 2 toneladas/mês
                precoUnitario: "48.00",
                ativo: true,
                criadoEm: new Date("2025-03-01"),
            },
            {
                contratoId: contratoMap["Fazenda Delta - BioInsumos Ltda"],
                // sku: "INOC-SOJA-001",
                nome: "Inoculante Microbiano para Soja 1L",
                categoria: ["Inoculante"],
                unidadeMedida: UMED.LITRO,
                quantidade: "300", // 300 litros/mês
                precoUnitario: "38.00",
                ativo: true,
                criadoEm: new Date("2025-01-12"),
            },

            // Fazenda Beta → AgroLácteos Suprimentos
            {
                contratoId: contratoMap["Fazenda Beta - AgroLácteos Suprimentos"],
                // sku: "COALHO-LIQ-001",
                nome: "Coalho Líquido para Queijo 1L",
                categoria: ["Coagulação"],
                unidadeMedida: UMED.LITRO,
                quantidade: "50", // 50 litros/mês
                precoUnitario: "85.00",
                ativo: true,
                criadoEm: new Date("2025-03-01"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - AgroLácteos Suprimentos"],
                // sku: "CULT-LACT-010",
                nome: "Cultura Láctea Termófila 10g",
                categoria: ["Fermento"],
                unidadeMedida: UMED.G,
                quantidade: "200", // 200 doses/mês
                precoUnitario: "32.00",
                ativo: true,
                criadoEm: new Date("2025-03-02"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - AgroLácteos Suprimentos"],
                // sku: "EMBAL-LEITE-1L",
                nome: "Embalagem Plástica para Leite 1L (pacote c/ 100)",
                categoria: ["Embalagem"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "100", // 100 pacotes/mês
                precoUnitario: "55.00",
                ativo: true,
                criadoEm: new Date("2025-03-05"),
            },

            // Fazenda Beta → Lácteos & Tecnologia Ltda
            {
                contratoId: contratoMap["Fazenda Beta - Lácteos & Tecnologia Ltda"],
                // sku: "START-YOG-005",
                nome: "Starter Culture para Iogurte 5g",
                categoria: ["Fermento"],
                unidadeMedida: UMED.G,
                quantidade: "150", // 150 doses/mês
                precoUnitario: "27.00",
                ativo: true,
                criadoEm: new Date("2025-03-03"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - Lácteos & Tecnologia Ltda"],
                // sku: "ENZ-QUEIJO-020",
                nome: "Enzima Lipase para Queijo 20ml",
                categoria: ["Enzimas"],
                unidadeMedida: UMED.ML,
                quantidade: "80", // 80 frascos/mês
                precoUnitario: "19.00",
                ativo: true,
                criadoEm: new Date("2025-03-04"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - Lácteos & Tecnologia Ltda"],
                // sku: "POTE-YOG-200ML",
                nome: "Pote Plástico 200ml para Iogurte (caixa c/ 50)",
                categoria: ["Embalagem"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "60", // 60 caixas/mês
                precoUnitario: "34.00",
                ativo: true,
                criadoEm: new Date("2025-03-06"),
            },

            // Fazenda Beta → AgroBov Genetics
            {
                contratoId: contratoMap["Fazenda Beta - AgroBov Genetics"],
                // sku: "SEME-STR-001",
                nome: "Sêmen Bovino (dose - straw) - Alta Fertilidade",
                categoria: ["Genética", "Sêmen"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "100", // 100 doses/mês
                precoUnitario: "120.00",
                ativo: true,
                criadoEm: new Date("2025-04-03"),
            },
            {
                contratoId: contratoMap["Fazenda Beta - AgroBov Genetics"],
                // sku: "SERV-IAF-001",
                nome: "Serviço Inseminação Artificial (por cabeça)",
                categoria: ["Serviço"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "50", // 50 serviços/mês
                precoUnitario: "250.00",
                ativo: true,
                criadoEm: new Date("2025-04-04")
            },
            // Fazenda Beta → VetBov Serviços e Insumos
            {
                contratoId: contratoMap["Fazenda Beta - VetBov Serviços e Insumos"],
                // sku: "VAC-BRU-010",
                nome: "Vacina Brucelose (dose)",
                categoria: ["Vacina"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "300", // 300 doses/mês
                precoUnitario: "18.00",
                ativo: true,
                criadoEm: new Date("2025-04-05")
            },
            {
                contratoId: contratoMap["Fazenda Beta - VetBov Serviços e Insumos"],
                // sku: "ANTIPAR-50ML",
                nome: "Antiparasitário Oral 50ml (dose unitária)",
                categoria: ["Medicamento"],
                unidadeMedida: UMED.ML,
                quantidade: "200", // 200 doses/mês
                precoUnitario: "12.00",
                ativo: true,
                criadoEm: new Date("2025-04-06")
            },
            {
                contratoId: contratoMap["Fazenda Beta - VetBov Serviços e Insumos"],
                // sku: "KIT-SAN-001",
                nome: "Kit Sanidade (antiparasitário + vitaminas) - por animal",
                categoria: ["Kit", "Sanidade"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "150", // 150 kits/mês
                precoUnitario: "35.00",
                ativo: true,
                criadoEm: new Date("2025-04-07")
            },

            // Fazenda Teste → PastosVerde Nutrição Animal
            {
                contratoId: contratoMap["Fazenda Teste - PastosVerde Nutrição Animal"],
                // sku: "SILAGEM-MILHO-500KG",
                nome: "Silagem de Milho 500kg",
                categoria: ["Nutrição Animal"],
                unidadeMedida: UMED.KG,
                quantidade: "5000", // 5 toneladas/mês
                precoUnitario: "480.00",
                ativo: true,
                criadoEm: new Date("2025-03-10"),
            },
            {
                contratoId: contratoMap["Fazenda Teste - PastosVerde Nutrição Animal"],
                // sku: "FENO-CAPIM-BALE",
                nome: "Fardo de Feno de Capim 25kg",
                categoria: ["Nutrição Animal"],
                unidadeMedida: UMED.KG,
                quantidade: "2000", // 2 toneladas/mês
                precoUnitario: "95.00",
                ativo: true,
                criadoEm: new Date("2025-03-11"),
            },

            // Fazenda Teste → GenBov Melhoramento Genético
            {
                contratoId: contratoMap["Fazenda Teste - GenBov Melhoramento Genético"],
                // sku: "SEMEN-TOURO-ALTA",
                nome: "Sêmen de Touro Alta Performance (dose)",
                categoria: ["Genética"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "80", // 80 doses/mês
                precoUnitario: "250.00",
                ativo: true,
                criadoEm: new Date("2025-03-15"),
            },
            {
                contratoId: contratoMap["Fazenda Teste - GenBov Melhoramento Genético"],
                // sku: "SERV-INSEM-001",
                nome: "Serviço de Inseminação Artificial",
                categoria: ["Serviço"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "40", // 40 serviços/mês
                precoUnitario: "500.00",
                ativo: true,
                criadoEm: new Date("2025-03-16"),
            },

            // Fazenda Teste → AgroVet Saúde Animal
            {
                contratoId: contratoMap["Fazenda Teste - AgroVet Saúde Animal"],
                // sku: "VACINA-FOOT-AND-MOUTH",
                nome: "Vacina contra Febre Aftosa (dose)",
                categoria: ["Vacinas"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "400", // 400 doses/mês
                precoUnitario: "22.00",
                ativo: true,
                criadoEm: new Date("2025-03-20"),
            },
            {
                contratoId: contratoMap["Fazenda Teste - AgroVet Saúde Animal"],
                // sku: "ANTIBIOTICO-BOV-100ML",
                nome: "Antibiótico Bovino 100ml",
                categoria: ["Medicamentos"],
                unidadeMedida: UMED.ML,
                quantidade: "150", // 150 frascos/mês
                precoUnitario: "75.00",
                ativo: true,
                criadoEm: new Date("2025-03-21"),
            },

            // Fazenda Teste → CampoForte Equipamentos
            {
                contratoId: contratoMap["Fazenda Teste - CampoForte Equipamentos"],
                // sku: "BALANCA-BOV-500KG",
                nome: "Balança Eletrônica para Bovinos até 500kg",
                categoria: ["Equipamentos"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "5", // 5 unidades/mês
                precoUnitario: "3500.00",
                ativo: true,
                criadoEm: new Date("2025-03-25"),
            },
            {
                contratoId: contratoMap["Fazenda Teste - CampoForte Equipamentos"],
                // sku: "TRONCO-CONTENCAO-001",
                nome: "Tronco de Contenção Bovino",
                categoria: ["Equipamentos"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "3", // 3 unidades/mês
                precoUnitario: "7200.00",
                ativo: true,
                criadoEm: new Date("2025-03-26"),
            }
        ];
        await prisma.fornecedorItem.createMany({ data: insumosContrato, skipDuplicates: true });
        console.log("insumos criados com sucesso")

        console.log("Criando animais para contrato....")
        const animaisContrato = [
            // ----------------------- FAZENDA ALPHA
            {
                contratoId: contratoMap["Fazenda Alpha - BovinoPrime Reprodutores"],
                // sku: "BOI-NEL-ALPHA-001",
                nome: "Boi Nelore Reprodutor (macho adulto)",
                raca: "Nelore",
                categoria: ["Animal", "Reprodutor"],
                unidadeMedida: UMED.CABECA,
                quantidade: "8",
                precoUnitario: "13500.00",
                ativo: true,
                criadoEm: new Date("2025-02-04")
            },
            // ----------------------- FAZENDA BETA
            // AgroBov Genetics -> animais e genética
            {
                contratoId: contratoMap["Fazenda Beta - AgroBov Genetics"],
                // sku: "TOURO-NEL-001",
                nome: "Touro Nelore Reprodutor - 1 (macho adulto)",
                raca: "Nelore",
                categoria: ["Animal", "Reprodutor"],
                unidadeMedida: UMED.CABECA, // cabeça
                quantidade: "2", // 
                precoUnitario: "15000.00",
                ativo: true,
                criadoEm: new Date("2025-04-01")
            },
            {
                contratoId: contratoMap["Fazenda Beta - AgroBov Genetics"],
                // sku: "VACA-HOL-001",
                nome: "Vaca Holandesa - Reposição (fêmea adulta pronta para ordenha)",
                raca: "Holandesa",
                categoria: ["Animal", "Reprodução"],
                unidadeMedida: UMED.CABECA,
                quantidade: "5",
                precoUnitario: "6500.00",
                ativo: true,
                criadoEm: new Date("2025-04-02")
            },

            // -------------------- UNIDADE TESTE
            {
                contratoId: contratoMap["Fazenda Teste - GenBov Melhoramento Genético"],
                // sku: "TOURO-NELORE-002",
                nome: "Touro Nelore Reprodutor (macho adulto)",
                raca: "Nelore",
                categoria: ["Animal", "Reprodutor"],
                unidadeMedida: UMED.CABECA,
                quantidade: "1",
                precoUnitario: "16000.00",
                ativo: true,
                criadoEm: new Date("2025-04-10")
            },
            {
                contratoId: contratoMap["Fazenda Teste - GenBov Melhoramento Genético"],
                // sku: "VACA-HOLANDESA-002",
                nome: "Vaca Holandesa (fêmea adulta pronta para ordenha)",
                raca: "Holandesa",
                categoria: ["Animal", "Reprodução"],
                unidadeMedida: UMED.CABECA,
                quantidade: "3", // 10 vacas/mês
                precoUnitario: "7000.00",
                ativo: true,
                criadoEm: new Date("2025-04-11")
            }
        ];
        // inserir no banco (adicione ao seu fluxo de seed existente)
        await prisma.fornecedorItem.createMany({ data: animaisContrato, skipDuplicates: true });
        console.log("animais / itens pecuários do contrato criados com sucesso.");

        // produtos relacionados aos contratos
        const produtosContrato = [
            // Fazenda Alpha → AgroBoi (carne bovina)
            {
                contratoId: contratoMap["AgroBoi - Fazenda Alpha"],
                // sku: "CARNE-DIANT-001",
                nome: "Carne bovina dianteiro (kg)",
                categoria: ["Carne"],
                unidadeMedida: UMED.KG,
                quantidade: "1000", // 1000 kg/mês
                precoUnitario: "38.00",
                ativo: true,
                criadoEm: new Date("2025-01-10")
            },
            {
                contratoId: contratoMap["AgroBoi - Fazenda Alpha"],
                // sku: "CARNE-TRASEIRO-001",
                nome: "Carne bovina traseiro (kg)",
                categoria: ["Carne"],
                unidadeMedida: UMED.KG,
                quantidade: "800", // 800 kg/mês
                precoUnitario: "45.00",
                ativo: true,
                criadoEm: new Date("2025-01-11")
            },

            // Fazenda Gamma → Casa Útil Mercado (grãos)
            {
                contratoId: contratoMap["Casa Útil Mercado - Fazenda Gamma"],
                // sku: "SOJA-SACA-60KG",
                nome: "Soja em saca 60kg",
                categoria: ["Grãos"],
                unidadeMedida: UMED.SACA,
                quantidade: "500", // 500 sacas/mês
                precoUnitario: "180.00",
                ativo: true,
                criadoEm: new Date("2025-02-01")
            },
            {
                contratoId: contratoMap["Casa Útil Mercado - Fazenda Gamma"],
                // sku: "MILHO-SACA-60KG",
                nome: "Milho em saca 60kg",
                categoria: ["Grãos"],
                unidadeMedida: UMED.SACA,
                quantidade: "400", // 400 sacas/mês
                precoUnitario: "150.00",
                ativo: true,
                criadoEm: new Date("2025-02-02")
            },

            // Fazenda Beta → Sabor do Campo Laticínios (laticínios)
            {
                contratoId: contratoMap["Sabor do Campo Laticínios - Fazenda Beta"],
                // sku: "LEITE-PASTEUR-1L",
                nome: "Leite pasteurizado 1L",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.LITRO,
                quantidade: "2000", // 2000 litros/mês
                precoUnitario: "4.50",
                ativo: true,
                criadoEm: new Date("2025-03-01")
            },
            {
                contratoId: contratoMap["Sabor do Campo Laticínios - Fazenda Beta"],
                // sku: "QUEIJO-MINAS-500G",
                nome: "Queijo Minas Frescal 500g",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.KG,
                quantidade: "300", // 300 kg/mês
                precoUnitario: "25.00",
                ativo: true,
                criadoEm: new Date("2025-03-02")
            },
            {
                contratoId: contratoMap["Sabor do Campo Laticínios - Fazenda Beta"],
                // sku: "IOGURTE-NATURAL-170G",
                nome: "Iogurte natural 170g",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "1000", // 1000 unidades/mês
                precoUnitario: "3.20",
                ativo: true,
                criadoEm: new Date("2025-03-03")
            },

            // Fazenda Delta → VerdeFresco Hortaliças (hortaliças)
            {
                contratoId: contratoMap["VerdeFresco Hortaliças - Fazenda Delta"],
                // sku: "ALFACE-CRESPA-UN",
                nome: "Alface crespa unidade",
                categoria: ["Hortaliças"],
                unidadeMedida: UMED.UNIDADE,
                quantidade: "1500", // 1500 unidades/mês
                precoUnitario: "2.50",
                ativo: true,
                criadoEm: new Date("2025-04-01")
            },
            {
                contratoId: contratoMap["VerdeFresco Hortaliças - Fazenda Delta"],
                // sku: "TOMATE-CAIXA-20KG",
                nome: "Tomate caixa 20kg",
                categoria: ["Hortaliças"],
                unidadeMedida: UMED.KG,
                quantidade: "500", // 500 caixas (20kg cada) ≈ 10 toneladas/mês
                precoUnitario: "80.00",
                ativo: true,
                criadoEm: new Date("2025-04-02")
            },

            // Loja Teste (laticínios e carne) <- fornecedor: Fazenda Teste
            {
                contratoId: contratoMap["Loja Teste - Fazenda Teste"],
                // sku: "LEITE-TESTE-1L",
                nome: "Leite pasteurizado 1L (teste)",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.LITRO,
                quantidade: "500", // 500 litros/mês
                precoUnitario: "4.00",
                ativo: true,
                criadoEm: new Date("2025-06-01")
            },
            {
                contratoId: contratoMap["Loja Teste - Fazenda Teste"],
                // sku: "QUEIJO-TESTE-500G",
                nome: "Queijo fresco 500g (teste)",
                categoria: ["Laticínios"],
                unidadeMedida: UMED.KG,
                quantidade: "100", // 100 kg/mês
                precoUnitario: "22.00",
                ativo: true,
                criadoEm: new Date("2025-06-01")
            },
            {
                contratoId: contratoMap["Loja Teste - Fazenda Teste"],
                // sku: "CARNE-BOVINA-TESTE-1KG",
                nome: "Carne bovina corte dianteiro (teste)",
                categoria: ["Carne"],
                unidadeMedida: UMED.KG,
                quantidade: "200", // 200 kg/mês
                precoUnitario: "40.00",
                ativo: true,
                criadoEm: new Date("2025-06-01")
            },
            {
                contratoId: contratoMap["Loja Teste - Fazenda Teste"],
                // sku: "CARNE-BOVINA-TESTE-TRASEIRO",
                nome: "Carne bovina corte traseiro (teste)",
                categoria: ["Carne"],
                unidadeMedida: UMED.KG,
                quantidade: "150", // 150 kg/mês
                precoUnitario: "48.00",
                ativo: true,
                criadoEm: new Date("2025-06-01")
            }
        ];

        await prisma.fornecedorItem.createMany({ data: produtosContrato, skipDuplicates: true });
        console.log(`Produtos de contrato inseridos: ${produtosContrato.length}`);



















        const crypto = typeof globalThis.crypto !== 'undefined' ? globalThis.crypto : require('crypto');

        // ----------------- Helpers -----------------
        function toNumberSafe(v, fallback = 0) {
            if (v === null || v === undefined) return fallback;
            if (typeof v === 'object' && typeof v.toString === 'function') {
                const s = v.toString();
                const n = parseFloat(s.replace(',', '.'));
                return Number.isFinite(n) ? n : fallback;
            }
            if (typeof v === 'string') {
                const n = parseFloat(v.replace(',', '.'));
                return Number.isFinite(n) ? n : fallback;
            }
            const n = Number(v);
            return Number.isFinite(n) ? n : fallback;
        }

        // SKU único
        let __skuAnimalCounter = 0;
        async function gerarSkuAnimalUnico(prisma, { raca = 'RACA', tipo = 'ANM', pedidoId = '' } = {}) {
            const r = String(raca).replace(/\s+/g, '').slice(0, 4).toUpperCase();
            const t = String(tipo).replace(/\s+/g, '').slice(0, 4).toUpperCase();
            const p = String(pedidoId || '').slice(-6) || '000000';

            for (let tentativa = 0; tentativa < 10; tentativa++) {
                const base = Date.now().toString(36).toUpperCase();
                const cnt = (__skuAnimalCounter++).toString(36).toUpperCase();
                const rnd = Math.floor(Math.random() * 99999).toString().padStart(5, '0');
                const sku = `${r}-${t}-${p}-${base}-${cnt}-${rnd}`;
                const ja = await prisma.animal.findUnique({ where: { sku } }).catch(() => null);
                if (!ja) return sku;
            }

            // fallback - usa crypto UUID
            try {
                return `${r}-${t}-${p}-${crypto.randomUUID()}`;
            } catch (e) {
                return `${r}-${t}-${p}-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;
            }
        }

        // ----------------- 1) Pedidos e PedidoItem -----------------
        async function criarPedidosASeremProcessados(prisma, limite = 999) {
            const contratos = await prisma.contrato.findMany({ where: { status: (SCON && SCON.ATIVO) ? SCON.ATIVO : 'ATIVO' }, include: { itens: true, unidade: true }, take: limite });
            const pedidosCriados = [];

            for (const contrato of contratos) {
                if (!contrato.itens || contrato.itens.length === 0) continue;

                const origemFornecedorExternoId = contrato.fornecedorExternoId ?? null;
                const origemUnidadeId = contrato.fornecedorUnidadeId ?? null;

                let criadoPor = null;
                if (contrato.unidade?.id) {
                    const u = await prisma.usuario.findFirst({ where: { unidadeId: contrato.unidade.id } });
                    criadoPor = u?.id ?? null;
                }
                if (!criadoPor) {
                    const anyU = await prisma.usuario.findFirst();
                    criadoPor = anyU?.id ?? null;
                }

                const dataEnvio = contrato.dataEnvio ?? new Date();
                const documentoReferencia = `SEED-PED-${contrato.id}-${String(Date.now()).slice(-5)}`;

                const pedido = await prisma.pedido.create({
                    data: {
                        contratoId: contrato.id,
                        origemFornecedorExternoId,
                        origemUnidadeId,
                        destinoUnidadeId: contrato.unidadeId,
                        criadoPorId: criadoPor,
                        dataPedido: new Date(),
                        dataEnvio: dataEnvio,
                        status: (SPEDIDO && SPEDIDO.PENDENTE) ? SPEDIDO.PENDENTE : 'PENDENTE',
                        documentoReferencia,
                        observacoes: `Pedido seed snapshot do contrato ${contrato.id}`
                    }
                });

                // gerar pedido_items snapshot
                const items = contrato.itens.map(fi => {
                    const qtd = toNumberSafe(fi.quantidade, 0);
                    const preco = toNumberSafe(fi.precoUnitario, 0);
                    const custoTotal = Number((qtd * preco).toFixed(2));
                    return {
                        pedidoId: pedido.id,
                        fornecedorItemId: fi.id,
                        quantidade: String(qtd.toFixed(3)),
                        unidadeMedida: fi.unidadeMedida ?? ((UMED && UMED.UNIDADE) ? UMED.UNIDADE : 'UNIDADE'),
                        precoUnitario: preco ? String(preco.toFixed(2)) : null,
                        custoTotal: custoTotal ? String(custoTotal.toFixed(2)) : null,
                        observacoes: `Snapshot fornecedor_item ${fi.id} (contrato ${contrato.id})`
                    };
                });

                if (items.length) await prisma.pedidoItem.createMany({ data: items, skipDuplicates: true });

                const total = items.reduce((s, it) => s + toNumberSafe(it.custoTotal, 0), 0);
                await prisma.pedido.update({ where: { id: pedido.id }, data: { valorTotal: String(total.toFixed(2)) } });

                pedidosCriados.push({ id: pedido.id, documentoReferencia });
                console.log(`Pedido criado id=${pedido.id} contrato=${contrato.id} valorTotal=${total.toFixed(2)}`);
            }

            return pedidosCriados;
        }

        // ----------------- 2) Entrega e registro de entradas -----------------
        async function entregarPedidosERegistrarEntradas(prisma, pedidosCriados = []) {
            if (!pedidosCriados || pedidosCriados.length === 0) return;
            const docs = pedidosCriados.map(p => p.documentoReferencia);
            const pedidosDb = await prisma.pedido.findMany({ where: { documentoReferencia: { in: docs } }, include: { itens: true } });

            for (const ped of pedidosDb) {
                const dataRecebimento = ped.dataEnvio ?? new Date();
                await prisma.pedido.update({ where: { id: ped.id }, data: { status: (SPEDIDO && SPEDIDO.ENTREGUE) ? SPEDIDO.ENTREGUE : 'ENTREGUE', dataRecebimento } });
            }
            console.log(`Marcados ${pedidosDb.length} pedidos como ENTREGUE.`);

            if (typeof registrarEntradaEstoque === 'function' && typeof gerarInsumoByFornecedorItemId === 'function') {
                const pedidosParaRegistrar = await prisma.pedido.findMany({ where: { id: { in: pedidosDb.map(p => p.id) } }, select: { id: true, destinoUnidadeId: true, dataRecebimento: true, itens: { select: { fornecedorItemId: true, quantidade: true } } } });
                const mapInsumo = await gerarInsumoByFornecedorItemId(prisma);
                await registrarEntradaEstoque(prisma, pedidosParaRegistrar, mapInsumo);
                console.log('registrarEntradaEstoque chamado com sucesso.');
                return;
            }

            // fallback manual
            for (const ped of pedidosDb) {
                for (const it of ped.itens) {
                    if (!it.fornecedorItemId) continue;
                    const fi = await prisma.fornecedorItem.findUnique({ where: { id: it.fornecedorItemId } });
                    let insumo = null;
                    if (fi?.nome) insumo = await prisma.insumo.findFirst({ where: { nome: fi.nome } });
                    if (!insumo) continue;

                    const quantidade = Math.round(toNumberSafe(it.quantidade, 0));
                    if (quantidade <= 0) continue;

                    let estoque = await prisma.estoque.findFirst({ where: { unidadeId: ped.destinoUnidadeId, insumoId: insumo.id } });
                    if (!estoque) estoque = await prisma.estoque.create({ data: { unidadeId: ped.destinoUnidadeId, insumoId: insumo.id, quantidade: 0, estoqueMinimo: 0 } });

                    await prisma.estoque.update({ where: { id: estoque.id }, data: { quantidade: { increment: quantidade } } }).catch(() => null);
                    await prisma.estoqueMovimento.create({ data: { estoqueId: estoque.id, tipoMovimento: (TM && TM.ENTRADA) ? TM.ENTRADA : 'ENTRADA', quantidade, pedidoId: ped.id, origemUnidadeId: null, destinoUnidadeId: ped.destinoUnidadeId, data: ped.dataRecebimento ?? new Date() } }).catch(() => null);
                }
            }
            console.log('Entradas de estoque registradas via fallback manual.');
        }

        // ----------------- 3) Garantir lotes por fazenda -----------------
        async function garantirLotesPorFazenda(prisma) {
            const mapa = { 'Fazenda Alpha': ['GADO'], 'Fazenda Gamma': ['PLANTIO'], 'Fazenda Beta': ['GADO', 'PLANTIO'], 'Fazenda Delta': ['PLANTIO'], 'Unidade Teste': ['GADO', 'PLANTIO'] };
            const nomes = Object.keys(mapa);
            const fazendas = await prisma.unidade.findMany({ where: { nome: { in: nomes } } });

            for (const faz of fazendas) {
                const tipos = mapa[faz.nome] || ['OUTRO'];
                const resp = await prisma.usuario.findFirst({ where: { unidadeId: faz.id } });
                const respId = resp?.id ?? (await prisma.usuario.findFirst())?.id ?? null;

                for (const tipo of tipos) {
                    const nomeLote = `Lote Seed - ${faz.nome} - ${tipo}`;
                    if (typeof findOrCreateLote === 'function') {
                        await findOrCreateLote(prisma, nomeLote, faz.id, respId, TL?.[tipo] ?? tipo, tipo === 'PLANTIO' ? ((UMED && UMED.SACA) ? UMED.SACA : 'SACA') : ((UMED && UMED.UNIDADE) ? UMED.UNIDADE : 'UNIDADE'));
                    } else {
                        const existente = await prisma.lote.findFirst({ where: { nome: nomeLote, unidadeId: faz.id } });
                        if (!existente) {
                            await prisma.lote.create({ data: { nome: nomeLote, unidadeId: faz.id, responsavelId: respId, tipo: TL?.[tipo] ?? tipo, preco: 0, unidadeMedida: tipo === 'PLANTIO' ? ((UMED && UMED.SACA) ? UMED.SACA : 'SACA') : ((UMED && UMED.UNIDADE) ? UMED.UNIDADE : 'UNIDADE'), dataCriacao: new Date() } });
                        }
                    }
                }
                console.log(`Lotes garantidos para ${faz.nome}: ${tipos.join(', ')}`);
            }
        }

        // ----------------- 4) Gerar Animais e Plantios (corrigido) -----------------
        // Apenas cria animais quando o fornecedorItem.categoria indica animal e o fornecedorItem.contratoId
        // está entre os contratos que realmente trazem animais. Usa a quantidade do fornecedorItem como
        // número de cabeças (não interpreta kg como cabeça). Cria um lote por fazenda se necessário.
        async function gerarAnimaisEPlantios(prisma) {
            // contratos que, segundo você, devem gerar animais (IDs explícitos fornecidos)
            const contratosComAnimais = new Set([3, 10, 13]);

            // buscar todos os pedidos ENTREGUE (apenas para relacionar unidade destino e dataRecebimento)
            const pedidosEntregue = await prisma.pedido.findMany({ where: { status: (SPEDIDO && SPEDIDO.ENTREGUE) ? SPEDIDO.ENTREGUE : 'ENTREGUE' }, include: { itens: true } });

            // buscar fornecedorItems que sejam animalescos e que pertençam aos contratos mapeados
            const fornecedorItems = await prisma.fornecedorItem.findMany({
                where: {
                    AND: [
                        {
                            OR: [
                                { categoria: { array_contains: ["Animal"] } },
                                { categoria: { array_contains: ["animal"] } },
                                { categoria: { array_contains: ["Gado"] } },
                                { categoria: { array_contains: ["gado"] } },
                                { categoria: { array_contains: ["Bovino"] } },
                                { categoria: { array_contains: ["bovino"] } },
                            ]
                        },
                        {
                            contratoId: {
                                in: Array.from(contratosComAnimais)
                            }
                        }
                    ]
                }
            }).catch(() => []);


            if (!fornecedorItems || fornecedorItems.length === 0) {
                console.log('Nenhum fornecedorItem animal encontrado para contratos de animais.');
                return;
            }

            // map fornecedorItem por id
            const fiById = Object.fromEntries(fornecedorItems.map(fi => [fi.id, fi]));

            for (const ped of pedidosEntregue) {
                // para cada item do pedido, se for animal e do contrato certo, gerar animais
                for (const it of ped.itens) {
                    const fi = fiById[it.fornecedorItemId];
                    if (!fi) continue;

                    // quantidade em fornecedorItem define cabeças; se fornecedorItem.quantidade for string '8' etc.
                    const qtdAnimais = Math.max(0, Math.round(toNumberSafe(fi.quantidade, 0)));
                    if (qtdAnimais <= 0) continue;

                    // garantir que existe unidade destino
                    const unidadeDestinoId = ped.destinoUnidadeId ?? fi.unidadeId ?? null;
                    if (!unidadeDestinoId) continue;

                    // buscar/garantir lote de gado nessa unidade
                    const responsavel = await prisma.usuario.findFirst({
                        where: { unidadeId: unidadeDestinoId }
                    });

                    const respId =
                        responsavel?.id ??
                        (await prisma.usuario.findFirst())?.id ??
                        null;

                    let lote = await prisma.lote.findFirst({
                        where: {
                            unidadeId: unidadeDestinoId,
                            nome: { contains: 'GADO' }
                        }
                    });
                    if (!lote) {
                        lote = await prisma.lote.create({
                            data: {
                                nome: `Lote Seed - Unidade ${unidadeDestinoId} - GADO`,
                                unidadeMedida: ((UMED && UMED.UNIDADE) ? UMED.UNIDADE : 'UNIDADE'),
                                unidadeId: unidadeDestinoId,
                                responsavelId: respId,                         // <-- obrigatório
                                tipo: TL?.GADO ?? 'GADO',                      // <-- obrigatório (enum TipoLote)
                                preco: 0,
                                dataCriacao: new Date()
                            }
                        }).catch(() => null);
                    }

                    for (let i = 0; i < qtdAnimais; i++) {
                        const sku = await gerarSkuAnimalUnico(prisma, { raca: fi.raca ?? 'RACA', tipo: 'ANM', pedidoId: ped.id });
                        await prisma.animal.create({
                            data: {
                                animal: fi.nome ?? 'Animal',
                                raca: fi.raca ?? 'Indefinida',
                                sku,
                                dataEntrada: ped.dataRecebimento ?? new Date(),
                                fornecedorId: fi.fornecedorId ?? null,
                                quantidade: 1,
                                tipo: (TAN && TAN.ABATE) ? TAN.ABATE : 'ABATE',
                                custo: fi.precoUnitario ? Number(fi.precoUnitario) : null,
                                unidadeId: unidadeDestinoId,
                                loteId: lote?.id ?? null
                            }
                        }).catch(err => { if (err && err.code === 'P2002') { /* sku duplicado — ignora */ } else { console.error('Erro criando animal:', err); } });
                    }

                    console.log(`Criados ${qtdAnimais} animais para pedido ${ped.id} / fornecedorItem ${fi.id}`);
                }
            }

            // Plantios: criar plantios baseado em fornecedorItems com categoria sementes/plantio
            const plantioFis = await prisma.fornecedorItem.findMany({
                where: {
                    OR: [
                        { categoria: { array_contains: ["Sementes"] } },
                        { categoria: { array_contains: ["sementes"] } },
                        { categoria: { array_contains: ["Plantio"] } },
                        { categoria: { array_contains: ["plantio"] } },
                        { categoria: { array_contains: ["Soja"] } },
                        { categoria: { array_contains: ["soja"] } },
                        { categoria: { array_contains: ["Milho"] } },
                        { categoria: { array_contains: ["milho"] } },
                    ]
                }
            }).catch(() => []);
            for (const fi of plantioFis) {
                // localizar pedidos ENTREGUE que contenham este fi
                const pedidosComFi = pedidosEntregue.filter(p => p.itens.some(it => it.fornecedorItemId === fi.id));
                for (const ped of pedidosComFi) {
                    const unidadeDestinoId = ped.destinoUnidadeId ?? fi.unidadeId ?? null;
                    if (!unidadeDestinoId) continue;
                    const qtd = Math.max(1, toNumberSafe(fi.quantidade, 1));
                    await prisma.plantio.create({
                        data: {
                            categoria: fi.nome ?? 'Plantio',
                            areaHectares: 1.0,
                            dataPlantio: ped.dataRecebimento ?? new Date(),
                            dataColheitaEstimativa: new Date(Date.now() + 120 * 24 * 3600 * 1000),
                            fornecedorId: fi.fornecedorId ?? null,
                            custo: fi.precoUnitario ? Number(fi.precoUnitario) * qtd : null,
                            unidadeId: unidadeDestinoId
                        }
                    }).catch(() => null);
                    console.log(`Plantio criado para pedido ${ped.id} / fornecedorItem ${fi.id}`);
                }
            }

            console.log('Animais e plantios criados a partir dos pedidos ENTREGUE (corrigido).');
        }

        // ----------------- 5) Atividades e movimentos (corrigido) -----------------
        async function criarAtividadesEMovimentos(prisma) {
            // Atividades para animais
            const animais = await prisma.animal.findMany({ take: 500 });
            const insumosMedic = await prisma.insumo.findMany({ where: { categoria: 'MEDICAMENTO' } }).catch(() => []);

            for (const an of animais) {
                const responsavel = await prisma.usuario.findFirst({ where: { unidadeId: an.unidadeId } });
                const respId = responsavel?.id ?? (await prisma.usuario.findFirst())?.id ?? null;
                if (!respId) {
                    console.error(`Nenhum usuário encontrado para unidade ${an.unidadeId} — pulando atividade animal para ${an.id}`);
                    continue;
                }

                await prisma.atvdAnimalia.create({
                    data: {
                        animalId: an.id,
                        responsavelId: {
                            connect: { id: respId }
                        },
                        responsavelId: respId,
                        descricao: `Atividade seed para ${an.sku || an.animal}`,
                        dataInicio: new Date(), // campo correto no schema
                        // observacoes NÃO existe nesse model — usamos descricao para texto
                        tipo: (typeof TipoAnimalia !== 'undefined' && TipoAnimalia.VACINACAO) ? TipoAnimalia.VACINACAO : 'VACINACAO',
                        status: (typeof StatusAtvdAnimalia !== 'undefined' ? StatusAtvdAnimalia.CONCLUIDA : (typeof SATVDA !== 'undefined' ? SATVDA.CONCLUIDA : 'CONCLUIDA')),
                        anexos: null // campo opcional no model — manter null se não houver
                    }
                }).catch((e) => {
                    console.error('Erro criando atvdAnimalia (seed):', e);
                    return null;
                });

                // consome 1 unidade de medicamento (se houver insumo disponível)
                const insumo = insumosMedic.length ? insumosMedic[Math.floor(Math.random() * insumosMedic.length)] : null;
                if (insumo) {
                    let estoque = await prisma.estoque.findFirst({ where: { unidadeId: an.unidadeId, insumoId: insumo.id } });
                    if (!estoque) {
                        estoque = await prisma.estoque.create({
                            data: { unidadeId: an.unidadeId, insumoId: insumo.id, quantidade: 0, estoqueMinimo: 0 }
                        }).catch(() => null);
                    }
                    if (estoque) {
                        const uso = 1;
                        await prisma.estoque.update({ where: { id: estoque.id }, data: { quantidade: { decrement: uso } } }).catch(() => null);
                        await prisma.estoqueMovimento.create({
                            data: {
                                estoqueId: estoque.id,
                                tipoMovimento: (TM && TM.SAIDA) ? TM.SAIDA : 'SAIDA',
                                quantidade: uso,
                                origemUnidadeId: an.unidadeId,
                                data: new Date()
                            }
                        }).catch(() => null);
                    }
                }
            }

            // Atividades agrícolas
            const plantios = await prisma.plantio.findMany({ take: 500 });
            const insumosSemente = await prisma.insumo.findMany({ where: { categoria: 'SEMENTE' } }).catch(() => []);

            for (const p of plantios) {
                // responsável (usuário ligado à unidade do plantio)
                const responsavel = await prisma.usuario.findFirst({ where: { unidadeId: p.unidadeId } });
                const respId = responsavel?.id ?? (await prisma.usuario.findFirst())?.id ?? null;
                if (!respId) {
                    console.error(`Unidade ${p.unidadeId} sem usuário disponível — pulando atividade agrícola para plantio ${p.id}`);
                    continue;
                }

                // Encontrar (ou criar) um Lote que represente o plantio para ligar a atividade (AtvdAgricola.loteId é obrigatório)
                let loteAssoc = await prisma.lote.findFirst({ where: { unidadeId: p.unidadeId, nome: { contains: 'PLANTIO' } } });
                if (!loteAssoc) {
                    // cria um lote simples para associar as atividades agrícolas
                    loteAssoc = await prisma.lote.create({
                        data: {
                            nome: `Lote Seed - Unidade ${p.unidadeId} - PLANTIO`,
                            unidadeId: p.unidadeId,
                            responsavelId: respId,
                            tipo: (TL && TL.PLANTIO) ? TL.PLANTIO : 'PLANTIO',
                            preco: 0,
                            unidadeMedida: (UMED && UMED.SACA) ? UMED.SACA : 'SACA',
                            dataCriacao: new Date()
                        }
                    }).catch((e) => {
                        console.error('Erro criando lote de PLANTIO (seed):', e);
                        return null;
                    });
                }
                if (!loteAssoc) {
                    console.error(`Não foi possível garantir lote para plantio ${p.id}. Pulando.`);
                    continue;
                }

                // criar a atividade agrícola (note: usamos loteId em vez de plantioId)
                await prisma.atvdAgricola.create({
                    data: {
                        // insumoId não é obrigatório no seu modelo (é Int), se quiser amarrar insumo, ajuste aqui.
                        lote: {
                            connect: { id: loteAssoc.id }
                        },  // campo obrigatório no schema AtvdAgricola
                        responsavelId: {
                            connect: { id: respId }
                        },
                        responsavelId: respId,
                        descricao: `Atividade seed: plantio/serviço para ${p.categoria}`,
                        dataInicio: p.dataPlantio || new Date(), // campo correto
                        tipo: (typeof TipoAtvd !== 'undefined' && TipoAtvd.PLANTIO) ? TipoAtvd.PLANTIO : 'PLANTIO',
                        status: (typeof StatusPlantacao !== 'undefined' ? StatusPlantacao.COLHIDO : (typeof SPLANT !== 'undefined' ? SPLANT.COLHIDO : 'COLHIDO'))
                        // dataFim fica null por padrão (opcional)
                    }
                }).catch((e) => {
                    console.error('Erro criando atvdAgricola (seed):', e);
                    return null;
                });

                // Consumo de insumo para plantio (se houver)
                const insumo = insumosSemente.length ? insumosSemente[Math.floor(Math.random() * insumosSemente.length)] : null;
                if (insumo) {
                    let estoque = await prisma.estoque.findFirst({ where: { unidadeId: p.unidadeId, insumoId: insumo.id } });
                    if (!estoque) {
                        estoque = await prisma.estoque.create({
                            data: { unidadeId: p.unidadeId, insumoId: insumo.id, quantidade: 0, estoqueMinimo: 0 }
                        }).catch(() => null);
                    }
                    if (estoque) {
                        const consumo = Math.max(1, Math.round((p.areaHectares ?? 1) * 10));
                        await prisma.estoque.update({ where: { id: estoque.id }, data: { quantidade: { decrement: consumo } } }).catch(() => null);
                        await prisma.estoqueMovimento.create({
                            data: {
                                estoqueId: estoque.id,
                                tipoMovimento: (TM && TM.SAIDA) ? TM.SAIDA : 'SAIDA',
                                quantidade: consumo,
                                origemUnidadeId: p.unidadeId,
                                data: new Date()
                            }
                        }).catch(() => null);
                    }
                }
            }

            console.log('Atividades e movimentos de SAIDA criados (seed).');
        }

        // ----------------- 6) Produção e Beneficiamento (corrigido) -----------------
        async function criarProducoesEBeneficiamentos(prisma) {
            const lotes = await prisma.lote.findMany({ take: 50 });

            for (const lote of lotes) {

                let producoes = [];
                let beneficiamentos = [];

                // ===========================
                //      FAZENDA ALPHA
                // ===========================
                if (/alpha/i.test(lote.nome)) {
                    producoes = [
                        { tipoProduto: "Carne bovina dianteiro", unidade: "KG" },
                        { tipoProduto: "Carne bovina traseiro", unidade: "KG" }
                    ];
                }

                // ===========================
                //      FAZENDA GAMMA
                // ===========================
                else if (/gamma/i.test(lote.nome)) {
                    producoes = [
                        { tipoProduto: "Soja em saca 60kg", unidade: "SACA" },
                        { tipoProduto: "Milho em saca 60kg", unidade: "SACA" }
                    ];
                }

                // ===========================
                //      FAZENDA BETA
                // ===========================
                else if (/beta/i.test(lote.nome)) {
                    producoes = [
                        { tipoProduto: "Leite cru", unidade: "LITRO" }
                    ];

                    beneficiamentos = [
                        { tipoProduto: "Leite pasteurizado 1L", unidade: "LITRO" },
                        { tipoProduto: "Queijo Minas Frescal 500g", unidade: "KG" },
                        { tipoProduto: "Iogurte natural 170g", unidade: "UNIDADE" }
                    ];
                }

                // ===========================
                //      FAZENDA DELTA
                // ===========================
                else if (/delta/i.test(lote.nome)) {
                    producoes = [
                        { tipoProduto: "Alface crespa unidade", unidade: "UNIDADE" },
                        { tipoProduto: "Tomate caixa 20kg", unidade: "KG" }
                    ];
                }

                // ===========================
                //      UNIDADE TESTE
                // ===========================
                else if (/teste/i.test(lote.nome)) {
                    producoes = [
                        { tipoProduto: "Leite cru", unidade: "LITRO" },
                        { tipoProduto: "Carne bovina", unidade: "KG" },
                    ];

                    beneficiamentos = [
                        { tipoProduto: "Leite pasteurizado 1L", unidade: "LITRO" },
                        { tipoProduto: "Queijo fresco 500g", unidade: "KG" },
                        { tipoProduto: "Carne bovina cortes dianteiro/traseiro", unidade: "KG" }
                    ];
                }

                // SE NÃO PERTENCE A NENHUMA FAZENDA — IGNORA
                if (producoes.length === 0) continue;

                for (const item of producoes) {

                    const prod = await prisma.producao.create({
                        data: {
                            loteId: lote.id,
                            quantidadeBruta: 5,
                            quantidadeLiquida: 5,
                            unidadeMedida: item.unidade,
                            dataRegistro: new Date(),
                            status: SPROD.FINALIZADA,
                            unidadeId: lote.unidadeId,
                            documentoReferencia: `SEED-PROD-${lote.id}-${Date.now().toString().slice(-4)}`,
                            tipoProduto: item.tipoProduto
                        }
                    });

                    // pegar gerente da unidade do lote atual
                    // depois de criar `prod` e já ter 'beneficiamentos' definido para o lote:
                    if (beneficiamentos && beneficiamentos.length > 0) {
                        // pegar gerente da unidade do lote atual
                        const unidade = await prisma.unidade.findUnique({
                            where: { id: lote.unidadeId },
                            select: { gerenteId: true }
                        });

                        if (!unidade || !unidade.gerenteId) {
                            console.error(`Unidade ${lote.unidadeId} sem gerente definido! Não será criado beneficiamento para esse lote.`);
                        } else {
                            for (const ben of beneficiamentos) {
                                await prisma.beneficiamento.create({
                                    data: {
                                        loteId: lote.id,
                                        producaoId: prod.id,
                                        observacoes: `Beneficiamento automático do produto ${prod.tipoProduto}`,
                                        tipoProduto: ben.tipoProduto,
                                        quantidadeBruta: prod.quantidadeBruta ?? 5,
                                        quantidadeLiquida: prod.quantidadeLiquida ?? prod.quantidadeBruta ?? 5,
                                        unidadeMedida: ben.unidade,
                                        dataInicio: new Date(),
                                        responsavelId: unidade.gerenteId
                                    }
                                }).catch(e => {
                                    console.error('Erro criando beneficiamento:', e);
                                });
                            }
                        }
                    }

                    // Estoque + movimento
                    let estoque = await prisma.estoque.findFirst({
                        where: { unidadeId: lote.unidadeId, loteId: lote.id }
                    });

                    if (!estoque)
                        estoque = await prisma.estoque.create({
                            data: { unidadeId: lote.unidadeId, loteId: lote.id, quantidade: 0, estoqueMinimo: 0 }
                        });

                    await prisma.estoque.update({
                        where: { id: estoque.id },
                        data: {
                            quantidade: { increment: 5 }
                        }
                    });

                    await prisma.estoqueMovimento.create({
                        data: {
                            estoqueId: estoque.id,
                            tipoMovimento: "ENTRADA",
                            quantidade: 5,
                            producaoId: prod.id,
                            data: new Date()
                        }
                    });
                }
            }

            console.log("Produções e beneficiamentos criados corretamente!");
        }

        // ----------------- Runner -----------------
        async function executarFluxoRestanteCompat(prisma) {
            console.log('=== INÍCIO: fluxo seed (pedidos -> itens -> lotes -> animais/plantios -> atividades -> producao -> movimentos) ===');
            const pedidosCriados = await criarPedidosASeremProcessados(prisma);
            await entregarPedidosERegistrarEntradas(prisma, pedidosCriados);
            await garantirLotesPorFazenda(prisma);
            await gerarAnimaisEPlantios(prisma);
            await criarAtividadesEMovimentos(prisma);
            await criarProducoesEBeneficiamentos(prisma);
            console.log('=== FIM: fluxo seed restante concluído ===');
        }

        await executarFluxoRestanteCompat(prisma);
























        // // const pedidosEntreguesAnimais = await prisma.pedido.findMany({
        // //     where: { status: "ENTREGUE" },
        // //     select: {
        // //         id: true,
        // //         destinoUnidadeId: true,
        // //         origemFornecedorExternoId: true,
        // //         dataRecebimento: true,
        // //         itens: { select: { fornecedorItemId: true, quantidade: true } }
        // //     }
        // // });

        // // for (const ped of pedidosEntreguesAnimais) {
        // //     if (!ped.destinoUnidadeId) continue;

        // //     for (const it of ped.itens) {
        // //         if (!it.fornecedorItemId) continue;
        // //         const fi = await prisma.fornecedorItem.findUnique({
        // //             where: { id: it.fornecedorItemId },
        // //             select: { sku: true, nome: true, raca: true, categoria: true }
        // //         });

        // //         // Só cria animal quando o item é de fato “Animal”
        // //         const categorias = Array.isArray(fi?.categoria) ? fi.categoria : [];
        // //         const isAnimal = categorias.map(c => String(c).toLowerCase()).includes("animal");
        // //         if (!isAnimal) continue;

        // //         const quantidadeInt = Math.round(Number(it.quantidade || 0));
        // //         const racaFinal = fi?.raca || "Indefinido"; // preferível ser sempre preenchida no item
        // //         const tipoFinal = tipoAnimalFromCategoria(fi?.categoria);
        // //         const nomeLower = (fi?.nome || "").toLowerCase();
        // //         const animalBase =
        // //             nomeLower.includes("touro") ? "Touro" :
        // //                 nomeLower.includes("vaca") ? "Vaca" :
        // //                     "Bovino";

        // //         await prisma.animal.create({
        // //             data: {
        // //                 animal: animalBase,
        // //                 raca: racaFinal,
        // //                 unidadeId: ped.destinoUnidadeId,
        // //                 quantidade: quantidadeInt,
        // //                 tipo: tipoFinal,
        // //                 custo: null,
        // //                 dataEntrada: ped.dataRecebimento || new Date(),
        // //                 fornecedorId: ped.origemFornecedorExternoId || null
        // //             }
        // //         });
        // //     }
        // // }

        // // // ===== LOTES =====
        // // let loteBeta = await prisma.lote.findFirst({
        // //     where: { nome: "Lote Inicial Beta", unidadeId: unidadeMap["Fazenda Beta"] }
        // // });
        // // if (!loteBeta) {
        // //     loteBeta = await prisma.lote.create({
        // //         data: {
        // //             nome: "Lote Inicial Beta",
        // //             unidadeId: unidadeMap["Fazenda Beta"],
        // //             responsavelId: usuarioMap["Richard Souza"],
        // //             tipo: TL.GADO,
        // //             preco: 0,
        // //             unidadeMedida: UMED.CABECA,
        // //             criadoEm: new Date()
        // //         }
        // //     });
        // //     console.log(`Lote criado: Lote Inicial Beta (id ${loteBeta.id})`);
        // // } else {
        // //     console.log(`Lote existente: Lote Inicial Beta (id ${loteBeta.id})`);
        // // }

        // // let loteTeste = await prisma.lote.findFirst({
        // //     where: { nome: "Lote Inicial Teste", unidadeId: unidadeMap["Fazenda Teste"] }
        // // });
        // // if (!loteTeste) {
        // //     loteTeste = await prisma.lote.create({
        // //         data: {
        // //             nome: "Lote Inicial Teste",
        // //             unidadeId: unidadeMap["Fazenda Teste"],
        // //             responsavelId: usuarioMap["Usuario Ficticio"],
        // //             tipo: TL.GADO,
        // //             preco: 0,
        // //             unidadeMedida: UMED.CABECA,
        // //             criadoEm: new Date()
        // //         }
        // //     });
        // //     console.log(`Lote criado: Lote Inicial Teste (id ${loteTeste.id})`);
        // // } else {
        // //     console.log(`Lote existente: Lote Inicial Teste (id ${loteTeste.id})`);
        // // }

        // // // Fazenda Alpha
        // // let loteAlpha = await prisma.lote.findFirst({
        // //     where: { nome: "Lote Inicial Alpha", unidadeId: unidadeMap["Fazenda Alpha"] }
        // // });
        // // if (!loteAlpha) {
        // //     loteAlpha = await prisma.lote.create({
        // //         data: {
        // //             nome: "Lote Inicial Alpha",
        // //             unidadeId: unidadeMap["Fazenda Alpha"],
        // //             responsavelId: usuarioMap["Juliana Correia"],
        // //             tipo: TL.GADO, // pode ser TL.CARNE se você tiver enum específico
        // //             preco: 0,
        // //             unidadeMedida: UMED.KG,
        // //             criadoEm: new Date()
        // //         }
        // //     });
        // //     console.log(`Lote criado: Lote Inicial Alpha (id ${loteAlpha.id})`);
        // // } else {
        // //     console.log(`Lote existente: Lote Inicial Alpha (id ${loteAlpha.id})`);
        // // }

        // // // Fazenda Gamma
        // // let loteGamma = await prisma.lote.findFirst({
        // //     where: { nome: "Lote Inicial Gamma", unidadeId: unidadeMap["Fazenda Gamma"] }
        // // });
        // // if (!loteGamma) {
        // //     loteGamma = await prisma.lote.create({
        // //         data: {
        // //             nome: "Lote Inicial Gamma",
        // //             unidadeId: unidadeMap["Fazenda Gamma"],
        // //             responsavelId: usuarioMap["Otávio Viana"],
        // //             tipo: TL.PLANTIO,
        // //             preco: 0,
        // //             unidadeMedida: UMED.SACA,
        // //             criadoEm: new Date()
        // //         }
        // //     });
        // //     console.log(`Lote criado: Lote Inicial Gamma (id ${loteGamma.id})`);
        // // } else {
        // //     console.log(`Lote existente: Lote Inicial Gamma (id ${loteGamma.id})`);
        // // }

        // // // Fazenda Delta
        // // let loteDelta = await prisma.lote.findFirst({
        // //     where: { nome: "Lote Inicial Delta", unidadeId: unidadeMap["Fazenda Delta"] }
        // // });
        // // if (!loteDelta) {
        // //     loteDelta = await prisma.lote.create({
        // //         data: {
        // //             nome: "Lote Inicial Delta",
        // //             unidadeId: unidadeMap["Fazenda Delta"],
        // //             responsavelId: usuarioMap["Kátia Oliveira"],
        // //             tipo: TL.PLANTIO,
        // //             preco: 0,
        // //             unidadeMedida: UMED.UNIDADE,
        // //             criadoEm: new Date()
        // //         }
        // //     });
        // //     console.log(`Lote criado: Lote Inicial Delta (id ${loteDelta.id})`);
        // // } else {
        // //     console.log(`Lote existente: Lote Inicial Delta (id ${loteDelta.id})`);
        // // }

        // // movimentacao estoque dos insumos pra uso (saida)
        // // ===== SAÍDA DE ESTOQUE =====
        // async function registrarSaida(insumoId, unidadeId, quantidade, responsavelId, loteId) {
        //     const estoque = await prisma.estoque.findFirst({ where: { unidadeId, insumoId } });
        //     if (!estoque) {
        //         console.log(`Estoque não encontrado para insumo ${insumoId}`);
        //         return;
        //     }
        //     // Atualiza quantidade
        //     await prisma.estoque.update({
        //         where: { id: estoque.id },
        //         data: { quantidade: { decrement: quantidade } }
        //     });
        //     // Registra movimento
        //     await prisma.estoqueMovimento.create({
        //         data: {
        //             estoqueId: estoque.id,
        //             tipoMovimento: TM.SAIDA,
        //             quantidade,
        //             origemUnidadeId: unidadeId,
        //             data: new Date(),
        //             loteId
        //         }
        //     });
        //     console.log(`Saída registrada: insumo ${insumoId}, qtd ${quantidade}`);
        // }

        // // ------------------ atvd_animalia ------------------
        // const animals = await prisma.animal.findMany({
        //     select: { id: true, sku: true, nome: true }
        // });
        // const animalMap = {};
        // for (const a of animals) {
        //     if (a.sku) animalMap[a.sku] = a.id;
        // }
        // // 4) Montar atividades realistas (cada item precisa de animalId)
        // const atvdAnimaliaBeta = [
        //     // RECEBIMENTO: animais vivos chegam
        //     {
        //         animalId: animalMap["TOURO-NEL-001"],
        //         insumoId: null,
        //         descricao: "Recebimento do touro Nelore reprodutor. Checagem sanitária, identificação e quarentena inicial (observação 48h).",
        //         tipo: TANIMALIA.RECEBIMENTO,
        //         loteId: loteBeta.id,
        //         dataInicio: new Date("2025-04-10T09:00:00.000Z"),
        //         responsavelId: usuarioMap["Richard Souza"],
        //         // anexos: { nf: "NF-ANIM-20250410", fotos: [] },
        //         status: "ATIVA"
        //     },
        //     {
        //         animalId: animalMap["VACA-HOL-001"],
        //         insumoId: null,
        //         descricao: "Recebimento de vaca de reposição. Registro, identificação (brinco) e exame clínico inicial.",
        //         tipo: TANIMALIA.RECEBIMENTO,
        //         loteId: loteBeta.id,
        //         dataInicio: new Date("2025-04-10T09:30:00.000Z"),
        //         responsavelId: usuarioMap["Richard Souza"],
        //         // anexos: { nf: "NF-ANIM-20250410-2" },
        //         status: "ATIVA"
        //     },

        //     // VACINAÇÃO: aplicar vacina brucelose
        //     {
        //         animalId: animalMap["VACA-HOL-001"],
        //         insumoId: insumoMap["VAC-BRU-010"] || null,
        //         descricao: "Aplicação de vacina contra brucelose (registro do lote da vacina e nota fiscal).",
        //         tipo: TANIMALIA.VACINACAO,
        //         loteId: loteBeta.id,
        //         dataInicio: new Date("2025-04-12T08:30:00.000Z"),
        //         responsavelId: usuarioMap["Richard Souza"],
        //         // anexos: { loteVacina: "L20B-2025", nf: "NF-VAC-20250412" },
        //         status: "ATIVA"
        //     },

        //     // VERMIFUGAÇÃO / Sanidade geral (kit)
        //     {
        //         animalId: animalMap["VACA-HOL-001"],
        //         insumoId: insumoMap["KIT-SAN-001"] || insumoMap["ANTIPAR-50ML"] || null,
        //         descricao: "Aplicação de kit de sanidade (antiparasitário + vitaminas) na vaca de reposição.",
        //         tipo: TANIMALIA.SANIDADE_GERAL,
        //         loteId: loteBeta.id,
        //         dataInicio: new Date("2025-04-12T09:15:00.000Z"),
        //         responsavelId: usuarioMap["Richard Souza"],
        //         // anexos: { nf: "NF-SAN-20250412" },
        //         status: "ATIVA"
        //     },

        //     // INSEMINAÇÃO (serviço) — vinculado à vaca
        //     {
        //         animalId: animalMap["VACA-HOL-001"],
        //         insumoId: null,
        //         descricao: "Inseminação artificial (serviço) — dose aplicada, técnico e protocolo.",
        //         tipo: TANIMALIA.INSEMINACAO,
        //         loteId: loteBeta.id,
        //         dataInicio: new Date("2025-04-20T07:00:00.000Z"),
        //         responsavelId: usuarioMap["Richard Souza"],
        //         // anexos: { tecnico: "Dr. João Vet", protocolo: "IA-20250420" },
        //         status: "ATIVA"
        //     },

        //     // ORDENHA_TESTE: controle de qualidade / amostragem de leite (vinculado à vaca)
        //     {
        //         animalId: animalMap["VACA-HOL-001"],
        //         insumoId: insumoMap["EMBAL-LEITE-1L"] || null,
        //         descricao: "Ordenha de prova: medição de volume, amostra para análise e checagem de mastite.",
        //         tipo: TANIMALIA.ORDENHA_TESTE,
        //         loteId: loteBeta.id,
        //         dataInicio: new Date("2025-04-15T05:30:00.000Z"),
        //         responsavelId: usuarioMap["Richard Souza"],
        //         // anexos: { volumeMl: 3200, resultadoPh: "6.7" },
        //         status: "ATIVA"
        //     },

        //     // COLETA_LEITE_AMOSTRA / uso de cultura para iogurte (atividade ligada ao leite)
        //     {
        //         animalId: animalMap["VACA-HOL-001"],
        //         insumoId: insumoMap["CULT-LACT-010"] || null,
        //         descricao: "Coleta de leite amostra para lote piloto de iogurte e adição de cultura starter (registro do lote da cultura).",
        //         tipo: TANIMALIA.COLETA_LEITE_AMOSTRA,
        //         loteId: loteBeta.id,
        //         dataInicio: new Date("2025-04-16T10:00:00.000Z"),
        //         responsavelId: usuarioMap["Richard Souza"],
        //         // anexos: { loteCultura: "CL-20250301" },
        //         status: "ATIVA"
        //     },

        //     // OCORRÊNCIA: transporte/saúde do touro
        //     {
        //         animalId: animalMap["TOURO-NEL-001"],
        //         insumoId: null,
        //         descricao: "Ocorrência: reação leve ao transporte — observação e repouso 48h, sem necessidade de intervenção farmacológica.",
        //         tipo: TANIMALIA.OCORRENCIA,
        //         loteId: loteBeta.id,
        //         dataInicio: new Date("2025-04-11T14:00:00.000Z"),
        //         responsavelId: usuarioMap["Richard Souza"],
        //         // anexos: null,
        //         status: "ATIVA"
        //     },

        // ];
        // // Registrar saída antes de inserir atividade
        // for (const atvd of atvdAnimaliaBeta) {
        //     if (atvd.insumoId) {
        //         await registrarSaida(atvd.insumoId, unidadeMap["Fazenda Beta"], 1, atvd.responsavelId, loteBeta.id);
        //     }
        // }
        // await prisma.atvdAnimalia.createMany({ data: atvdAnimaliaBeta, skipDuplicates: true });
        // console.log(`Atividades Beta inseridas: ${atvdAnimaliaBeta.length}`);


        // // ===== ATIVIDADES ANIMALIA (Fazenda Teste) =====
        // const atividadesTeste = [
        //     // Recebimento dos animais
        //     {
        //         animalId: animalMapTeste["TOURO NELORE"],
        //         insumoId: null,
        //         descricao: "Recebimento do touro Nelore reprodutor. Checagem sanitária e quarentena inicial.",
        //         tipo: TANIMALIA.RECEBIMENTO,
        //         loteId: loteTeste.id,
        //         dataInicio: new Date("2025-04-10T09:00:00.000Z"),
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         // anexos: { nf: "NF-TESTE-ANIM-001" },
        //         status: "ATIVA"
        //     },
        //     {
        //         animalId: animalMapTeste["VACA HOLANDESA"],
        //         insumoId: null,
        //         descricao: "Recebimento da vaca Holandesa pronta para ordenha.",
        //         tipo: TANIMALIA.RECEBIMENTO,
        //         loteId: loteTeste.id,
        //         dataInicio: new Date("2025-04-11T09:00:00.000Z"),
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         // anexos: { nf: "NF-TESTE-ANIM-002" },
        //         status: "ATIVA"
        //     },

        //     // Nutrição
        //     {
        //         animalId: animalMapTeste["VACA HOLANDESA"],
        //         insumoId: insumoMap["SILAGEM-MILHO-500KG"],
        //         descricao: "Fornecimento de silagem de milho para vaca Holandesa.",
        //         tipo: TANIMALIA.ALIMENTACAO,
        //         loteId: loteTeste.id,
        //         dataInicio: new Date("2025-04-12T08:00:00.000Z"),
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         // anexos: { quantidadeKg: 25 },
        //         status: "ATIVA"
        //     },
        //     {
        //         animalId: animalMapTeste["TOURO NELORE"],
        //         insumoId: insumoMap["FENO-CAPIM-BALE"],
        //         descricao: "Fornecimento de feno de capim para touro Nelore.",
        //         tipo: TANIMALIA.ALIMENTACAO,
        //         loteId: loteTeste.id,
        //         data: new Date("2025-04-12T09:00:00.000Z"),
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         // anexos: { quantidadeKg: 10 },
        //         status: "ATIVA"
        //     },

        //     // Sanidade
        //     {
        //         animalId: animalMapTeste["TOURO NELORE"],
        //         insumoId: insumoMap["VACINA-FOOT-AND-MOUTH"],
        //         descricao: "Aplicação de vacina contra febre aftosa.",
        //         tipo: TANIMALIA.VACINACAO,
        //         loteId: loteTeste.id,
        //         dataInicio: new Date("2025-04-20T08:00:00.000Z"),
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         // anexos: { loteVacina: "FA-2025" },
        //         status: "ATIVA"
        //     },
        //     {
        //         animalId: animalMapTeste["VACA HOLANDESA"],
        //         insumoId: insumoMap["ANTIBIOTICO-BOV-100ML"],
        //         descricao: "Aplicação de antibiótico bovino para tratamento preventivo.",
        //         tipo: TANIMALIA.MEDICACAO,
        //         loteId: loteTeste.id,
        //         dataInicio: new Date("2025-04-21T09:00:00.000Z"),
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         // anexos: { doseMl: 20 },
        //         status: "ATIVA"
        //     },

        //     // Genética
        //     {
        //         animalId: animalMapTeste["VACA HOLANDESA"],
        //         insumoId: insumoMap["SEMEN-TOURO-ALTA"],
        //         descricao: "Inseminação artificial com sêmen de alta performance.",
        //         tipo: TANIMALIA.INSEMINACAO,
        //         loteId: loteTeste.id,
        //         dataInicio: new Date("2025-04-22T07:00:00.000Z"),
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         // anexos: { tecnico: "Dr. Silva", protocolo: "IA-TESTE-2025" },
        //         status: "ATIVA"
        //     },

        //     // Equipamentos
        //     {
        //         animalId: animalMapTeste["TOURO NELORE"],
        //         insumoId: insumoMap["BALANCA-BOV-500KG"],
        //         descricao: "Pesagem do touro Nelore em balança eletrônica.",
        //         tipo: TANIMALIA.PESAGEM,
        //         loteId: loteTeste.id,
        //         dataInicio: new Date("2025-04-23T10:00:00.000Z"),
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         // anexos: { pesoKg: 480 },
        //         status: "ATIVA"
        //     },
        //     {
        //         animalId: animalMapTeste["VACA HOLANDESA"],
        //         insumoId: insumoMap["TRONCO-CONTENCAO-001"],
        //         descricao: "Uso de tronco de contenção para exame clínico.",
        //         tipo: TANIMALIA.EXAME_CLINICO,
        //         loteId: loteTeste.id,
        //         dataInicio: new Date("2025-04-23T11:00:00.000Z"),
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         // anexos: { observacoes: "Animal contido sem estresse" },
        //         status: "ATIVA"
        //     }
        // ];
        // // Registrar saída antes de inserir atividade
        // for (const atvd of atividadesTeste) {
        //     if (atvd.insumoId) {
        //         await registrarSaida(atvd.insumoId, unidadeMap["Fazenda Teste"], 1, atvd.responsavelId, loteTeste.id);
        //     }
        // }
        // await prisma.atvdAnimalia.createMany({ data: atividadesTeste, skipDuplicates: true });
        // console.log(`Atividades Teste inseridas: ${atividadesTeste.length}`);

        // const atvdsTeste = await prisma.atvdAnimalia.findMany({ where: { status: "ATIVA" } });

        // for (const atvd of atvdsTeste) {
        //     await prisma.atvdAnimalia.update({
        //         where: { id: atvd.id },
        //         data: {
        //             dataFim: new Date(new Date(atvd.dataInicio).getTime() + 60 * 60 * 1000), // +1h
        //             status: "CONCLUIDA"
        //         }
        //     });
        // }

        // // Saída de estoque
        // await registrarSaida(insumoBySku["CALC-AG-040"]?.id, unidadeMap["Fazenda Gamma"], 10, usuarioMap["Otávio Viana"], loteGamma.id);
        // await registrarSaida(insumoBySku["SEED-SOJA-020"]?.id, unidadeMap["Fazenda Gamma"], 50, usuarioMap["Otávio Viana"], loteGamma.id);

        // const atvdAgricolaGamma = [
        //     {
        //         insumoId: insumoBySku["CALC-AG-040"]?.id,
        //         descricao: "Calagem com calcário para correção de acidez do solo antes do plantio.",
        //         tipo: TAT.ADUBACAO, // uso como correção/adubação de base
        //         loteId: loteGamma.id,
        //         dataInicio: new Date("2025-02-15T07:00:00.000Z"),
        //         responsavelId: usuarioMap["Otávio Viana"],
        //         status: "EM_PREPARO",
        //     },
        //     {
        //         insumoId: insumoBySku["SEED-SOJA-020"]?.id,
        //         descricao: "Plantio de soja com semente de alta germinação (20kg por saca).",
        //         tipo: TAT.PLANTIO,
        //         loteId: loteGamma.id,
        //         dataInicio: new Date("2025-03-01T07:00:00.000Z"),
        //         responsavelId: usuarioMap["Otávio Viana"],
        //         status: "SEMEADO",
        //     },
        //     {
        //         insumoId: null,
        //         descricao: "Irrigação do talhão de soja (controle de umidade).",
        //         tipo: TAT.IRRIGACAO,
        //         loteId: loteGamma.id,
        //         dataInicio: new Date("2025-03-07T06:00:00.000Z"),
        //         responsavelId: usuarioMap["Otávio Viana"],
        //         status: "EM_DESENVOLVIMENTO",
        //     },
        //     {
        //         insumoId: null,
        //         descricao: "Colheita da soja do lote.",
        //         tipo: TAT.COLHEITA,
        //         loteId: loteGamma.id,
        //         dataInicio: new Date("2025-05-20T07:00:00.000Z"),
        //         responsavelId: usuarioMap["Otávio Viana"],
        //         status: "COLHIDO",
        //     },
        // ];

        // await prisma.atvdAgricola.createMany({ data: atvdAgricolaGamma, skipDuplicates: true });
        // console.log(`Atividades de plantio (Gamma) inseridas: ${atvdAgricolaGamma.length}`);
        // await prisma.atvdPlantio.createMany({ data: atvdPlantioGamma, skipDuplicates: true });

        // // Saída de estoque (opcional, para refletir uso dos insumos nas atividades)
        // await registrarSaida(insumoBySku["COMPO-MIC-010"]?.id, unidadeMap["Fazenda Delta"], 5, usuarioMap["Kátia Oliveira"], loteDelta.id);
        // await registrarSaida(insumoBySku["NPK-20520-025"]?.id, unidadeMap["Fazenda Delta"], 20, usuarioMap["Kátia Oliveira"], loteDelta.id);
        // await registrarSaida(insumoBySku["INOC-SOJA-001"]?.id, unidadeMap["Fazenda Delta"], 10, usuarioMap["Kátia Oliveira"], loteDelta.id);

        // const atvdAgricolaDelta = [
        //     {
        //         insumoId: insumoBySku["COMPO-MIC-010"]?.id,
        //         descricao: "Aplicação de composto microbiano para aumentar a atividade biológica do solo nos canteiros.",
        //         tipo: TAT.ADUBACAO,
        //         loteId: loteDelta.id,
        //         dataInicio: new Date("2025-03-01T08:00:00.000Z"),
        //         responsavelId: usuarioMap["Kátia Oliveira"],
        //         status: "EM_PREPARO",
        //     },
        //     {
        //         insumoId: insumoBySku["NPK-20520-025"]?.id,
        //         descricao: "Adubação química de base com NPK 20-05-20 nos canteiros de alface e tomate.",
        //         tipo: TAT.ADUBACAO,
        //         loteId: loteDelta.id,
        //         dataInicio: new Date("2025-03-05T08:00:00.000Z"),
        //         responsavelId: usuarioMap["Kátia Oliveira"],
        //         status: "EM_DESENVOLVIMENTO",
        //     },
        //     {
        //         insumoId: null,
        //         descricao: "Plantio de mudas de alface e tomate nos canteiros preparados.",
        //         tipo: TAT.PLANTIO,
        //         loteId: loteDelta.id,
        //         dataInicio: new Date("2025-03-06T07:00:00.000Z"),
        //         responsavelId: usuarioMap["Kátia Oliveira"],
        //         status: "SEMEADO",
        //     },
        //     {
        //         insumoId: null,
        //         descricao: "Irrigação dos canteiros (controle diário de umidade).",
        //         tipo: TAT.IRRIGACAO,
        //         loteId: loteDelta.id,
        //         dataInicio: new Date("2025-03-07T06:00:00.000Z"),
        //         responsavelId: usuarioMap["Kátia Oliveira"],
        //         status: "EM_DESENVOLVIMENTO",
        //     },
        //     {
        //         insumoId: insumoBySku["INOC-SOJA-001"]?.id,
        //         descricao: "Aplicação de inoculante microbiano para reforço biológico no ciclo vegetativo.",
        //         tipo: TAT.USO_AGROTOXICO, // proxy para 'tratamento biológico' (enum não possui TRATAMENTO)
        //         loteId: loteDelta.id,
        //         dataInicio: new Date("2025-03-10T09:00:00.000Z"),
        //         responsavelId: usuarioMap["Kátia Oliveira"],
        //         status: "EM_DESENVOLVIMENTO",
        //     },
        //     {
        //         insumoId: null,
        //         descricao: "Colheita das hortaliças do lote.",
        //         tipo: TAT.COLHEITA,
        //         loteId: loteDelta.id,
        //         dataInicio: new Date("2025-04-01T06:00:00.000Z"),
        //         responsavelId: usuarioMap["Kátia Oliveira"],
        //         status: "COLHIDO",
        //     },
        // ];

        // await prisma.atvdAgricola.createMany({ data: atvdAgricolaDelta, skipDuplicates: true });
        // console.log(`Atividades de plantio (Delta) inseridas: ${atvdAgricolaDelta.length}`);

        // // ===== 15) Produção =====
        // const producoesData = [
        //     // Fazenda Alpha (carne bovina)
        //     {
        //         loteId: loteMap["Lote Inicial Alpha"],
        //         animalId: animalMap["BOI NELORE"], // se tiver animal cadastrado
        //         tipoProduto: "Carne bovina dianteiro",
        //         quantidadeBruta: 500, // kg
        //         quantidadeLiquida: 480,
        //         unidadeMedida: UMED.KG,
        //         dataInicio: new Date("2025-05-10T08:00:00.000Z"),
        //         dataFim: new Date("2025-05-10T12:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Juliana Correia"],
        //         observacoes: "Abate de lote para fornecimento de carne dianteiro"
        //     },
        //     {
        //         loteId: loteMap["Lote Inicial Alpha"],
        //         animalId: animalMap["BOI NELORE"],
        //         tipoProduto: "Carne bovina traseiro",
        //         quantidadeBruta: 600,
        //         quantidadeLiquida: 580,
        //         unidadeMedida: UMED.KG,
        //         dataInicio: new Date("2025-05-11T08:00:00.000Z"),
        //         dataFim: new Date("2025-05-11T12:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Juliana Correia"],
        //         observacoes: "Abate de lote para fornecimento de carne traseiro"
        //     },

        //     // Fazenda Gamma (grãos)
        //     {
        //         loteId: loteMap["Lote Inicial Gamma"],
        //         tipoProduto: "Soja em saca 60kg",
        //         quantidadeBruta: 600, // sacas
        //         quantidadeLiquida: 590,
        //         unidadeMedida: UMED.SACA,
        //         dataInicio: new Date("2025-05-20T07:00:00.000Z"),
        //         dataFim: new Date("2025-05-20T18:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Otávio Viana"],
        //         observacoes: "Colheita de soja"
        //     },
        //     {
        //         loteId: loteMap["Lote Inicial Gamma"],
        //         tipoProduto: "Milho em saca 60kg",
        //         quantidadeBruta: 400,
        //         quantidadeLiquida: 395,
        //         unidadeMedida: UMED.SACA,
        //         dataInicio: new Date("2025-05-25T07:00:00.000Z"),
        //         dataFim: new Date("2025-05-25T18:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Otávio Viana"],
        //         observacoes: "Colheita de milho"
        //     },

        //     // Fazenda Beta (laticínios)
        //     {
        //         loteId: loteMap["Lote Inicial Beta"],
        //         animalId: animalMap["VACA HOLANDESA"],
        //         tipoProduto: "Leite pasteurizado 1L",
        //         quantidadeBruta: 1000, // litros
        //         quantidadeLiquida: 980,
        //         unidadeMedida: UMED.LITRO,
        //         dataInicio: new Date("2025-06-01T05:00:00.000Z"),
        //         dataFim: new Date("2025-06-01T08:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Richard Souza"],
        //         observacoes: "Ordenha e pasteurização"
        //     },
        //     {
        //         loteId: loteMap["Lote Inicial Beta"],
        //         tipoProduto: "Queijo Minas Frescal 500g",
        //         quantidadeBruta: 200, // kg
        //         quantidadeLiquida: 195,
        //         unidadeMedida: UMED.KG,
        //         dataInicio: new Date("2025-06-02T09:00:00.000Z"),
        //         dataFim: new Date("2025-06-02T15:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Richard Souza"],
        //         observacoes: "Produção de queijo frescal"
        //     },
        //     {
        //         loteId: loteMap["Lote Inicial Beta"],
        //         tipoProduto: "Iogurte natural 170g",
        //         quantidadeBruta: 500, // unidades
        //         quantidadeLiquida: 495,
        //         unidadeMedida: UMED.UNIDADE,
        //         dataInicio: new Date("2025-06-03T07:00:00.000Z"),
        //         dataFim: new Date("2025-06-03T12:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Richard Souza"],
        //         observacoes: "Produção de iogurte natural"
        //     },

        //     // Fazenda Delta (hortaliças)
        //     {
        //         loteId: loteMap["Lote Inicial Delta"],
        //         tipoProduto: "Alface crespa unidade",
        //         quantidadeBruta: 1000,
        //         quantidadeLiquida: 980,
        //         unidadeMedida: UMED.UNIDADE,
        //         dataInicio: new Date("2025-06-05T06:00:00.000Z"),
        //         dataFim: new Date("2025-06-05T12:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Kátia Oliveira"],
        //         observacoes: "Colheita de alface crespa"
        //     },
        //     {
        //         loteId: loteMap["Lote Inicial Delta"],
        //         tipoProduto: "Tomate caixa 20kg",
        //         quantidadeBruta: 200, // caixas
        //         quantidadeLiquida: 198,
        //         unidadeMedida: UMED.KG,
        //         dataInicio: new Date("2025-06-06T06:00:00.000Z"),
        //         dataFim: new Date("2025-06-06T12:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Kátia Oliveira"],
        //         observacoes: "Colheita de tomate"
        //     },

        //     // Fazenda Teste (laticínios e carne)
        //     {
        //         loteId: loteMap["Lote Inicial Teste"],
        //         tipoProduto: "Leite pasteurizado 1L (teste)",
        //         quantidadeBruta: 200,
        //         quantidadeLiquida: 198,
        //         unidadeMedida: UMED.LITRO,
        //         dataInicio: new Date("2025-06-10T07:00:00.000Z"),
        //         dataFim: new Date("2025-06-10T09:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         observacoes: "Ordenha experimental e pasteurização"
        //     },
        //     {
        //         loteId: loteMap["Lote Inicial Teste"],
        //         tipoProduto: "Queijo fresco 500g (teste)",
        //         quantidadeBruta: 50,
        //         quantidadeLiquida: 49,
        //         unidadeMedida: UMED.KG,
        //         dataInicio: new Date("2025-06-11T08:00:00.000Z"),
        //         dataFim: new Date("2025-06-11T12:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         observacoes: "Produção de queijo fresco experimental"
        //     },
        //     {
        //         loteId: loteMap["Lote Inicial Teste"],
        //         tipoProduto: "Carne bovina corte dianteiro (teste)",
        //         quantidadeBruta: 100,
        //         quantidadeLiquida: 98,
        //         unidadeMedida: UMED.KG,
        //         dataInicio: new Date("2025-06-12T07:00:00.000Z"),
        //         dataFim: new Date("2025-06-12T12:00:00.000Z"),
        //         status: "CONCLUIDA",
        //         responsavelId: usuarioMap["Usuario Ficticio"],
        //         observacoes: "Abate experimental para carne dianteiro"
        //     }
        // ];
        // await prisma.producao.createMany({ data: producoesData, skipDuplicates: true });
        // console.log(`Produções inseridas: ${producoesData.length}`);

        // // pedidos
        // const pedidosLojas = [
        //     // VerdeFresco Hortaliças → Fazenda Delta
        //     {
        //         contratoId: contratoMap["Fazenda Delta - VerdeFresco Hortaliças"],
        //         origemUnidadeId: unidadeMap["Fazenda Delta"], // fornecedor
        //         destinoUnidadeId: unidadeMap["VerdeFresco Hortaliças"], // loja
        //         criadoPorId: usuarioMap["Roberto Barros"], // gerente da loja
        //         dataPedido: new Date("2025-06-02T09:00:00.000Z"),
        //         dataEnvio: new Date("2025-06-04T08:00:00.000Z"),
        //         valorTotal: "12000.00",
        //         documentoReferencia: "PED-DELTA-VERDEFRESCO-20250602",
        //         tipoTransporte: TTRANS.RODOVIARIO,
        //         observacoes: "Pedido mensal de hortaliças frescas."
        //     },

        //     // AgroBoi → Fazenda Alpha
        //     {
        //         contratoId: contratoMap["Fazenda Alpha - AgroBoi"],
        //         origemUnidadeId: unidadeMap["Fazenda Alpha"], // fornecedor
        //         destinoUnidadeId: unidadeMap["AgroBoi"], // loja
        //         criadoPorId: usuarioMap["Bruna Carvalho"], // gerente da loja
        //         dataPedido: new Date("2025-06-03T10:00:00.000Z"),
        //         dataEnvio: new Date("2025-06-06T07:30:00.000Z"),
        //         valorTotal: "18000.00",
        //         documentoReferencia: "PED-ALPHA-AGROBOI-20250603",
        //         tipoTransporte: TTRANS.RODOVIARIO,
        //         observacoes: "Pedido de carne bovina para abastecimento semanal."
        //     },

        //     // Casa Útil Mercado → Fazenda Gamma
        //     {
        //         contratoId: contratoMap["Fazenda Gamma - Casa Útil Mercado"],
        //         origemUnidadeId: unidadeMap["Fazenda Gamma"], // fornecedor
        //         destinoUnidadeId: unidadeMap["Casa Útil Mercado"], // loja
        //         criadoPorId: usuarioMap["Maria Del Rey"], // gerente da loja
        //         dataPedido: new Date("2025-06-04T11:00:00.000Z"),
        //         dataEnvio: new Date("2025-06-07T09:00:00.000Z"),
        //         valorTotal: "22000.00",
        //         documentoReferencia: "PED-GAMMA-CASAUTIL-20250604",
        //         tipoTransporte: TTRANS.RODOVIARIO,
        //         observacoes: "Pedido de grãos e cereais para reposição mensal."
        //     },

        //     // Sabor do Campo Laticínios → Fazenda Beta
        //     {
        //         contratoId: contratoMap["Fazenda Beta - Sabor do Campo Laticínios"],
        //         origemUnidadeId: unidadeMap["Fazenda Beta"], // fornecedor
        //         destinoUnidadeId: unidadeMap["Sabor do Campo Laticínios"], // loja
        //         criadoPorId: usuarioMap["Lorena Oshiro"], // gerente da loja
        //         dataPedido: new Date("2025-06-05T08:30:00.000Z"),
        //         dataEnvio: new Date("2025-06-08T07:00:00.000Z"),
        //         valorTotal: "15000.00",
        //         documentoReferencia: "PED-BETA-SABORCAMPO-20250605",
        //         tipoTransporte: TTRANS.RODOVIARIO,
        //         observacoes: "Pedido de laticínios (leite, queijo, iogurte) para abastecimento quinzenal."
        //     },
        //     {
        //         contratoId: contratoMap["Loja Teste - Fazenda Teste"],
        //         origemUnidadeId: unidadeMap["Fazenda Teste"], // fornecedor
        //         destinoUnidadeId: unidadeMap["Loja Teste"],   // loja
        //         criadoPorId: usuarioMap["Renato Martins"],    // gerente da Loja Teste
        //         dataPedido: new Date("2025-06-06T09:00:00.000Z"),
        //         dataEnvio: new Date("2025-06-08T08:00:00.000Z"),
        //         valorTotal: "10000.00",
        //         documentoReferencia: "PED-TESTE-LOJA-20250606",
        //         tipoTransporte: TTRANS.RODOVIARIO,
        //         observacoes: "Pedido de laticínios e carne bovina para abastecimento da Loja Teste."
        //     }
        // ];

        // await prisma.pedido.createMany({ data: pedidosLojas, skipDuplicates: true });
        // console.log("Pedidos das lojas criados com sucesso");

        // // movimentacao estoque (entrada)

        // // produtos que ja estao na loja mas nao estao pra venda
        // console.log("Criando produtos...");
        // // ------------------------ PRODUTOS PARA ESTOQUE DAS LOJAS ------------------------
        // const produtosEstoqueLoja = [
        // ];
        // await prisma.produto.createMany({ data: produtosEstoqueLoja, skipDuplicates: true });

        // // ===== Estoques =====
        // console.log("Criando estoques...");
        // const estoqueLoja = [
        // ]
        // await prisma.estoque.createMany({ data: estoqueLoja, skipDuplicates: true });
        // console.log("Estoques criados:", estoqueData.length);

        // // movimento estoque (saida)

        // // ------------------------ PRODUTOS PARA VENDA DAS LOJAS ------------------------
        // const produtosVendaLoja = [
        //     // VerdeFresco Hortaliças (hortaliças / vegetais) - origin: Fazenda Delta (hortas)
        //     {
        //         unidadeId: unidadeMap["VerdeFresco Hortaliças"],
        //         origemUnidadeId: unidadeMap["Fazenda Delta"],
        //         loteId: loteMap["Lote Horta 2025-02"],
        //         criadoPorId: usuarioMap["Roberto Barros"],
        //         nome: "Alface Crespa (maço)",
        //         sku: "ALFACE-CRES-001",
        //         categoria: "Hortaliça",
        //         descricao: "Alface crespa colhida para venda por unidade (maço)",
        //         preco: "2.50",
        //         dataFabricacao: new Date("2025-06-01"),
        //         dataValidade: new Date("2025-06-07"),
        //         unidadeMedida: UMED.UNIDADE,
        //         codigoBarras: "7891000000011",
        //         ncm: "07051100",
        //         pesoUnidade: "0.150",
        //         tags: ["folha", "orgânico"],
        //         impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
        //     },
        //     {
        //         unidadeId: unidadeMap["VerdeFresco Hortaliças"],
        //         origemUnidadeId: unidadeMap["Fazenda Delta"],
        //         loteId: loteMap["Lote Horta 2025-01"],
        //         criadoPorId: usuarioMap["Roberto Barros"],
        //         nome: "Tomate Carmem (kg)",
        //         sku: "TOMATE-CARM-001",
        //         categoria: "Hortaliça",
        //         descricao: "Tomate Carmem, vendido a granel por kg",
        //         preco: "6.80",
        //         dataFabricacao: new Date("2025-05-28"),
        //         dataValidade: new Date("2025-06-10"),
        //         unidadeMedida: UMED.KG,
        //         codigoBarras: "7891000000012",
        //         ncm: "07020010",
        //         pesoUnidade: "1.000",
        //         tags: ["tomate", "fresco"],
        //         impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
        //     },
        //     {
        //         unidadeId: unidadeMap["VerdeFresco Hortaliças"],
        //         origemUnidadeId: unidadeMap["Fazenda Delta"],
        //         loteId: loteMap["Lote Horta 2025-02"],
        //         criadoPorId: usuarioMap["Roberto Barros"],
        //         nome: "Mix Verduras (pack)",
        //         sku: "MIX-VERD-001",
        //         categoria: "Hortaliça",
        //         descricao: "Pack com mix de rúcula, agrião e alface (porção pronta para venda)",
        //         preco: "5.50",
        //         dataFabricacao: new Date("2025-06-01"),
        //         dataValidade: new Date("2025-06-06"),
        //         unidadeMedida: UMED.UNIDADE,
        //         codigoBarras: "7891000000013",
        //         ncm: "07059000",
        //         pesoUnidade: "0.350",
        //         tags: ["mix", "salada"],
        //         impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
        //     },
        //     // AgroBoi (gado / insumos para bovinos) - origin: Fazenda Alpha (gado)
        //     {
        //         unidadeId: unidadeMap["AgroBoi"],
        //         origemUnidadeId: unidadeMap["Fazenda Alpha"],
        //         loteId: loteMap["Lote Gado 2025-01"],
        //         criadoPorId: usuarioMap["Bruna Carvalho"],
        //         nome: "Carne Contrafilé (1kg)",
        //         sku: "CARNE-CF-001",
        //         categoria: "Carne",
        //         descricao: "Contrafilé bovino - embalagem por 1kg (procedência Fazenda Alpha)",
        //         preco: "39.00",
        //         dataFabricacao: new Date("2025-05-25"),
        //         dataValidade: new Date("2025-06-05"),
        //         unidadeMedida: UMED.KG,
        //         codigoBarras: "7891000000020",
        //         ncm: "02023000",
        //         pesoUnidade: "1.000",
        //         tags: ["bovino", "corte"],
        //         impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
        //     },
        //     {
        //         unidadeId: unidadeMap["AgroBoi"],
        //         origemUnidadeId: unidadeMap["Fazenda Alpha"],
        //         loteId: loteMap["Lote Gado 2025-01"],
        //         criadoPorId: usuarioMap["Bruna Carvalho"],
        //         nome: "Ração Bovino Engorda 50kg (loja)",
        //         sku: "RACAO-BOV-050-LOJA",
        //         categoria: "Ração",
        //         descricao: "Ração para engorda - saco 50kg (transferência interna da fazenda)",
        //         preco: "265.00",
        //         dataFabricacao: new Date("2025-01-20"),
        //         dataValidade: new Date("2026-01-20"),
        //         unidadeMedida: UMED.SACA,
        //         codigoBarras: "7891000000021",
        //         ncm: "23091000",
        //         pesoUnidade: "50.000",
        //         tags: ["racao", "bovino"],
        //         impostos: { icms: 12.0 }
        //     },
        //     {
        //         unidadeId: unidadeMap["AgroBoi"],
        //         origemUnidadeId: unidadeMap["Fazenda Alpha"],
        //         loteId: loteMap["Lote Gado 2025-02"],
        //         criadoPorId: usuarioMap["Bruna Carvalho"],
        //         nome: "Suplemento Mineral Bovino 5kg (loja)",
        //         sku: "SUP-MIN-BOV-005-LOJA",
        //         categoria: "Suplemento",
        //         descricao: "Bloco mineral 5kg para bovinos - vendido na loja AgroBoi",
        //         preco: "45.00",
        //         dataFabricacao: new Date("2025-02-01"),
        //         dataValidade: new Date("2027-02-01"),
        //         unidadeMedida: UMED.KG,
        //         codigoBarras: "7891000000022",
        //         ncm: "23099000",
        //         pesoUnidade: "5.000",
        //         tags: ["suplemento", "bovino"],
        //         impostos: { icms: 12.0 }
        //     },
        //     // Sabor do Campo Laticínios (laticínios) - origin: Fazenda Beta (leite)
        //     {
        //         unidadeId: unidadeMap["Sabor do Campo Laticínios"],
        //         origemUnidadeId: unidadeMap["Fazenda Beta"],
        //         loteId: loteMap["Lote Leite 2025-01"],
        //         criadoPorId: usuarioMap["Lorena Oshiro"],
        //         nome: "Leite Pasteurizado 1L",
        //         sku: "LEITE-PAST-001",
        //         categoria: "Laticínio",
        //         descricao: "Leite pasteurizado, 1 litro, procedência Fazenda Beta",
        //         preco: "4.50",
        //         dataFabricacao: new Date("2025-05-10"),
        //         dataValidade: new Date("2025-05-17"),
        //         unidadeMedida: UMED.LITRO,
        //         codigoBarras: "7891000000030",
        //         ncm: "04012010",
        //         pesoUnidade: "1.000",
        //         tags: ["leite", "pasteurizado"],
        //         impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
        //     },
        //     {
        //         unidadeId: unidadeMap["Sabor do Campo Laticínios"],
        //         origemUnidadeId: unidadeMap["Fazenda Beta"],
        //         loteId: loteMap["Lote Leite 2025-01"],
        //         criadoPorId: usuarioMap["Lorena Oshiro"],
        //         nome: "Queijo Minas Frescal 200g",
        //         sku: "QUEIJO-MINAS-200",
        //         categoria: "Laticínio",
        //         descricao: "Queijo Minas fresco - 200g (produção local)",
        //         preco: "16.00",
        //         dataFabricacao: new Date("2025-05-05"),
        //         dataValidade: new Date("2025-05-20"),
        //         unidadeMedida: UMED.UNIDADE,
        //         codigoBarras: "7891000000031",
        //         ncm: "04063010",
        //         pesoUnidade: "0.200",
        //         tags: ["queijo", "fresco"],
        //         impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
        //     },
        //     {
        //         unidadeId: unidadeMap["Sabor do Campo Laticínios"],
        //         origemUnidadeId: unidadeMap["Fazenda Beta"],
        //         loteId: loteMap["Lote Leite 2025-02"],
        //         criadoPorId: usuarioMap["Lorena Oshiro"],
        //         nome: "Iogurte Natural 500g",
        //         sku: "IOGURTE-NAT-500",
        //         categoria: "Laticínio",
        //         descricao: "Iogurte natural sem açúcar - pote 500g",
        //         preco: "7.50",
        //         dataFabricacao: new Date("2025-05-12"),
        //         dataValidade: new Date("2025-05-22"),
        //         unidadeMedida: UMED.UNIDADE,
        //         codigoBarras: "7891000000032",
        //         ncm: "04031000",
        //         pesoUnidade: "0.500",
        //         tags: ["iogurte", "natural"],
        //         impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
        //     },
        //     // Casa Útil Mercado (produtos diversos pequenos) - origem variada
        //     {
        //         unidadeId: unidadeMap["Casa Útil Mercado"],
        //         origemUnidadeId: unidadeMap["Fazenda Gamma"],
        //         loteId: loteMap["Lote Trigo 2025-01"],
        //         criadoPorId: usuarioMap["Maria Del Rey"],
        //         nome: "Farinha de Trigo Tipo 1 1kg",
        //         sku: "FARIN-TRIG-1KG",
        //         categoria: "Alimentos",
        //         descricao: "Farinha de trigo tipo 1 - pacote 1kg (produção local / moagem a partir do lote)",
        //         preco: "6.80",
        //         dataFabricacao: new Date("2025-04-15"),
        //         dataValidade: new Date("2026-04-15"),
        //         unidadeMedida: UMED.KG,
        //         codigoBarras: "7891000000040",
        //         ncm: "11010000",
        //         pesoUnidade: "1.000",
        //         tags: ["farinha", "trigo"],
        //         impostos: { icms: 12.0 }
        //     },
        //     {
        //         unidadeId: unidadeMap["Casa Útil Mercado"],
        //         origemUnidadeId: unidadeMap["Fazenda Teste"],
        //         loteId: loteMap["Lote Teste 01"],
        //         criadoPorId: usuarioMap["Maria Del Rey"],
        //         nome: "Sabão em Pó 1kg (marca local)",
        //         sku: "SABAO-PO-1KG",
        //         categoria: "Higiene",
        //         descricao: "Sabão em pó embalagem 1kg - marca local/teste",
        //         preco: "9.50",
        //         dataFabricacao: new Date("2025-03-01"),
        //         dataValidade: new Date("2027-03-01"),
        //         unidadeMedida: UMED.UNIDADE,
        //         codigoBarras: "7891000000041",
        //         ncm: "34021300",
        //         pesoUnidade: "1.000",
        //         tags: ["limpeza"],
        //         impostos: { icms: 12.0, pis: 1.65, cofins: 7.6 }
        //     },
        //     {
        //         unidadeId: unidadeMap["Casa Útil Mercado"],
        //         origemUnidadeId: unidadeMap["Fazenda Alpha"],
        //         loteId: loteMap["Lote Milho 2025-01"],
        //         criadoPorId: usuarioMap["Maria Del Rey"],
        //         nome: "Milho Para Pipoca 1kg",
        //         sku: "MILHO-PIPE-1KG",
        //         categoria: "Alimentos",
        //         descricao: "Milho seco para consumo/uso doméstico - 1kg",
        //         preco: "7.20",
        //         dataFabricacao: new Date("2025-04-01"),
        //         dataValidade: new Date("2026-04-01"),
        //         unidadeMedida: UMED.KG,
        //         codigoBarras: "7891000000042",
        //         ncm: "10059011",
        //         pesoUnidade: "1.000",
        //         tags: ["milho", "seco"],
        //         impostos: { icms: 12.0 }
        //     },
        // ];
        // await prisma.produto.createMany({ data: produtosVendaLoja, skipDuplicates: true });

        // let produtosDb = await prisma.produto.findMany();
        // const produtoMap = Object.fromEntries(produtosDb.map(p => [p.sku, p.id]));
        // console.log("Produtos criados:", produtosDb.length);

        // caixa 

        // venda

        // itens venda



        // dados financeiros de todas as unidades

        console.log("SEED finalizado com sucesso!");
    } catch (error) {
        console.error("Erro durante seed:", error);
        process.exitCode = 1;
    } finally {
        await prisma.$disconnect();
        console.log("Desconectado do banco.");
    }
}

main();